shadow$provide.module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_3d_layer$tile_3d_layer=function(global,require,module,exports){function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=
null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=
(0,_getPrototypeOf2["default"])(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;Super=Reflect.construct(Super,arguments,NewTarget)}else Super=Super.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,Super)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,
[],function(){})),!0}catch(e){return!1}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _regenerator=global(require("module$node_modules$$babel$runtime$regenerator$index")),_defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_asyncToGenerator2=global(require("module$node_modules$$babel$runtime$helpers$asyncToGenerator")),_classCallCheck2=
global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits")),_possibleConstructorReturn2=global(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=global(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_core=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),
_core2=require("module$node_modules$$deck_DOT_gl$core$dist$es5$index"),_layers=require("module$node_modules$$deck_DOT_gl$layers$dist$es5$index"),_meshLayers=require("module$node_modules$$deck_DOT_gl$mesh_layers$dist$es5$index"),_core3=require("module$node_modules$$loaders_DOT_gl$core$dist$es5$index"),_tiles=require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$index"),SINGLE_DATA=[0];require={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:null,loader:require("module$node_modules$$loaders_DOT_gl$3d_tiles$dist$es5$index").Tiles3DLoader,
onTilesetLoad:{type:"function",value:function(tileset3d){},compare:!1},onTileLoad:{type:"function",value:function(tileHeader){},compare:!1},onTileUnload:{type:"function",value:function(tileHeader){},compare:!1},onTileError:{type:"function",value:function(tile,message,url){},compare:!1}};global=function(_CompositeLayer){function Tile3DLayer(){(0,_classCallCheck2["default"])(this,Tile3DLayer);return _super.apply(this,arguments)}(0,_inherits2["default"])(Tile3DLayer,_CompositeLayer);var _super=_createSuper(Tile3DLayer);
(0,_createClass2["default"])(Tile3DLayer,[{key:"initializeState",value:function(){"onTileLoadFail"in this.props&&_core2.log.removed("onTileLoadFail","onTileError")();this.state={layerMap:{},tileset3d:null}}},{key:"shouldUpdateState",value:function(_ref){return _ref.changeFlags.somethingChanged}},{key:"updateState",value:function(_ref2){var props=_ref2.props,oldProps=_ref2.oldProps;_ref2=_ref2.changeFlags;props.data&&props.data!==oldProps.data&&this._loadTileset(props.data);_ref2.viewportChanged&&
this._updateTileset(this.state.tileset3d);if(_ref2.propsChanged){props=this.state.layerMap;for(var key in props)props[key].needsUpdate=!0}}},{key:"getPickingInfo",value:function(_ref3){var info=_ref3.info,sourceLayer=_ref3.sourceLayer;_ref3=this.state.layerMap;if(sourceLayer=sourceLayer&&sourceLayer.id)sourceLayer=sourceLayer.substring(this.id.length+1),sourceLayer=sourceLayer.substring(sourceLayer.indexOf("-")+1),info.object=_ref3[sourceLayer]&&_ref3[sourceLayer].tile;return info}},{key:"_loadTileset",
value:function(){var _loadTileset2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(tilesetUrl){var loadOptions,loader,options,preloadOptions,tilesetJson,tileset3d;return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:loadOptions=this.props.loadOptions;loader=this.props.loader||this.props.loaders;Array.isArray(loader)&&(loader=loader[0]);options=_objectSpread({},loadOptions);if(!loader.preload){_context.next=9;break}_context.next=
7;return loader.preload(tilesetUrl,loadOptions);case 7:preloadOptions=_context.sent,Object.assign(options,preloadOptions);case 9:return _context.next=11,(0,_core3.load)(tilesetUrl,loader,options);case 11:tilesetJson=_context.sent,tileset3d=new _tiles.Tileset3D(tilesetJson,_objectSpread({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileLoadFail:this.props.onTileError},options)),this.setState({tileset3d,layerMap:{}}),this._updateTileset(tileset3d),this.props.onTilesetLoad(tileset3d);
case 16:case "end":return _context.stop()}},_callee,this)}));return function(_x){return _loadTileset2.apply(this,arguments)}}()},{key:"_onTileLoad",value:function(tileHeader){this.props.onTileLoad(tileHeader);this._updateTileset(this.state.tileset3d);this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(tileHeader){delete this.state.layerMap[tileHeader.id];this.props.onTileUnload(tileHeader)}},{key:"_updateTileset",value:function(tileset3d){var _this$context=this.context,viewport=_this$context.viewport;
_this$context.timeline&&viewport&&tileset3d&&(tileset3d=tileset3d.update(viewport),this.state.frameNumber!==tileset3d&&this.setState({frameNumber:tileset3d}))}},{key:"_getSubLayer",value:function(tileHeader,oldLayer){if(!tileHeader.content)return null;switch(tileHeader.type){case _tiles.TILE_TYPE.POINTCLOUD:return this._makePointCloudLayer(tileHeader,oldLayer);case _tiles.TILE_TYPE.SCENEGRAPH:return this._make3DModelLayer(tileHeader,oldLayer);case _tiles.TILE_TYPE.MESH:return this._makeSimpleMeshLayer(tileHeader,
oldLayer);default:throw Error("Tile3DLayer: Failed to render layer of type ".concat(tileHeader.content.type));}}},{key:"_makePointCloudLayer",value:function(tileHeader,oldLayer){var _tileHeader$content=tileHeader.content,attributes=_tileHeader$content.attributes,pointCount=_tileHeader$content.pointCount,constantRGBA=_tileHeader$content.constantRGBA,cartographicOrigin=_tileHeader$content.cartographicOrigin;_tileHeader$content=_tileHeader$content.modelMatrix;var positions=attributes.positions,normals=
attributes.normals;attributes=attributes.colors;if(!positions)return null;oldLayer=oldLayer&&oldLayer.props.data||{header:{vertexCount:pointCount},attributes:{POSITION:positions,NORMAL:normals,COLOR_0:attributes}};attributes=this.props;pointCount=attributes.pointSize;attributes=attributes.getPointColor;return new (this.getSubLayerClass("pointcloud",_layers.PointCloudLayer))({pointSize:pointCount},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(tileHeader.id),
data:oldLayer,coordinateSystem:_core2.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:cartographicOrigin,modelMatrix:_tileHeader$content,getColor:constantRGBA||attributes})}},{key:"_make3DModelLayer",value:function(tileHeader){var _tileHeader$content2=tileHeader.content,gltf=_tileHeader$content2.gltf,instances=_tileHeader$content2.instances,cartographicOrigin=_tileHeader$content2.cartographicOrigin;_tileHeader$content2=_tileHeader$content2.modelMatrix;return new (this.getSubLayerClass("scenegraph",
_meshLayers.ScenegraphLayer))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(tileHeader.id),data:instances||SINGLE_DATA,scenegraph:gltf,coordinateSystem:_core2.COORDINATE_SYSTEM.METER_OFFSETS,coordinateOrigin:cartographicOrigin,modelMatrix:_tileHeader$content2,getTransformMatrix:function(instance){return instance.modelMatrix},getPosition:[0,0,0]})}},{key:"_makeSimpleMeshLayer",value:function(tileHeader,oldLayer){var content=tileHeader.content,
attributes=content.attributes,modelMatrix=content.modelMatrix,cartographicOrigin=content.cartographicOrigin;content=content.texture;if(!(oldLayer=oldLayer&&oldLayer.props.mesh)){oldLayer=_core.Geometry;var attributes$jscomp$0={};attributes$jscomp$0.positions=_objectSpread(_objectSpread({},attributes.positions),{},{value:new Float32Array(attributes.positions.value)});attributes.normals&&(attributes$jscomp$0.normals=attributes.normals);attributes.texCoords&&(attributes$jscomp$0.texCoords=attributes.texCoords);
oldLayer=new oldLayer({drawMode:4,attributes:attributes$jscomp$0})}attributes=oldLayer;return new (this.getSubLayerClass("mesh",_meshLayers.SimpleMeshLayer))(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(tileHeader.id),mesh:attributes,data:SINGLE_DATA,getPosition:[0,0,0],getColor:[255,255,255],texture:content,modelMatrix,coordinateOrigin:cartographicOrigin,coordinateSystem:_core2.COORDINATE_SYSTEM.METER_OFFSETS})}},{key:"renderLayers",value:function(){var _this=this,_this$state=
this.state,tileset3d=_this$state.tileset3d,layerMap=_this$state.layerMap;return tileset3d?tileset3d.tiles.map(function(tile){var layerCache=layerMap[tile.id]=layerMap[tile.id]||{tile},layer=layerCache.layer;tile.selected?layer?layerCache.needsUpdate?(layer=_this._getSubLayer(tile,layer),layerCache.needsUpdate=!1):layer.props.visible||(layer=layer.clone({visible:!0})):layer=_this._getSubLayer(tile):layer&&layer.props.visible&&(layer=layer.clone({visible:!1}));return layerCache.layer=layer}).filter(Boolean):
null}},{key:"isLoaded",get:function(){var tileset3d=this.state.tileset3d;return tileset3d&&tileset3d.isLoaded()}}]);return Tile3DLayer}(_core2.CompositeLayer);exports["default"]=global;global.layerName="Tile3DLayer";global.defaultProps=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_3d_layer$tile_3d_layer.js.map
