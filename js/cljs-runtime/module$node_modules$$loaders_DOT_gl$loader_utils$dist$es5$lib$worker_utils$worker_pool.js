shadow$provide.module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$lib$worker_utils$worker_pool=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _regenerator=global(require("module$node_modules$$babel$runtime$regenerator$index")),_asyncToGenerator2=global(require("module$node_modules$$babel$runtime$helpers$asyncToGenerator")),_classCallCheck2=
global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_workerThread=global(require("module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$lib$worker_utils$worker_thread"));require=function(){function WorkerPool(_ref){var source=_ref.source,_ref$name=_ref.name;_ref$name=void 0===_ref$name?"unnamed":_ref$name;var _ref$maxConcurrency=_ref.maxConcurrency;_ref$maxConcurrency=void 0===_ref$maxConcurrency?
1:_ref$maxConcurrency;var onMessage=_ref.onMessage,_ref$onDebug=_ref.onDebug;_ref$onDebug=void 0===_ref$onDebug?function(){}:_ref$onDebug;_ref=_ref.reuseWorkers;_ref=void 0===_ref?!0:_ref;(0,_classCallCheck2["default"])(this,WorkerPool);this.source=source;this.name=_ref$name;this.maxConcurrency=_ref$maxConcurrency;this.onMessage=onMessage;this.onDebug=_ref$onDebug;this.jobQueue=[];this.idleQueue=[];this.count=0;this.isDestroyed=!1;this.reuseWorkers=_ref}(0,_createClass2["default"])(WorkerPool,[{key:"destroy",
value:function(){this.idleQueue.forEach(function(worker){return worker.destroy()});this.isDestroyed=!0}},{key:"process",value:function(data,jobName){var _this=this;return new Promise(function(resolve,reject){_this.jobQueue.push({data,jobName,resolve,reject});_this._startQueuedJob()})}},{key:"_startQueuedJob",value:function(){var _startQueuedJob2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(){var worker,job;return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=
_context.next){case 0:if(this.jobQueue.length){_context.next=2;break}return _context.abrupt("return");case 2:if(worker=this._getAvailableWorker()){_context.next=5;break}return _context.abrupt("return");case 5:return job=this.jobQueue.shift(),this.onDebug({message:"processing",worker:worker.name,job:job.jobName,backlog:this.jobQueue.length}),_context.prev=7,_context.t0=job,_context.next=11,worker.process(job.data);case 11:_context.t1=_context.sent;_context.t0.resolve.call(_context.t0,_context.t1);
_context.next=18;break;case 15:_context.prev=15,_context.t2=_context["catch"](7),job.reject(_context.t2);case 18:return _context.prev=18,this._onWorkerDone(worker),_context.finish(18);case 21:case "end":return _context.stop()}},_callee,this,[[7,15,18,21]])}));return function(){return _startQueuedJob2.apply(this,arguments)}}()},{key:"_onWorkerDone",value:function(worker){this.isDestroyed?worker.destroy():(this.reuseWorkers?this.idleQueue.push(worker):(worker.destroy(),this.count--),this._startQueuedJob())}},
{key:"_getAvailableWorker",value:function(){if(0<this.idleQueue.length)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;var name="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new _workerThread["default"]({source:this.source,onMessage:this.onMessage,name})}return null}}]);return WorkerPool}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$lib$worker_utils$worker_pool.js.map
