shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$attribute=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _createSuper(Derived){var hasNativeReflectConstruct=
_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2["default"])(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;Super=Reflect.construct(Super,arguments,NewTarget)}else Super=Super.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,Super)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;
try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _defineProperty2=module(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_slicedToArray2=module(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),
_classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),_get2=module(require("module$node_modules$$babel$runtime$helpers$get")),_inherits2=module(require("module$node_modules$$babel$runtime$helpers$inherits")),_possibleConstructorReturn2=module(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=module(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),
_dataColumn=module(require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$data_column")),_assert=module(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$assert")),_iterableUtils=require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$iterable_utils"),_flatten=require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$flatten"),range=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$range")),_attributeTransitionUtils=require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$attribute_transition_utils");
require=function(_DataColumn){function Attribute(gl){var opts=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,Attribute);var _this=_super.call(this,gl,opts);var _opts$transition=opts.transition,_opts$noAlloc=opts.noAlloc,_opts$update=opts.update,_opts$accessor=opts.accessor;_opts$accessor=void 0===_opts$accessor?null:_opts$accessor;var _opts$transform=opts.transform;opts=opts.startIndices;opts=void 0===opts?null:opts;Object.assign(_this.settings,{transition:void 0===
_opts$transition?!1:_opts$transition,noAlloc:void 0===_opts$noAlloc?!1:_opts$noAlloc,update:(void 0===_opts$update?null:_opts$update)||_opts$accessor&&_this._autoUpdater,accessor:_opts$accessor,transform:void 0===_opts$transform?null:_opts$transform});Object.assign(_this.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:range.FULL,startIndices:opts});Object.seal(_this.settings);Object.seal(_this.state);_this._validateAttributeUpdaters();
return _this}(0,_inherits2["default"])(Attribute,_DataColumn);var _super=_createSuper(Attribute);(0,_createClass2["default"])(Attribute,[{key:"needsUpdate",value:function(){return this.state.needsUpdate}},{key:"needsRedraw",value:function(){var _ref$clearChangedFlag=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).clearChangedFlags,needsRedraw=this.state.needsRedraw;this.state.needsRedraw=needsRedraw&&!(void 0===_ref$clearChangedFlag?0:_ref$clearChangedFlag);return needsRedraw}},{key:"getUpdateTriggers",
value:function(){var accessor=this.settings.accessor;return[this.id].concat("function"!==typeof accessor&&accessor||[])}},{key:"supportsTransition",value:function(){return!!this.settings.transition}},{key:"getTransitionSetting",value:function(opts){if(!opts||!this.supportsTransition())return null;var accessor=this.settings.accessor,layerSettings=this.settings.transition;accessor=Array.isArray(accessor)?opts[accessor.find(function(a){return opts[a]})]:opts[accessor];return(0,_attributeTransitionUtils.normalizeTransitionSettings)(accessor,
layerSettings)}},{key:"setNeedsUpdate",value:function(){var reason=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.id,dataRange=1<arguments.length?arguments[1]:void 0;this.state.needsUpdate=this.state.needsUpdate||reason;this.setNeedsRedraw(reason);dataRange?(reason=dataRange.startRow,dataRange=dataRange.endRow,this.state.updateRanges=range.add(this.state.updateRanges,[void 0===reason?0:reason,void 0===dataRange?Infinity:dataRange])):this.state.updateRanges=range.FULL}},{key:"clearNeedsUpdate",
value:function(){this.state.needsUpdate=!1;this.state.updateRanges=range.EMPTY}},{key:"setNeedsRedraw",value:function(){var reason=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||reason}},{key:"update",value:function(opts){this.setData(opts)}},{key:"allocate",value:function(numInstances){var state=this.state,settings=this.settings;return settings.noAlloc?!1:settings.update?((0,_assert["default"])(Number.isFinite(numInstances)),(0,_get2["default"])((0,
_getPrototypeOf2["default"])(Attribute.prototype),"allocate",this).call(this,{numInstances,copy:state.updateRanges!==range.FULL}),!0):!1}},{key:"updateBuffer",value:function(_ref2){var numInstances=_ref2.numInstances,data=_ref2.data,props=_ref2.props;_ref2=_ref2.context;if(!this.needsUpdate())return!1;var updateRanges=this.state.updateRanges,_this$settings=this.settings,update=_this$settings.update;_this$settings=_this$settings.noAlloc;var updated=!0;if(update){var _iterator=_createForOfIteratorHelper(updateRanges),
_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=(0,_slicedToArray2["default"])(_step.value,2);update.call(_ref2,this,{data,startRow:_step$value[0],endRow:_step$value[1],props,numInstances})}}catch(err){_iterator.e(err)}finally{_iterator.f()}if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant});else{data=_createForOfIteratorHelper(updateRanges);var _step2;try{for(data.s();!(_step2=
data.n()).done;){var _step2$value=(0,_slicedToArray2["default"])(_step2.value,2),startRow=_step2$value[0],endRow=_step2$value[1],startOffset=Number.isFinite(startRow)?this.getVertexOffset(startRow):0,endOffset=Number.isFinite(endRow)?this.getVertexOffset(endRow):_this$settings||!Number.isFinite(numInstances)?this.value.length:numInstances*this.size;(0,_get2["default"])((0,_getPrototypeOf2["default"])(Attribute.prototype),"updateSubBuffer",this).call(this,{startOffset,endOffset})}}catch(err){data.e(err)}finally{data.f()}}this._checkAttributeArray()}else updated=
!1;this.clearNeedsUpdate();this.setNeedsRedraw();return updated}},{key:"setConstantValue",value:function(value){if(void 0===value||"function"===typeof value)return!1;this.setData({constant:!0,value})&&this.setNeedsRedraw();this.clearNeedsUpdate();return!0}},{key:"setExternalBuffer",value:function(buffer){var state=this.state;if(!buffer)return state.lastExternalBuffer=null,!1;this.clearNeedsUpdate();if(state.lastExternalBuffer===buffer)return!0;state.lastExternalBuffer=buffer;this.setNeedsRedraw();
this.setData(buffer);return!0}},{key:"setBinaryValue",value:function(buffer){var startIndices=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,state=this.state,settings=this.settings;if(!buffer)return state.binaryValue=null,state.binaryAccessor=null,!1;if(settings.noAlloc)return!1;if(state.binaryValue===buffer)return this.clearNeedsUpdate(),!0;state.binaryValue=buffer;this.setNeedsRedraw();ArrayBuffer.isView(buffer)&&(buffer={value:buffer});if(settings.transform||startIndices!==this.startIndices)return(0,
_assert["default"])(ArrayBuffer.isView(buffer.value),"invalid ".concat(settings.accessor)),settings=buffer.size&&buffer.size!==this.size,state.binaryAccessor=(0,_iterableUtils.getAccessorFromBuffer)(buffer.value,{size:buffer.size||this.size,stride:buffer.stride,offset:buffer.offset,startIndices,nested:settings}),!1;this.clearNeedsUpdate();this.setData(buffer);return!0}},{key:"getVertexOffset",value:function(row){var startIndices=this.startIndices;return(startIndices?startIndices[row]:row)*this.size}},
{key:"getShaderAttributes",value:function(){var shaderAttributeDefs=this.settings.shaderAttributes||(0,_defineProperty2["default"])({},this.id,null),shaderAttributes={},shaderAttributeName;for(shaderAttributeName in shaderAttributeDefs)Object.assign(shaderAttributes,(0,_get2["default"])((0,_getPrototypeOf2["default"])(Attribute.prototype),"getShaderAttributes",this).call(this,shaderAttributeName,shaderAttributeDefs[shaderAttributeName]));return shaderAttributes}},{key:"_autoUpdater",value:function(attribute,
_ref4){var data=_ref4.data,startRow=_ref4.startRow,endRow=_ref4.endRow,props=_ref4.props;_ref4=_ref4.numInstances;if(!attribute.constant){var settings=attribute.settings,value=attribute.value,size=attribute.size,startIndices=attribute.startIndices,accessor=settings.accessor;settings=settings.transform;props=attribute.state.binaryAccessor||("function"===typeof accessor?accessor:props[accessor]);(0,_assert["default"])("function"===typeof props,'accessor "'.concat(accessor,'" is not a function'));accessor=
attribute.getVertexOffset(startRow);startRow=(0,_iterableUtils.createIterable)(data,startRow,endRow);data=startRow.objectInfo;startRow=_createForOfIteratorHelper(startRow.iterable);var _step3;try{for(startRow.s();!(_step3=startRow.n()).done;){var object=_step3.value;data.index++;var objectValue=props(object,data);settings&&(objectValue=settings.call(this,objectValue));if(startIndices){var numVertices=(data.index<startIndices.length-1?startIndices[data.index+1]:_ref4)-startIndices[data.index];if(objectValue&&
Array.isArray(objectValue[0])){endRow=accessor;var _iterator4=_createForOfIteratorHelper(objectValue),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;)attribute._normalizeValue(_step4.value,value,endRow),endRow+=size}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}else objectValue&&objectValue.length>size?value.set(objectValue,accessor):(attribute._normalizeValue(objectValue,data.target,0),(0,_flatten.fillArray)({target:value,source:data.target,start:accessor,count:numVertices}));
accessor+=numVertices*size}else attribute._normalizeValue(objectValue,value,accessor),accessor+=size}}catch(err){startRow.e(err)}finally{startRow.f()}}}},{key:"_validateAttributeUpdaters",value:function(){var settings=this.settings;if(!settings.noAlloc&&"function"!==typeof settings.update)throw Error("Attribute ".concat(this.id," missing update or accessor"));}},{key:"_checkAttributeArray",value:function(){var value=this.value,limit=Math.min(4,this.size);if(value&&value.length>=limit){var valid=!0;
switch(limit){case 4:valid=valid&&Number.isFinite(value[3]);case 3:valid=valid&&Number.isFinite(value[2]);case 2:valid=valid&&Number.isFinite(value[1]);case 1:valid=valid&&Number.isFinite(value[0]);break;default:valid=!1}if(!valid)throw Error("Illegal attribute generated for ".concat(this.id));}}},{key:"startIndices",get:function(){return this.state.startIndices},set:function(layout){this.state.startIndices=layout}}]);return Attribute}(_dataColumn["default"]);exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$attribute.js.map
