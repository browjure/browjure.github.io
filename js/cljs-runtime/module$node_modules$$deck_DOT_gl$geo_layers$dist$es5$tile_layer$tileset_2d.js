shadow$provide.module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_layer$tileset_2d=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function getPlaceholderInChildren(tile){tile=
_createForOfIteratorHelper(tile.children);var _step10;try{for(tile.s();!(_step10=tile.n()).done;){var child=_step10.value;child.state=Math.max(child.state,3);child.isLoaded||getPlaceholderInChildren(child)}}catch(err){tile.e(err)}finally{tile.f()}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=exports.STRATEGY_DEFAULT=exports.STRATEGY_REPLACE=exports.STRATEGY_NEVER=void 0;var _slicedToArray2=
global(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_tile2dHeader=global(require("module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_layer$tile_2d_header")),_utils=require("module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_layer$utils"),_loaderUtils=require("module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$index"),
_math=require("module$node_modules$math_DOT_gl$dist$es5$index");exports.STRATEGY_NEVER="never";exports.STRATEGY_REPLACE="no-overlap";exports.STRATEGY_DEFAULT="best-available";require=function(){function Tileset2D(opts){var _this=this;(0,_classCallCheck2["default"])(this,Tileset2D);this.opts=opts;this._getTileData=opts.getTileData;this.onTileError=opts.onTileError;this.onTileLoad=function(tile){opts.onTileLoad(tile);_this.opts.maxCacheByteSize&&(_this._cacheByteSize+=tile.byteLength,_this._resizeCache())};
this.onTileUnload=opts.onTileUnload;this._requestScheduler=new _loaderUtils.RequestScheduler({maxRequests:opts.maxRequests,throttleRequests:0<opts.maxRequests});this._cache=new Map;this._tiles=[];this._dirty=!1;this._cacheByteSize=0;this._selectedTiles=this._viewport=null;this._frameNumber=0;this.setOptions(opts)}(0,_createClass2["default"])(Tileset2D,[{key:"setOptions",value:function(opts){Object.assign(this.opts,opts);Number.isFinite(opts.maxZoom)&&(this._maxZoom=Math.floor(opts.maxZoom));Number.isFinite(opts.minZoom)&&
(this._minZoom=Math.ceil(opts.minZoom))}},{key:"finalize",value:function(){var _iterator=_createForOfIteratorHelper(this._cache.values()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var tile=_step.value;tile.isLoading&&tile.abort()}}catch(err){_iterator.e(err)}finally{_iterator.f()}}},{key:"update",value:function(viewport){var _this2=this,_ref=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},zRange=_ref.zRange;_ref=_ref.modelMatrix;var modelMatrixAsMatrix4=new _math.Matrix4(_ref),
isModelMatrixNew=!modelMatrixAsMatrix4.equals(this._modelMatrix);if(!viewport.equals(this._viewport)||isModelMatrixNew)isModelMatrixNew&&(this._modelMatrixInverse=_ref&&modelMatrixAsMatrix4.clone().invert(),this._modelMatrix=_ref&&modelMatrixAsMatrix4),this._viewport=viewport,this._selectedTiles=this.getTileIndices({viewport,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse}).map(function(index){return _this2._getTile(index,
!0)}),this._dirty&&this._rebuildTree();zRange=this.updateTileStates();this._dirty&&this._resizeCache();zRange&&this._frameNumber++;return this._frameNumber}},{key:"getTileIndices",value:function(_ref2){var viewport=_ref2.viewport,maxZoom=_ref2.maxZoom,minZoom=_ref2.minZoom,zRange=_ref2.zRange,modelMatrix=_ref2.modelMatrix;_ref2=_ref2.modelMatrixInverse;var _this$opts=this.opts,tileSize=_this$opts.tileSize;_this$opts=_this$opts.extent;return(0,_utils.getTileIndices)({viewport,maxZoom,minZoom,zRange,
tileSize,extent:_this$opts,modelMatrix,modelMatrixInverse:_ref2})}},{key:"getTileMetadata",value:function(_ref3){var x=_ref3.x,y=_ref3.y;_ref3=_ref3.z;return{bbox:(0,_utils.tileToBoundingBox)(this._viewport,x,y,_ref3)}}},{key:"getParentIndex",value:function(tileIndex){tileIndex.x=Math.floor(tileIndex.x/2);tileIndex.y=Math.floor(tileIndex.y/2);--tileIndex.z;return tileIndex}},{key:"updateTileStates",value:function(){this._updateTileStates(this.selectedTiles);var maxRequests=this.opts.maxRequests,abortCandidates=
[],ongoingRequestCount=0,changed=!1,_iterator2=_createForOfIteratorHelper(this._cache.values()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _tile=_step2.value,isVisible=!!(_tile.state&1);_tile.isVisible!==isVisible&&(changed=!0,_tile.isVisible=isVisible);_tile.isSelected=5===_tile.state;_tile.isLoading&&(ongoingRequestCount++,_tile.isSelected||abortCandidates.push(_tile))}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}if(0<maxRequests)for(;ongoingRequestCount>maxRequests&&
0<abortCandidates.length;)abortCandidates.shift().abort(),ongoingRequestCount--;return changed}},{key:"_rebuildTree",value:function(){var _cache=this._cache,_iterator3=_createForOfIteratorHelper(_cache.values()),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var tile=_step3.value;tile.parent=null;tile.children.length=0}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}_cache=_createForOfIteratorHelper(_cache.values());var _step4;try{for(_cache.s();!(_step4=_cache.n()).done;){var _tile2=
_step4.value,parent=this._getNearestAncestor(_tile2.x,_tile2.y,_tile2.z);(_tile2.parent=parent)&&parent.children.push(_tile2)}}catch(err){_cache.e(err)}finally{_cache.f()}}},{key:"_updateTileStates",value:function(selectedTiles){var refinementStrategy=this.opts.refinementStrategy||"best-available",_iterator5=_createForOfIteratorHelper(this._cache.values()),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;)_step5.value.state=0}catch(err){_iterator5.e(err)}finally{_iterator5.f()}_iterator5=
_createForOfIteratorHelper(selectedTiles);var _step6;try{for(_iterator5.s();!(_step6=_iterator5.n()).done;)_step6.value.state=5}catch(err){_iterator5.e(err)}finally{_iterator5.f()}if("never"!==refinementStrategy){_step6=_createForOfIteratorHelper(selectedTiles);var _step7;try{for(_step6.s();!(_step7=_step6.n()).done;)a:{_iterator5=void 0;var tile=_step7.value;_step5=refinementStrategy;for(var state=3;_iterator5=tile.parent;){if(tile.isLoaded&&(state=4,"best-available"===_step5))break a;_iterator5.state=
Math.max(_iterator5.state,state);tile=_iterator5}}}catch(err){_step6.e(err)}finally{_step6.f()}selectedTiles=_createForOfIteratorHelper(selectedTiles);var _step8;try{for(selectedTiles.s();!(_step8=selectedTiles.n()).done;){var _tile5=_step8.value;a:{for(refinementStrategy=_tile5;refinementStrategy;){if(refinementStrategy.state&0){var JSCompiler_inline_result=!0;break a}if(refinementStrategy.isLoaded){JSCompiler_inline_result=!1;break a}refinementStrategy=refinementStrategy.parent}JSCompiler_inline_result=
!0}JSCompiler_inline_result&&getPlaceholderInChildren(_tile5)}}catch(err){selectedTiles.e(err)}finally{selectedTiles.f()}}}},{key:"_resizeCache",value:function(){var _cache=this._cache,opts=this.opts,maxCacheSize=opts.maxCacheSize||(opts.maxCacheByteSize?Infinity:5*this.selectedTiles.length),maxCacheByteSize=opts.maxCacheByteSize||Infinity;if(_cache.size>maxCacheSize||this._cacheByteSize>maxCacheByteSize){var _iterator9=_createForOfIteratorHelper(_cache),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var _step9$value=
(0,_slicedToArray2["default"])(_step9.value,2),tileId=_step9$value[0],tile=_step9$value[1];tile.isVisible||(this._cacheByteSize-=opts.maxCacheByteSize?tile.byteLength:0,_cache["delete"](tileId),this.onTileUnload(tile));if(_cache.size<=maxCacheSize&&this._cacheByteSize<=maxCacheByteSize)break}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}this._rebuildTree();this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort(function(t1,t2){return t1.z-t2.z}),this._dirty=!1)}},{key:"_getTile",
value:function(_ref4,create){var x=_ref4.x,y=_ref4.y;_ref4=_ref4.z;var tileId="".concat(x,",").concat(y,",").concat(_ref4),tile=this._cache.get(tileId);!tile&&create?(tile=new _tile2dHeader["default"]({x,y,z:_ref4,onTileLoad:this.onTileLoad,onTileError:this.onTileError}),Object.assign(tile,this.getTileMetadata(tile)),tile.loadData(this._getTileData,this._requestScheduler),this._cache.set(tileId,tile),this._dirty=!0):tile&&tile.isCancelled&&!tile.isLoading&&tile.loadData(this._getTileData,this._requestScheduler);
return tile}},{key:"_getNearestAncestor",value:function(x,y,z){var _this$_minZoom=this._minZoom;_this$_minZoom=void 0===_this$_minZoom?0:_this$_minZoom;for(x={x,y,z};x.z>_this$_minZoom;)if(x=this.getParentIndex(x),y=this._getTile(x))return y;return null}},{key:"tiles",get:function(){return this._tiles}},{key:"selectedTiles",get:function(){return this._selectedTiles}},{key:"isLoaded",get:function(){return this._selectedTiles.every(function(tile){return tile.isLoaded})}}]);return Tileset2D}();exports["default"]=
require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$geo_layers$dist$es5$tile_layer$tileset_2d.js.map
