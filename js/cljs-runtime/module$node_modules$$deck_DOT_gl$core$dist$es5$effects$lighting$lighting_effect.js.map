{
"version":3,
"file":"module$node_modules$$deck_DOT_gl$core$dist$es5$effects$lighting$lighting_effect.js",
"lineCount":15,
"mappings":"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",
"sources":["node_modules/@deck_DOT_gl/core/dist/es5/effects/lighting/lighting-effect.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$deck_DOT_gl$core$dist$es5$effects$lighting$lighting_effect\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _core = require(\"@luma.gl/core\");\n\nvar _ambientLight = require(\"./ambient-light\");\n\nvar _directionalLight = require(\"./directional-light\");\n\nvar _effect = _interopRequireDefault(require(\"../../lib/effect\"));\n\nvar _math = require(\"math.gl\");\n\nvar _shadowPass = _interopRequireDefault(require(\"../../passes/shadow-pass\"));\n\nvar _shadow = _interopRequireDefault(require(\"../../shaderlib/shadow/shadow\"));\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2[\"default\"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2[\"default\"])(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nvar DEFAULT_AMBIENT_LIGHT_PROPS = {\n  color: [255, 255, 255],\n  intensity: 1.0\n};\nvar DEFAULT_DIRECTIONAL_LIGHT_PROPS = [{\n  color: [255, 255, 255],\n  intensity: 1.0,\n  direction: [-1, 3, -1]\n}, {\n  color: [255, 255, 255],\n  intensity: 0.9,\n  direction: [1, -8, -2.5]\n}];\nvar DEFAULT_SHADOW_COLOR = [0, 0, 0, 200 / 255];\n\nvar LightingEffect = function (_Effect) {\n  (0, _inherits2[\"default\"])(LightingEffect, _Effect);\n\n  var _super = _createSuper(LightingEffect);\n\n  function LightingEffect(props) {\n    var _this;\n\n    (0, _classCallCheck2[\"default\"])(this, LightingEffect);\n    _this = _super.call(this, props);\n    _this.ambientLight = null;\n    _this.directionalLights = [];\n    _this.pointLights = [];\n    _this.shadowColor = DEFAULT_SHADOW_COLOR;\n    _this.shadowPasses = [];\n    _this.shadowMaps = [];\n    _this.dummyShadowMap = null;\n    _this.shadow = false;\n    _this.programManager = null;\n\n    for (var key in props) {\n      var lightSource = props[key];\n\n      switch (lightSource.type) {\n        case 'ambient':\n          _this.ambientLight = lightSource;\n          break;\n\n        case 'directional':\n          _this.directionalLights.push(lightSource);\n\n          break;\n\n        case 'point':\n          _this.pointLights.push(lightSource);\n\n          break;\n\n        default:\n      }\n    }\n\n    _this._applyDefaultLights();\n\n    _this.shadow = _this.directionalLights.some(function (light) {\n      return light.shadow;\n    });\n    return _this;\n  }\n\n  (0, _createClass2[\"default\"])(LightingEffect, [{\n    key: \"preRender\",\n    value: function preRender(gl, _ref) {\n      var layers = _ref.layers,\n          layerFilter = _ref.layerFilter,\n          viewports = _ref.viewports,\n          onViewportActive = _ref.onViewportActive,\n          views = _ref.views;\n      if (!this.shadow) return;\n      this.shadowMatrices = this._createLightMatrix();\n\n      if (this.shadowPasses.length === 0) {\n        this._createShadowPasses(gl);\n      }\n\n      if (!this.programManager) {\n        this.programManager = _core.ProgramManager.getDefaultProgramManager(gl);\n\n        if (_shadow[\"default\"]) {\n          this.programManager.addDefaultModule(_shadow[\"default\"]);\n        }\n      }\n\n      if (!this.dummyShadowMap) {\n        this.dummyShadowMap = new _core.Texture2D(gl, {\n          width: 1,\n          height: 1\n        });\n      }\n\n      for (var i = 0; i < this.shadowPasses.length; i++) {\n        var shadowPass = this.shadowPasses[i];\n        shadowPass.render({\n          layers: layers,\n          layerFilter: layerFilter,\n          viewports: viewports,\n          onViewportActive: onViewportActive,\n          views: views,\n          moduleParameters: {\n            shadowLightId: i,\n            dummyShadowMap: this.dummyShadowMap,\n            shadowMatrices: this.shadowMatrices\n          }\n        });\n      }\n    }\n  }, {\n    key: \"getModuleParameters\",\n    value: function getModuleParameters(layer) {\n      var parameters = this.shadow ? {\n        shadowMaps: this.shadowMaps,\n        dummyShadowMap: this.dummyShadowMap,\n        shadowColor: this.shadowColor,\n        shadowMatrices: this.shadowMatrices\n      } : {};\n      parameters.lightSources = {\n        ambientLight: this.ambientLight,\n        directionalLights: this.directionalLights.map(function (directionalLight) {\n          return directionalLight.getProjectedLight({\n            layer: layer\n          });\n        }),\n        pointLights: this.pointLights.map(function (pointLight) {\n          return pointLight.getProjectedLight({\n            layer: layer\n          });\n        })\n      };\n      return parameters;\n    }\n  }, {\n    key: \"cleanup\",\n    value: function cleanup() {\n      var _iterator = _createForOfIteratorHelper(this.shadowPasses),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var shadowPass = _step.value;\n          shadowPass[\"delete\"]();\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      this.shadowPasses.length = 0;\n      this.shadowMaps.length = 0;\n\n      if (this.dummyShadowMap) {\n        this.dummyShadowMap[\"delete\"]();\n        this.dummyShadowMap = null;\n      }\n\n      if (this.shadow && this.programManager) {\n        this.programManager.removeDefaultModule(_shadow[\"default\"]);\n        this.programManager = null;\n      }\n    }\n  }, {\n    key: \"_createLightMatrix\",\n    value: function _createLightMatrix() {\n      var lightMatrices = [];\n\n      var _iterator2 = _createForOfIteratorHelper(this.directionalLights),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var light = _step2.value;\n          var viewMatrix = new _math.Matrix4().lookAt({\n            eye: new _math.Vector3(light.direction).negate()\n          });\n          lightMatrices.push(viewMatrix);\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n\n      return lightMatrices;\n    }\n  }, {\n    key: \"_createShadowPasses\",\n    value: function _createShadowPasses(gl) {\n      for (var i = 0; i < this.directionalLights.length; i++) {\n        var shadowPass = new _shadowPass[\"default\"](gl);\n        this.shadowPasses[i] = shadowPass;\n        this.shadowMaps[i] = shadowPass.shadowMap;\n      }\n    }\n  }, {\n    key: \"_applyDefaultLights\",\n    value: function _applyDefaultLights() {\n      var ambientLight = this.ambientLight,\n          pointLights = this.pointLights,\n          directionalLights = this.directionalLights;\n\n      if (!ambientLight && pointLights.length === 0 && directionalLights.length === 0) {\n        this.ambientLight = new _ambientLight.AmbientLight(DEFAULT_AMBIENT_LIGHT_PROPS);\n        this.directionalLights.push(new _directionalLight.DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[0]), new _directionalLight.DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[1]));\n      }\n    }\n  }]);\n  return LightingEffect;\n}(_effect[\"default\"]);\n\nexports[\"default\"] = LightingEffect;\n//# sourceMappingURL=lighting-effect.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","step","next","_e2","minLen","_arrayLikeToArray","Object","prototype","toString","call","slice","constructor","name","from","test","arr","len","arr2","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","NewTarget","result","Reflect","construct","arguments","apply","_possibleConstructorReturn2","sham","Proxy","Date","_interopRequireDefault","defineProperty","_classCallCheck2","_createClass2","_inherits2","_core","_ambientLight","_directionalLight","_effect","_math","_shadowPass","_shadow","DEFAULT_AMBIENT_LIGHT_PROPS","color","intensity","DEFAULT_DIRECTIONAL_LIGHT_PROPS","direction","DEFAULT_SHADOW_COLOR","LightingEffect","_Effect","props","_this","_super","ambientLight","directionalLights","pointLights","shadowColor","shadowPasses","shadowMaps","dummyShadowMap","shadow","programManager","key","lightSource","type","push","_applyDefaultLights","some","light","preRender","gl","_ref","layers","layerFilter","viewports","onViewportActive","views","shadowMatrices","_createLightMatrix","_createShadowPasses","ProgramManager","getDefaultProgramManager","addDefaultModule","Texture2D","width","height","shadowPass","render","moduleParameters","shadowLightId","getModuleParameters","layer","parameters","lightSources","map","directionalLight","getProjectedLight","pointLight","cleanup","_iterator","_step","removeDefaultModule","lightMatrices","_iterator2","_step2","viewMatrix","Matrix4","lookAt","eye","Vector3","negate","shadowMap","AmbientLight","DirectionalLight"]
}
