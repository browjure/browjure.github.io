shadow$provide.module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$transform=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");
Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_shadertools=require("module$node_modules$$luma_DOT_gl$shadertools$dist$es5$index"),_bufferTransform=global(require("module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$buffer_transform")),_textureTransform=global(require("module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$texture_transform")),
_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index"),_webgl=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$index"),_model=global(require("module$node_modules$$luma_DOT_gl$engine$dist$es5$lib$model"));require=function(){function Transform(gl){var props=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,Transform);this.gl=gl;this.model=null;this.elementCount=0;this.elementIDBuffer=this.textureTransform=this.bufferTransform=
null;this._initialize(props);Object.seal(this)}(0,_createClass2["default"])(Transform,null,[{key:"isSupported",value:function(gl){return(0,_gltools.isWebGL2)(gl)}}]);(0,_createClass2["default"])(Transform,[{key:"delete",value:function(){var model=this.model,bufferTransform=this.bufferTransform,textureTransform=this.textureTransform;if(model)model["delete"]();if(bufferTransform)bufferTransform["delete"]();if(textureTransform)textureTransform["delete"]()}},{key:"run",value:function(){var opts=0<arguments.length&&
void 0!==arguments[0]?arguments[0]:{},_opts$clearRenderTarg=opts.clearRenderTarget;_opts$clearRenderTarg=void 0===_opts$clearRenderTarg?!0:_opts$clearRenderTarg;opts=this._updateDrawOptions(opts);_opts$clearRenderTarg&&opts.framebuffer&&opts.framebuffer.clear({color:!0});this.model.transform(opts)}},{key:"swap",value:function(){var swapped=!1,resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean);resourceTransforms=_createForOfIteratorHelper(resourceTransforms);var _step;
try{for(resourceTransforms.s();!(_step=resourceTransforms.n()).done;){var resourceTransform=_step.value;swapped=swapped||resourceTransform.swap()}}catch(err){resourceTransforms.e(err)}finally{resourceTransforms.f()}(0,_webgl.assert)(swapped,"Nothing to swap")}},{key:"getBuffer",value:function(){var varyingName=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(varyingName)}},{key:"getData",value:function(){var opts=0<arguments.length&&
void 0!==arguments[0]?arguments[0]:{},resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean);resourceTransforms=_createForOfIteratorHelper(resourceTransforms);var _step2;try{for(resourceTransforms.s();!(_step2=resourceTransforms.n()).done;){var data=_step2.value.getData(opts);if(data)return data}}catch(err){resourceTransforms.e(err)}finally{resourceTransforms.f()}return null}},{key:"getFramebuffer",value:function(){return this.textureTransform&&this.textureTransform.getFramebuffer()}},
{key:"update",value:function(){var opts=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};"elementCount"in opts&&this.model.setVertexCount(opts.elementCount);var resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean);resourceTransforms=_createForOfIteratorHelper(resourceTransforms);var _step3;try{for(resourceTransforms.s();!(_step3=resourceTransforms.n()).done;)_step3.value.update(opts)}catch(err){resourceTransforms.e(err)}finally{resourceTransforms.f()}}},{key:"_initialize",
value:function(){var props=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},gl=this.gl;this._buildResourceTransforms(gl,props);props=this._updateModelProps(props);this.model=new _model["default"](gl,Object.assign({},props,{fs:props.fs||(0,_shadertools.getPassthroughFS)({version:(0,_webgl.getShaderVersion)(props.vs)}),id:props.id||"transform-model",drawMode:props.drawMode||0,vertexCount:props.elementCount}));this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}},{key:"_updateModelProps",
value:function(props){props=Object.assign({},props);var resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean);resourceTransforms=_createForOfIteratorHelper(resourceTransforms);var _step4;try{for(resourceTransforms.s();!(_step4=resourceTransforms.n()).done;)props=_step4.value.updateModelProps(props)}catch(err){resourceTransforms.e(err)}finally{resourceTransforms.f()}return props}},{key:"_buildResourceTransforms",value:function(gl,props){var JSCompiler_inline_result=!(0,_webgl.isObjectEmpty)(props.feedbackBuffers)||
!(0,_webgl.isObjectEmpty)(props.feedbackMap)||props.varyings&&0<props.varyings.length?!0:!1;JSCompiler_inline_result&&(this.bufferTransform=new _bufferTransform["default"](gl,props));JSCompiler_inline_result=!(0,_webgl.isObjectEmpty)(props._sourceTextures)||props._targetTexture||props._targetTextureVarying?!0:!1;JSCompiler_inline_result&&(this.textureTransform=new _textureTransform["default"](gl,props));(0,_webgl.assert)(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}},
{key:"_updateDrawOptions",value:function(opts){opts=Object.assign({},opts);var resourceTransforms=[this.bufferTransform,this.textureTransform].filter(Boolean);resourceTransforms=_createForOfIteratorHelper(resourceTransforms);var _step5;try{for(resourceTransforms.s();!(_step5=resourceTransforms.n()).done;)opts=Object.assign(opts,_step5.value.getDrawOptions(opts))}catch(err){resourceTransforms.e(err)}finally{resourceTransforms.f()}return opts}}]);return Transform}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$engine$dist$es5$transform$transform.js.map
