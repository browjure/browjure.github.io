shadow$provide.module$node_modules$$deck_DOT_gl$layers$dist$es5$bitmap_layer$bitmap_layer=function(global,require,module,exports){function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=
null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=
(0,_getPrototypeOf2["default"])(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;Super=Reflect.construct(Super,arguments,NewTarget)}else Super=Super.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,Super)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,
[],function(){})),!0}catch(e){return!1}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _slicedToArray2=global(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),_defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=
global(require("module$node_modules$$babel$runtime$helpers$createClass")),_get2=global(require("module$node_modules$$babel$runtime$helpers$get")),_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits")),_possibleConstructorReturn2=global(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=global(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_core=require("module$node_modules$$deck_DOT_gl$core$dist$es5$index"),
_core2=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),_webMercator=require("module$node_modules$$math_DOT_gl$web_mercator$dist$es5$index"),_createMesh2=global(require("module$node_modules$$deck_DOT_gl$layers$dist$es5$bitmap_layer$create_mesh")),_bitmapLayerVertex=global(require("module$node_modules$$deck_DOT_gl$layers$dist$es5$bitmap_layer$bitmap_layer_vertex")),_bitmapLayerFragment=global(require("module$node_modules$$deck_DOT_gl$layers$dist$es5$bitmap_layer$bitmap_layer_fragment"));
require={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:_core.COORDINATE_SYSTEM.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};global=function(_Layer){function BitmapLayer(){(0,_classCallCheck2["default"])(this,BitmapLayer);return _super.apply(this,arguments)}(0,_inherits2["default"])(BitmapLayer,_Layer);var _super=_createSuper(BitmapLayer);
(0,_createClass2["default"])(BitmapLayer,[{key:"getShaders",value:function(){return(0,_get2["default"])((0,_getPrototypeOf2["default"])(BitmapLayer.prototype),"getShaders",this).call(this,{vs:_bitmapLayerVertex["default"],fs:_bitmapLayerFragment["default"],modules:[_core.project32,_core.picking]})}},{key:"initializeState",value:function(){var _this=this,attributeManager=this.getAttributeManager();attributeManager.remove(["instancePickingColors"]);attributeManager.add({indices:{size:1,isIndexed:!0,
update:function(attribute){return attribute.value=_this.state.mesh.indices},noAlloc:!0},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:function(attribute){return attribute.value=_this.state.mesh.positions},noAlloc:!0},texCoords:{size:2,update:function(attribute){return attribute.value=_this.state.mesh.texCoords},noAlloc:!0}})}},{key:"updateState",value:function(_ref){var props=_ref.props,oldProps=_ref.oldProps;if(_ref.changeFlags.extensionsChanged){_ref=this.context.gl;if(this.state.model)this.state.model["delete"]();
this.setState({model:this._getModel(_ref)});this.getAttributeManager().invalidateAll()}_ref=this.getAttributeManager();if(props.bounds!==oldProps.bounds){props=this.state.mesh;oldProps=this._createMesh();this.state.model.setVertexCount(oldProps.vertexCount);for(var key in oldProps)props&&props[key]!==oldProps[key]&&_ref.invalidate(key);this.setState(_objectSpread({mesh:oldProps},this._getCoordinateUniforms()))}else props._imageCoordinateSystem!==oldProps._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}},
{key:"getPickingInfo",value:function(_ref2){_ref2=_ref2.info;var image=this.props.image;if(!_ref2.color||!image)return _ref2.bitmap=null,_ref2;var width=image.width;image=image.height;_ref2.index=0;var uv=_ref2.color;uv=(0,_slicedToArray2["default"])(uv,3);var fracUV=uv[2];uv=[(uv[0]+(fracUV&15)/16)/256,(uv[1]+(fracUV&240)/256)/256];_ref2.bitmap={size:{width,height:image},uv,pixel:[Math.floor(uv[0]*width),Math.floor(uv[1]*image)]};return _ref2}},{key:"_createMesh",value:function(){var bounds=this.props.bounds,
normalizedBounds=bounds;Number.isFinite(bounds[0])&&(normalizedBounds=[[bounds[0],bounds[1]],[bounds[0],bounds[3]],[bounds[2],bounds[3]],[bounds[2],bounds[1]]]);return(0,_createMesh2["default"])(normalizedBounds,this.context.viewport.resolution)}},{key:"_getModel",value:function(gl){return gl?new _core2.Model(gl,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new _core2.Geometry({drawMode:4,vertexCount:6}),isInstanced:!1})):null}},{key:"draw",value:function(opts){opts=opts.uniforms;
var _this$state=this.state,model=_this$state.model,coordinateConversion=_this$state.coordinateConversion;_this$state=_this$state.bounds;var _this$props=this.props,image=_this$props.image,desaturate=_this$props.desaturate,transparentColor=_this$props.transparentColor;_this$props=_this$props.tintColor;image&&model&&model.setUniforms(opts).setUniforms({bitmapTexture:image,desaturate,transparentColor:transparentColor.map(function(x){return x/255}),tintColor:_this$props.slice(0,3).map(function(x){return x/
255}),coordinateConversion,bounds:_this$state}).draw()}},{key:"_getCoordinateUniforms",value:function(){var LNGLAT=_core.COORDINATE_SYSTEM.LNGLAT,CARTESIAN=_core.COORDINATE_SYSTEM.CARTESIAN,imageCoordinateSystem=this.props._imageCoordinateSystem;if(imageCoordinateSystem!==_core.COORDINATE_SYSTEM.DEFAULT){var bounds=this.props.bounds;if(!Number.isFinite(bounds[0]))throw Error("_imageCoordinateSystem only supports rectangular bounds");var defaultImageCoordinateSystem=this.context.viewport.resolution?
LNGLAT:CARTESIAN;imageCoordinateSystem=imageCoordinateSystem===LNGLAT?LNGLAT:CARTESIAN;if(imageCoordinateSystem===LNGLAT&&defaultImageCoordinateSystem===CARTESIAN)return{coordinateConversion:-1,bounds};if(imageCoordinateSystem===CARTESIAN&&defaultImageCoordinateSystem===LNGLAT)return LNGLAT=(0,_webMercator.lngLatToWorld)([bounds[0],bounds[1]]),bounds=(0,_webMercator.lngLatToWorld)([bounds[2],bounds[3]]),{coordinateConversion:1,bounds:[LNGLAT[0],LNGLAT[1],bounds[0],bounds[1]]}}return{coordinateConversion:0,
bounds:[0,0,0,0]}}}]);return BitmapLayer}(_core.Layer);exports["default"]=global;global.layerName="BitmapLayer";global.defaultProps=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$layers$dist$es5$bitmap_layer$bitmap_layer.js.map
