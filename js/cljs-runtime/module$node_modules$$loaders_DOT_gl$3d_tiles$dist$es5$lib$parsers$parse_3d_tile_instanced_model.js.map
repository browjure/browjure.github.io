{
"version":3,
"file":"module$node_modules$$loaders_DOT_gl$3d_tiles$dist$es5$lib$parsers$parse_3d_tile_instanced_model.js",
"lineCount":15,
"mappings":"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",
"sources":["node_modules/@loaders_DOT_gl/3d-tiles/dist/es5/lib/parsers/parse-3d-tile-instanced-model.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$loaders_DOT_gl$3d_tiles$dist$es5$lib$parsers$parse_3d_tile_instanced_model\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.parseInstancedModel3DTile = parseInstancedModel3DTile;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _core = require(\"@math.gl/core\");\n\nvar _geospatial = require(\"@math.gl/geospatial\");\n\nvar _math = require(\"@loaders.gl/math\");\n\nvar _tile3dFeatureTable = _interopRequireDefault(require(\"../classes/tile-3d-feature-table\"));\n\nvar _tile3dBatchTable = _interopRequireDefault(require(\"../classes/tile-3d-batch-table\"));\n\nvar _parse3dTileHeader = require(\"./helpers/parse-3d-tile-header\");\n\nvar _parse3dTileTables = require(\"./helpers/parse-3d-tile-tables\");\n\nvar _parse3dTileGltfView = require(\"./helpers/parse-3d-tile-gltf-view\");\n\nfunction parseInstancedModel3DTile(_x, _x2, _x3, _x4, _x5) {\n  return _parseInstancedModel3DTile.apply(this, arguments);\n}\n\nfunction _parseInstancedModel3DTile() {\n  _parseInstancedModel3DTile = (0, _asyncToGenerator2[\"default\"])(_regenerator[\"default\"].mark(function _callee(tile, arrayBuffer, byteOffset, options, context) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            byteOffset = parseInstancedModel(tile, arrayBuffer, byteOffset, options, context);\n            _context.next = 3;\n            return (0, _parse3dTileGltfView.extractGLTF)(tile, tile.gltfFormat, options, context);\n\n          case 3:\n            return _context.abrupt(\"return\", byteOffset);\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _parseInstancedModel3DTile.apply(this, arguments);\n}\n\nfunction parseInstancedModel(tile, arrayBuffer, byteOffset, options, context) {\n  byteOffset = (0, _parse3dTileHeader.parse3DTileHeaderSync)(tile, arrayBuffer, byteOffset);\n\n  if (tile.version !== 1) {\n    throw new Error(\"Instanced 3D Model version \".concat(tile.version, \" is not supported\"));\n  }\n\n  byteOffset = (0, _parse3dTileTables.parse3DTileTablesHeaderSync)(tile, arrayBuffer, byteOffset);\n  var view = new DataView(arrayBuffer);\n  tile.gltfFormat = view.getUint32(byteOffset, true);\n  byteOffset += 4;\n  byteOffset = (0, _parse3dTileTables.parse3DTileTablesSync)(tile, arrayBuffer, byteOffset, options);\n  byteOffset = (0, _parse3dTileGltfView.parse3DTileGLTFViewSync)(tile, arrayBuffer, byteOffset, options);\n\n  if (tile.featureTableJsonByteLength === 0) {\n    throw new Error('i3dm parser: featureTableJsonByteLength is zero.');\n  }\n\n  var featureTable = new _tile3dFeatureTable[\"default\"](tile.featureTableJson, tile.featureTableBinary);\n  var instancesLength = featureTable.getGlobalProperty('INSTANCES_LENGTH');\n  featureTable.featuresLength = instancesLength;\n\n  if (!Number.isFinite(instancesLength)) {\n    throw new Error('i3dm parser: INSTANCES_LENGTH must be defined');\n  }\n\n  tile.eastNorthUp = featureTable.getGlobalProperty('EAST_NORTH_UP');\n  tile.rtcCenter = featureTable.getGlobalProperty('RTC_CENTER', _math.GL.FLOAT, 3);\n  var batchTable = new _tile3dBatchTable[\"default\"](tile.batchTableJson, tile.batchTableBinary, instancesLength);\n  extractInstancedAttributes(tile, featureTable, batchTable, instancesLength);\n  return byteOffset;\n}\n\nfunction extractInstancedAttributes(tile, featureTable, batchTable, instancesLength) {\n  var collectionOptions = {\n    instances: new Array(instancesLength),\n    batchTable: tile._batchTable,\n    cull: false,\n    url: undefined,\n    gltf: undefined,\n    basePath: undefined,\n    incrementallyLoadTextures: false,\n    forwardAxis: [1, 0, 0]\n  };\n  var instances = collectionOptions.instances;\n  var instancePosition = new _core.Vector3();\n  var instanceNormalRight = new _core.Vector3();\n  var instanceNormalUp = new _core.Vector3();\n  var instanceNormalForward = new _core.Vector3();\n  var instanceRotation = new _core.Matrix3();\n  var instanceQuaternion = new _core.Quaternion();\n  var instanceScale = new _core.Vector3();\n  var instanceTranslationRotationScale = {};\n  var instanceTransform = new _core.Matrix4();\n  var scratch1 = [];\n  var scratch2 = [];\n  var scratchVector1 = new _core.Vector3();\n  var scratchVector2 = new _core.Vector3();\n\n  for (var i = 0; i < instancesLength; i++) {\n    var position = void 0;\n\n    if (featureTable.hasProperty('POSITION')) {\n      position = featureTable.getProperty('POSITION', _math.GL.FLOAT, 3, i, instancePosition);\n    } else if (featureTable.hasProperty('POSITION_QUANTIZED')) {\n      position = featureTable.getProperty('POSITION_QUANTIZED', _math.GL.UNSIGNED_SHORT, 3, i, instancePosition);\n      var quantizedVolumeOffset = featureTable.getGlobalProperty('QUANTIZED_VOLUME_OFFSET', _math.GL.FLOAT, 3, scratchVector1);\n\n      if (!quantizedVolumeOffset) {\n        throw new Error('i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.');\n      }\n\n      var quantizedVolumeScale = featureTable.getGlobalProperty('QUANTIZED_VOLUME_SCALE', _math.GL.FLOAT, 3, scratchVector2);\n\n      if (!quantizedVolumeScale) {\n        throw new Error('i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.');\n      }\n\n      var MAX_UNSIGNED_SHORT = 65535.0;\n\n      for (var j = 0; j < 3; j++) {\n        position[j] = position[j] / MAX_UNSIGNED_SHORT * quantizedVolumeScale[j] + quantizedVolumeOffset[j];\n      }\n    }\n\n    if (!position) {\n      throw new Error('i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.');\n    }\n\n    instancePosition.copy(position);\n    instanceTranslationRotationScale.translation = instancePosition;\n    tile.normalUp = featureTable.getProperty('NORMAL_UP', _math.GL.FLOAT, 3, i, scratch1);\n    tile.normalRight = featureTable.getProperty('NORMAL_RIGHT', _math.GL.FLOAT, 3, i, scratch2);\n    var hasCustomOrientation = false;\n\n    if (tile.normalUp) {\n      if (!tile.normalRight) {\n        throw new Error('i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.');\n      }\n\n      tile.hasCustomOrientation = true;\n    } else {\n      tile.octNormalUp = featureTable.getProperty('NORMAL_UP_OCT32P', _math.GL.UNSIGNED_SHORT, 2, scratch1);\n      tile.octNormalRight = featureTable.getProperty('NORMAL_RIGHT_OCT32P', _math.GL.UNSIGNED_SHORT, 2, scratch2);\n\n      if (tile.octNormalUp) {\n        if (!tile.octNormalRight) {\n          throw new Error('i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P');\n        }\n\n        throw new Error('i3dm: oct-encoded orientation not implemented');\n      } else if (tile.eastNorthUp) {\n        _geospatial.Ellipsoid.WGS84.eastNorthUpToFixedFrame(instancePosition, instanceTransform);\n\n        instanceTransform.getRotationMatrix3(instanceRotation);\n      } else {\n        instanceRotation.identity();\n      }\n    }\n\n    if (hasCustomOrientation) {\n      instanceNormalForward.copy(instanceNormalRight).cross(instanceNormalUp).normalize();\n      instanceRotation.setColumn(0, instanceNormalRight);\n      instanceRotation.setColumn(1, instanceNormalUp);\n      instanceRotation.setColumn(2, instanceNormalForward);\n    }\n\n    instanceQuaternion.fromMatrix3(instanceRotation);\n    instanceTranslationRotationScale.rotation = instanceQuaternion;\n    instanceScale.set(1.0, 1.0, 1.0);\n    var scale = featureTable.getProperty('SCALE', _math.GL.FLOAT, 1, i);\n\n    if (Number.isFinite(scale)) {\n      instanceScale.multiplyByScalar(scale);\n    }\n\n    var nonUniformScale = featureTable.getProperty('SCALE_NON_UNIFORM', _math.GL.FLOAT, 3, i, scratch1);\n\n    if (nonUniformScale) {\n      instanceScale.scale(nonUniformScale);\n    }\n\n    instanceTranslationRotationScale.scale = instanceScale;\n    var batchId = featureTable.getProperty('BATCH_ID', _math.GL.UNSIGNED_SHORT, 1, i);\n\n    if (batchId === undefined) {\n      batchId = i;\n    }\n\n    var rotationMatrix = new _core.Matrix4().fromQuaternion(instanceTranslationRotationScale.rotation);\n    instanceTransform.identity();\n    instanceTransform.translate(instanceTranslationRotationScale.translation);\n    instanceTransform.multiplyRight(rotationMatrix);\n    instanceTransform.scale(instanceTranslationRotationScale.scale);\n    var modelMatrix = instanceTransform.clone();\n    instances[i] = {\n      modelMatrix: modelMatrix,\n      batchId: batchId\n    };\n  }\n\n  tile.instances = instances;\n}\n//# sourceMappingURL=parse-3d-tile-instanced-model.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","_parseInstancedModel3DTile","_asyncToGenerator2","_regenerator","mark","_callee","tile","arrayBuffer","byteOffset","options","context","wrap","_callee$","_context","prev","next","_parse3dTileHeader","parse3DTileHeaderSync","version","Error","concat","_parse3dTileTables","parse3DTileTablesHeaderSync","view","DataView","gltfFormat","getUint32","parse3DTileTablesSync","_parse3dTileGltfView","parse3DTileGLTFViewSync","featureTableJsonByteLength","featureTable","_tile3dFeatureTable","featureTableJson","featureTableBinary","instancesLength","getGlobalProperty","featuresLength","Number","isFinite","eastNorthUp","rtcCenter","_math","GL","FLOAT","_tile3dBatchTable","batchTableJson","batchTableBinary","instances","Array","instancePosition","_core","Vector3","instanceRotation","Matrix3","instanceQuaternion","Quaternion","instanceScale","instanceTransform","Matrix4","scratch1","scratch2","scratchVector1","scratchVector2","i","position","hasProperty","getProperty","UNSIGNED_SHORT","quantizedVolumeOffset","quantizedVolumeScale","j","MAX_UNSIGNED_SHORT","copy","translation","normalUp","normalRight","hasCustomOrientation","octNormalUp","octNormalRight","_geospatial","Ellipsoid","WGS84","eastNorthUpToFixedFrame","getRotationMatrix3","identity","fromMatrix3","rotation","set","scale","multiplyByScalar","nonUniformScale","batchId","undefined","rotationMatrix","fromQuaternion","translate","multiplyRight","modelMatrix","clone","extractGLTF","abrupt","stop","apply","arguments","_interopRequireDefault","Object","defineProperty","value","parseInstancedModel3DTile","_x","_x2","_x3","_x4","_x5"]
}
