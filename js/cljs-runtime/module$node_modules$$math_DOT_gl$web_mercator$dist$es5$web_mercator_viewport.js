shadow$provide.module$node_modules$$math_DOT_gl$web_mercator$dist$es5$web_mercator_viewport=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _toConsumableArray2=module(require("module$node_modules$$babel$runtime$helpers$toConsumableArray")),_slicedToArray2=module(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),
_classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),_mathUtils=require("module$node_modules$$math_DOT_gl$web_mercator$dist$es5$math_utils"),_webMercatorUtils=require("module$node_modules$$math_DOT_gl$web_mercator$dist$es5$web_mercator_utils"),_fitBounds3=module(require("module$node_modules$$math_DOT_gl$web_mercator$dist$es5$fit_bounds")),_getBounds=module(require("module$node_modules$$math_DOT_gl$web_mercator$dist$es5$get_bounds")),
mat4=global(require("module$node_modules$gl_matrix$cjs$mat4")),vec2=global(require("module$node_modules$gl_matrix$cjs$vec2"));require=function(){function WebMercatorViewport(){var _ref=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{width:1,height:1},width=_ref.width,height=_ref.height,_ref$latitude=_ref.latitude;_ref$latitude=void 0===_ref$latitude?0:_ref$latitude;var _ref$longitude=_ref.longitude;_ref$longitude=void 0===_ref$longitude?0:_ref$longitude;var _ref$zoom=_ref.zoom;_ref$zoom=void 0===
_ref$zoom?0:_ref$zoom;var _ref$pitch=_ref.pitch;_ref$pitch=void 0===_ref$pitch?0:_ref$pitch;var _ref$bearing=_ref.bearing;_ref$bearing=void 0===_ref$bearing?0:_ref$bearing;var _ref$altitude=_ref.altitude;_ref$altitude=void 0===_ref$altitude?1.5:_ref$altitude;var _ref$nearZMultiplier=_ref.nearZMultiplier;_ref$nearZMultiplier=void 0===_ref$nearZMultiplier?.02:_ref$nearZMultiplier;_ref=_ref.farZMultiplier;_ref=void 0===_ref?1.01:_ref;(0,_classCallCheck2["default"])(this,WebMercatorViewport);width=width||
1;height=height||1;var scale=(0,_webMercatorUtils.zoomToScale)(_ref$zoom);_ref$altitude=Math.max(.75,_ref$altitude);var center=(0,_webMercatorUtils.lngLatToWorld)([_ref$longitude,_ref$latitude]);center[2]=0;this.projectionMatrix=(0,_webMercatorUtils.getProjectionMatrix)({width,height,pitch:_ref$pitch,altitude:_ref$altitude,nearZMultiplier:_ref$nearZMultiplier,farZMultiplier:_ref});this.viewMatrix=(0,_webMercatorUtils.getViewMatrix)({height,scale,center,pitch:_ref$pitch,bearing:_ref$bearing,altitude:_ref$altitude});
this.width=width;this.height=height;this.scale=scale;this.latitude=_ref$latitude;this.longitude=_ref$longitude;this.zoom=_ref$zoom;this.pitch=_ref$pitch;this.bearing=_ref$bearing;this.altitude=_ref$altitude;this.center=center;this.distanceScales=(0,_webMercatorUtils.getDistanceScales)(this);this._initMatrices();this.equals=this.equals.bind(this);this.project=this.project.bind(this);this.unproject=this.unproject.bind(this);this.projectPosition=this.projectPosition.bind(this);this.unprojectPosition=
this.unprojectPosition.bind(this);Object.freeze(this)}(0,_createClass2["default"])(WebMercatorViewport,[{key:"_initMatrices",value:function(){var width=this.width,height=this.height,projectionMatrix=this.projectionMatrix,viewMatrix=this.viewMatrix,vpm=(0,_mathUtils.createMat4)();mat4.multiply(vpm,vpm,projectionMatrix);mat4.multiply(vpm,vpm,viewMatrix);this.viewProjectionMatrix=vpm;projectionMatrix=(0,_mathUtils.createMat4)();mat4.scale(projectionMatrix,projectionMatrix,[width/2,-height/2,1]);mat4.translate(projectionMatrix,
projectionMatrix,[1,-1,0]);mat4.multiply(projectionMatrix,projectionMatrix,vpm);width=mat4.invert((0,_mathUtils.createMat4)(),projectionMatrix);if(!width)throw Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=projectionMatrix;this.pixelUnprojectionMatrix=width}},{key:"equals",value:function(viewport){return viewport instanceof WebMercatorViewport?viewport.width===this.width&&viewport.height===this.height&&mat4.equals(viewport.projectionMatrix,this.projectionMatrix)&&mat4.equals(viewport.viewMatrix,
this.viewMatrix):!1}},{key:"project",value:function(xyz){var _ref2$topLeft=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).topLeft;_ref2$topLeft=void 0===_ref2$topLeft?!0:_ref2$topLeft;var worldPosition=this.projectPosition(xyz);worldPosition=(0,_webMercatorUtils.worldToPixels)(worldPosition,this.pixelProjectionMatrix);var _coord=(0,_slicedToArray2["default"])(worldPosition,2),x=_coord[0];_coord=_coord[1];_ref2$topLeft=_ref2$topLeft?_coord:this.height-_coord;return 2===xyz.length?[x,_ref2$topLeft]:
[x,_ref2$topLeft,worldPosition[2]]}},{key:"unproject",value:function(xyz){var _ref3=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref3$topLeft=_ref3.topLeft,topLeft=void 0===_ref3$topLeft?!0:_ref3$topLeft;_ref3=_ref3.targetZ;_ref3=void 0===_ref3?void 0:_ref3;_ref3$topLeft=(0,_slicedToArray2["default"])(xyz,3);var x=_ref3$topLeft[0],y=_ref3$topLeft[1];_ref3$topLeft=_ref3$topLeft[2];topLeft=topLeft?y:this.height-y;y=_ref3&&_ref3*this.distanceScales.unitsPerMeter[2];topLeft=(0,_webMercatorUtils.pixelsToWorld)([x,
topLeft,_ref3$topLeft],this.pixelUnprojectionMatrix,y);topLeft=this.unprojectPosition(topLeft);y=(0,_slicedToArray2["default"])(topLeft,3);topLeft=y[0];x=y[1];y=y[2];return Number.isFinite(_ref3$topLeft)?[topLeft,x,y]:Number.isFinite(_ref3)?[topLeft,x,_ref3]:[topLeft,x]}},{key:"projectPosition",value:function(xyz){var _lngLatToWorld=(0,_webMercatorUtils.lngLatToWorld)(xyz);_lngLatToWorld=(0,_slicedToArray2["default"])(_lngLatToWorld,2);return[_lngLatToWorld[0],_lngLatToWorld[1],(xyz[2]||0)*this.distanceScales.unitsPerMeter[2]]}},
{key:"unprojectPosition",value:function(xyz){var _worldToLngLat=(0,_webMercatorUtils.worldToLngLat)(xyz);_worldToLngLat=(0,_slicedToArray2["default"])(_worldToLngLat,2);return[_worldToLngLat[0],_worldToLngLat[1],(xyz[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(lngLat){return(0,_webMercatorUtils.lngLatToWorld)(lngLat)}},{key:"unprojectFlat",value:function(xy){return(0,_webMercatorUtils.worldToLngLat)(xy)}},{key:"getMapCenterByLngLatPosition",value:function(_ref4){var lngLat=
_ref4.lngLat;_ref4=_ref4.pos;_ref4=(0,_webMercatorUtils.pixelsToWorld)(_ref4,this.pixelUnprojectionMatrix);lngLat=(0,_webMercatorUtils.lngLatToWorld)(lngLat);lngLat=vec2.add([],lngLat,vec2.negate([],_ref4));lngLat=vec2.add([],this.center,lngLat);return(0,_webMercatorUtils.worldToLngLat)(lngLat)}},{key:"getLocationAtPoint",value:function(_ref5){return this.getMapCenterByLngLatPosition({lngLat:_ref5.lngLat,pos:_ref5.pos})}},{key:"fitBounds",value:function(bounds){var options=1<arguments.length&&void 0!==
arguments[1]?arguments[1]:{},width=this.width,height=this.height;options=(0,_fitBounds3["default"])(Object.assign({width,height,bounds},options));return new WebMercatorViewport({width,height,longitude:options.longitude,latitude:options.latitude,zoom:options.zoom})}},{key:"getBounds",value:function(options){var corners=this.getBoundingRegion(options);options=Math.min.apply(Math,(0,_toConsumableArray2["default"])(corners.map(function(p){return p[0]})));var east=Math.max.apply(Math,(0,_toConsumableArray2["default"])(corners.map(function(p){return p[0]}))),
south=Math.min.apply(Math,(0,_toConsumableArray2["default"])(corners.map(function(p){return p[1]})));corners=Math.max.apply(Math,(0,_toConsumableArray2["default"])(corners.map(function(p){return p[1]})));return[[options,south],[east,corners]]}},{key:"getBoundingRegion",value:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,_getBounds["default"])(this,options.z||0)}}]);return WebMercatorViewport}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$math_DOT_gl$web_mercator$dist$es5$web_mercator_viewport.js.map
