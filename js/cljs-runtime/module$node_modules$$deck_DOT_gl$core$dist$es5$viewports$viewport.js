shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$viewports$viewport=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _slicedToArray2=module(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),_classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),
_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),_log=module(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$log")),_mathUtils=require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$math_utils"),_math=require("module$node_modules$math_DOT_gl$dist$es5$index"),mat4=global(require("module$node_modules$gl_matrix$cjs$mat4")),_webMercator=require("module$node_modules$$math_DOT_gl$web_mercator$dist$es5$index"),_constants=require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$constants"),
DEGREES_TO_RADIANS=Math.PI/180,IDENTITY=(0,_mathUtils.createMat4)(),ZERO_VECTOR=[0,0,0],DEFAULT_DISTANCE_SCALES={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};require=function(){function Viewport(){var opts=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};(0,_classCallCheck2["default"])(this,Viewport);var _opts$id=opts.id,_opts$x=opts.x,_opts$y=opts.y,_opts$width=opts.width,_opts$height=opts.height;this.id=(void 0===_opts$id?null:_opts$id)||this.constructor.displayName||"viewport";this.x=
void 0===_opts$x?0:_opts$x;this.y=void 0===_opts$y?0:_opts$y;this.width=(void 0===_opts$width?1:_opts$width)||1;this.height=(void 0===_opts$height?1:_opts$height)||1;this._frustumPlanes={};this._initViewMatrix(opts);this._initProjectionMatrix(opts);this._initPixelMatrices();this.equals=this.equals.bind(this);this.project=this.project.bind(this);this.unproject=this.unproject.bind(this);this.projectPosition=this.projectPosition.bind(this);this.unprojectPosition=this.unprojectPosition.bind(this);this.projectFlat=
this.projectFlat.bind(this);this.unprojectFlat=this.unprojectFlat.bind(this)}(0,_createClass2["default"])(Viewport,[{key:"equals",value:function(viewport){return viewport instanceof Viewport?this===viewport?!0:viewport.width===this.width&&viewport.height===this.height&&viewport.scale===this.scale&&(0,_math.equals)(viewport.projectionMatrix,this.projectionMatrix)&&(0,_math.equals)(viewport.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(xyz){var _ref$topLeft=(1<arguments.length&&void 0!==
arguments[1]?arguments[1]:{}).topLeft;_ref$topLeft=void 0===_ref$topLeft?!0:_ref$topLeft;var worldPosition=this.projectPosition(xyz);worldPosition=(0,_webMercator.worldToPixels)(worldPosition,this.pixelProjectionMatrix);var _coord=(0,_slicedToArray2["default"])(worldPosition,2),x=_coord[0];_coord=_coord[1];_ref$topLeft=_ref$topLeft?_coord:this.height-_coord;return 2===xyz.length?[x,_ref$topLeft]:[x,_ref$topLeft,worldPosition[2]]}},{key:"unproject",value:function(xyz){var _ref2=1<arguments.length&&
void 0!==arguments[1]?arguments[1]:{},_ref2$topLeft=_ref2.topLeft,topLeft=void 0===_ref2$topLeft?!0:_ref2$topLeft;_ref2=_ref2.targetZ;_ref2$topLeft=(0,_slicedToArray2["default"])(xyz,3);var x=_ref2$topLeft[0],y=_ref2$topLeft[1];_ref2$topLeft=_ref2$topLeft[2];topLeft=topLeft?y:this.height-y;y=_ref2&&_ref2*this.distanceScales.unitsPerMeter[2];x=(0,_webMercator.pixelsToWorld)([x,topLeft,_ref2$topLeft],this.pixelUnprojectionMatrix,y);x=this.unprojectPosition(x);y=(0,_slicedToArray2["default"])(x,3);x=
y[0];topLeft=y[1];y=y[2];return Number.isFinite(_ref2$topLeft)?[x,topLeft,y]:Number.isFinite(_ref2)?[x,topLeft,_ref2]:[x,topLeft]}},{key:"projectPosition",value:function(xyz){var _this$projectFlat=this.projectFlat(xyz);_this$projectFlat=(0,_slicedToArray2["default"])(_this$projectFlat,2);return[_this$projectFlat[0],_this$projectFlat[1],(xyz[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(xyz){var _this$unprojectFlat=this.unprojectFlat(xyz);_this$unprojectFlat=
(0,_slicedToArray2["default"])(_this$unprojectFlat,2);return[_this$unprojectFlat[0],_this$unprojectFlat[1],(xyz[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(xyz){return this.isGeospatial?(0,_webMercator.lngLatToWorld)(xyz):xyz}},{key:"unprojectFlat",value:function(xyz){return this.isGeospatial?(0,_webMercator.worldToLngLat)(xyz):xyz}},{key:"getBounds",value:function(){var unprojectOption={targetZ:(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).z||0},
topLeft=this.unproject([0,0],unprojectOption),topRight=this.unproject([this.width,0],unprojectOption),bottomLeft=this.unproject([0,this.height],unprojectOption);unprojectOption=this.unproject([this.width,this.height],unprojectOption);return[Math.min(topLeft[0],topRight[0],bottomLeft[0],unprojectOption[0]),Math.min(topLeft[1],topRight[1],bottomLeft[1],unprojectOption[1]),Math.max(topLeft[0],topRight[0],bottomLeft[0],unprojectOption[0]),Math.max(topLeft[1],topRight[1],bottomLeft[1],unprojectOption[1])]}},
{key:"getDistanceScales",value:function(){var coordinateOrigin=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return coordinateOrigin?(0,_webMercator.getDistanceScales)({longitude:coordinateOrigin[0],latitude:coordinateOrigin[1],highPrecision:!0}):this.distanceScales}},{key:"containsPixel",value:function(_ref3){var x=_ref3.x,y=_ref3.y,_ref3$width=_ref3.width;_ref3=_ref3.height;return x<this.x+this.width&&this.x<x+(void 0===_ref3$width?1:_ref3$width)&&y<this.y+this.height&&this.y<y+(void 0===
_ref3?1:_ref3)}},{key:"getFrustumPlanes",value:function(){if(this._frustumPlanes.near)return this._frustumPlanes;Object.assign(this._frustumPlanes,(0,_mathUtils.getFrustumPlanes)(this.viewProjectionMatrix));return this._frustumPlanes}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"getCameraDirection",value:function(){return this.cameraDirection}},{key:"getCameraUp",value:function(){return this.cameraUp}},{key:"_createProjectionMatrix",value:function(_ref4){var fovyRadians=
_ref4.fovyRadians,aspect=_ref4.aspect,focalDistance=_ref4.focalDistance,near=_ref4.near,far=_ref4.far;return _ref4.orthographic?(new _math.Matrix4).orthographic({fovy:fovyRadians,aspect,focalDistance,near,far}):(new _math.Matrix4).perspective({fovy:fovyRadians,aspect,near,far})}},{key:"_initViewMatrix",value:function(opts){var _opts$viewMatrix=opts.viewMatrix;_opts$viewMatrix=void 0===_opts$viewMatrix?IDENTITY:_opts$viewMatrix;var _opts$longitude=opts.longitude;_opts$longitude=void 0===_opts$longitude?
null:_opts$longitude;var _opts$latitude=opts.latitude;_opts$latitude=void 0===_opts$latitude?null:_opts$latitude;var _opts$zoom=opts.zoom;_opts$zoom=void 0===_opts$zoom?null:_opts$zoom;var _opts$position=opts.position;_opts$position=void 0===_opts$position?null:_opts$position;var _opts$modelMatrix=opts.modelMatrix;_opts$modelMatrix=void 0===_opts$modelMatrix?null:_opts$modelMatrix;var _opts$focalDistance=opts.focalDistance;_opts$focalDistance=void 0===_opts$focalDistance?1:_opts$focalDistance;opts=
opts.distanceScales;opts=void 0===opts?null:opts;this.isGeospatial=Number.isFinite(_opts$latitude)&&Number.isFinite(_opts$longitude);this.zoom=_opts$zoom;Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?(0,_webMercator.getMeterZoom)({latitude:_opts$latitude})+Math.log2(_opts$focalDistance):0);this.scale=Math.pow(2,this.zoom);this.distanceScales=this.isGeospatial?(0,_webMercator.getDistanceScales)({latitude:_opts$latitude,longitude:_opts$longitude}):opts||DEFAULT_DISTANCE_SCALES;this.focalDistance=
_opts$focalDistance;this.distanceScales.metersPerUnit=new _math.Vector3(this.distanceScales.metersPerUnit);this.distanceScales.unitsPerMeter=new _math.Vector3(this.distanceScales.unitsPerMeter);this.meterOffset=this.position=ZERO_VECTOR;_opts$position&&(this.position=_opts$position,this.meterOffset=(this.modelMatrix=_opts$modelMatrix)?_opts$modelMatrix.transformVector(_opts$position):_opts$position);this.isGeospatial?(this.longitude=_opts$longitude,this.latitude=_opts$latitude,this.center=this._getCenterInWorld({longitude:_opts$longitude,
latitude:_opts$latitude})):this.center=_opts$position?this.projectPosition(_opts$position):[0,0,0];this.viewMatrixUncentered=_opts$viewMatrix;this.viewMatrix=(new _math.Matrix4).multiplyRight(this.viewMatrixUncentered).translate((new _math.Vector3(this.center||ZERO_VECTOR)).negate())}},{key:"_getCenterInWorld",value:function(_ref5){var meterOffset=this.meterOffset,distanceScales=this.distanceScales;_ref5=new _math.Vector3(this.projectPosition([_ref5.longitude,_ref5.latitude,0]));meterOffset&&(meterOffset=
(new _math.Vector3(meterOffset)).scale(distanceScales.unitsPerMeter),_ref5.add(meterOffset));return _ref5}},{key:"_initProjectionMatrix",value:function(opts){var _opts$projectionMatri=opts.projectionMatrix,_opts$orthographic=opts.orthographic,fovyRadians=opts.fovyRadians,_opts$fovy=opts.fovy,_opts$near=opts.near,_opts$far=opts.far;opts=opts.focalDistance;this.projectionMatrix=(void 0===_opts$projectionMatri?null:_opts$projectionMatri)||this._createProjectionMatrix({orthographic:void 0===_opts$orthographic?
!1:_opts$orthographic,fovyRadians:fovyRadians||(void 0===_opts$fovy?75:_opts$fovy)*DEGREES_TO_RADIANS,aspect:this.width/this.height,focalDistance:void 0===opts?1:opts,near:void 0===_opts$near?.1:_opts$near,far:void 0===_opts$far?1E3:_opts$far})}},{key:"_initPixelMatrices",value:function(){var vpm=(0,_mathUtils.createMat4)();mat4.multiply(vpm,vpm,this.projectionMatrix);mat4.multiply(vpm,vpm,this.viewMatrix);this.viewProjectionMatrix=vpm;this.viewMatrixInverse=mat4.invert([],this.viewMatrix)||this.viewMatrix;
this.cameraPosition=(0,_mathUtils.getCameraPosition)(this.viewMatrixInverse);vpm=(0,_mathUtils.createMat4)();var pixelProjectionMatrix=(0,_mathUtils.createMat4)();mat4.scale(vpm,vpm,[this.width/2,-this.height/2,1]);mat4.translate(vpm,vpm,[1,-1,0]);mat4.multiply(pixelProjectionMatrix,vpm,this.viewProjectionMatrix);this.pixelProjectionMatrix=pixelProjectionMatrix;this.viewportMatrix=vpm;(this.pixelUnprojectionMatrix=mat4.invert((0,_mathUtils.createMat4)(),this.pixelProjectionMatrix))||_log["default"].warn("Pixel project matrix not invertible")()}},
{key:"metersPerPixel",get:function(){return this.distanceScales.metersPerUnit[2]/this.scale}},{key:"projectionMode",get:function(){return this.isGeospatial?12>this.zoom?_constants.PROJECTION_MODE.WEB_MERCATOR:_constants.PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:_constants.PROJECTION_MODE.IDENTITY}}]);return Viewport}();exports["default"]=require;require.displayName="Viewport"}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$viewports$viewport.js.map
