shadow$provide.module$node_modules$$luma_DOT_gl$experimental$dist$es5$gltf$gltf_instantiator=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_core=require("module$node_modules$$math_DOT_gl$core$dist$es5$index"),
_webgl=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$index"),_groupNode=global(require("module$node_modules$$luma_DOT_gl$experimental$dist$es5$scenegraph$group_node")),_gltfAnimator=global(require("module$node_modules$$luma_DOT_gl$experimental$dist$es5$gltf$gltf_animator")),_createGltfModel=global(require("module$node_modules$$luma_DOT_gl$experimental$dist$es5$gltf$create_gltf_model")),ATTRIBUTE_TYPE_TO_COMPONENTS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},DEFAULT_OPTIONS={modelOptions:{},
pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};require=function(){function GLTFInstantiator(gl){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,GLTFInstantiator);this.gl=gl;this.options=Object.assign({},DEFAULT_OPTIONS,options)}(0,_createClass2["default"])(GLTFInstantiator,[{key:"instantiate",value:function(gltf){var _this=this;this.gltf=gltf;return(gltf.scenes||[]).map(function(scene){return _this.createScene(scene)})}},
{key:"createAnimator",value:function(){return Array.isArray(this.gltf.animations)?new _gltfAnimator["default"](this.gltf):null}},{key:"createScene",value:function(gltfScene){var _this2=this,nodes=(gltfScene.nodes||[]).map(function(node){return _this2.createNode(node)});return new _groupNode["default"]({id:gltfScene.name||gltfScene.id,children:nodes})}},{key:"createNode",value:function(gltfNode){var _this3=this;if(!gltfNode._node){var children=(gltfNode.children||[]).map(function(child){return _this3.createNode(child)});
gltfNode.mesh&&children.push(this.createMesh(gltfNode.mesh));children=new _groupNode["default"]({id:gltfNode.name||gltfNode.id,children});if(gltfNode.matrix)children.setMatrix(gltfNode.matrix);else{children.matrix.identity();gltfNode.translation&&children.matrix.translate(gltfNode.translation);if(gltfNode.rotation){var rotationMatrix=(new _core.Matrix4).fromQuaternion(gltfNode.rotation);children.matrix.multiplyRight(rotationMatrix)}gltfNode.scale&&children.matrix.scale(gltfNode.scale)}gltfNode._node=
children}return gltfNode._node}},{key:"createMesh",value:function(gltfMesh){var _this4=this;if(!gltfMesh._mesh){var primitives=(gltfMesh.primitives||[]).map(function(gltfPrimitive,i){return _this4.createPrimitive(gltfPrimitive,i,gltfMesh)});primitives=new _groupNode["default"]({id:gltfMesh.name||gltfMesh.id,children:primitives});gltfMesh._mesh=primitives}return gltfMesh._mesh}},{key:"getVertexCount",value:function(attributes){_webgl.log.warn("getVertexCount() not found")()}},{key:"createPrimitive",
value:function(gltfPrimitive,i,gltfMesh){return(0,_createGltfModel["default"])(this.gl,Object.assign({id:gltfPrimitive.name||"".concat(gltfMesh.name||gltfMesh.id,"-primitive-").concat(i),drawMode:gltfPrimitive.mode||4,vertexCount:gltfPrimitive.indices?gltfPrimitive.indices.count:this.getVertexCount(gltfPrimitive.attributes),attributes:this.createAttributes(gltfPrimitive.attributes,gltfPrimitive.indices),material:gltfPrimitive.material},this.options))}},{key:"createAttributes",value:function(attributes,
indices){var _this5=this,loadedAttributes={};Object.keys(attributes).forEach(function(attrName){loadedAttributes[attrName]=_this5.createAccessor(attributes[attrName],_this5.createBuffer(attributes[attrName],_this5.gl.ARRAY_BUFFER))});indices&&(loadedAttributes.indices=this.createAccessor(indices,this.createBuffer(indices,this.gl.ELEMENT_ARRAY_BUFFER)));_webgl.log.info(4,"glTF Attributes",{attributes,indices,generated:loadedAttributes})();return loadedAttributes}},{key:"createBuffer",value:function(attribute,
target){attribute.bufferView||(attribute.bufferView={});var bufferView=attribute.bufferView;bufferView.lumaBuffers||(bufferView.lumaBuffers={});bufferView.lumaBuffers[target]||(bufferView.lumaBuffers[target]=new _webgl.Buffer(this.gl,{id:"from-".concat(bufferView.id),data:bufferView.data||attribute.value,target}));return bufferView.lumaBuffers[target]}},{key:"createAccessor",value:function(accessor,buffer){return new _webgl.Accessor({buffer,offset:accessor.byteOffset||0,stride:accessor.bufferView.byteStride||
0,type:accessor.componentType,size:ATTRIBUTE_TYPE_TO_COMPONENTS[accessor.type]})}},{key:"createSampler",value:function(gltfSampler){return gltfSampler}},{key:"needsPOT",value:function(){return!1}}]);return GLTFInstantiator}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$experimental$dist$es5$gltf$gltf_instantiator.js.map
