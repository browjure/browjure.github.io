shadow$provide.module$node_modules$$deck_DOT_gl$extensions$dist$es5$data_filter$data_filter=function(global,require,module,exports){function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=
null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=
(0,_getPrototypeOf2["default"])(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;Super=Reflect.construct(Super,arguments,NewTarget)}else Super=Super.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,Super)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,
[],function(){})),!0}catch(e){return!1}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _defineProperty2=module(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),
_inherits2=module(require("module$node_modules$$babel$runtime$helpers$inherits")),_possibleConstructorReturn2=module(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=module(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf"));module=require("module$node_modules$$deck_DOT_gl$core$dist$es5$index");var _shaderModule=require("module$node_modules$$deck_DOT_gl$extensions$dist$es5$data_filter$shader_module"),aggregator=global(require("module$node_modules$$deck_DOT_gl$extensions$dist$es5$data_filter$aggregator")),
_core2=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),DATA_TYPE_FROM_SIZE={1:"float",2:"vec2",3:"vec3",4:"vec4"};require=function(_LayerExtension){function DataFilterExtension(){var _ref=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},_ref$filterSize=_ref.filterSize;_ref$filterSize=void 0===_ref$filterSize?1:_ref$filterSize;var _ref$fp=_ref.fp64;_ref$fp=void 0===_ref$fp?!1:_ref$fp;_ref=_ref.countItems;_ref=void 0===_ref?!1:_ref;(0,_classCallCheck2["default"])(this,DataFilterExtension);
if(!DATA_TYPE_FROM_SIZE[_ref$filterSize])throw Error("filterSize out of range");return _super.call(this,{filterSize:_ref$filterSize,fp64:_ref$fp,countItems:_ref})}(0,_inherits2["default"])(DataFilterExtension,_LayerExtension);var _super=_createSuper(DataFilterExtension);(0,_createClass2["default"])(DataFilterExtension,[{key:"getShaders",value:function(extension){extension=extension.opts;var fp64=extension.fp64;return{modules:[fp64?_shaderModule.shaderModule64:_shaderModule.shaderModule],defines:{DATAFILTER_TYPE:DATA_TYPE_FROM_SIZE[extension.filterSize],
DATAFILTER_DOUBLE:!!fp64}}}},{key:"initializeState",value:function(context,extension){var attributeManager=this.getAttributeManager();attributeManager&&attributeManager.add({filterValues:{size:extension.opts.filterSize,type:extension.opts.fp64?5130:5126,accessor:"getFilterValue",shaderAttributes:{filterValues:{divisor:0},instanceFilterValues:{divisor:1}}}});context=this.context.gl;if(attributeManager&&extension.opts.countItems){var useFloatTarget=aggregator.supportsFloatTarget(context);attributeManager.add({filterIndices:{size:useFloatTarget?
1:2,vertexOffset:1,type:5121,normalized:!0,accessor:function(object,_ref2){_ref2=_ref2.index;object=object&&object.__source?object.__source.index:_ref2;return useFloatTarget?(object+1)%255:[(object+1)%255,Math.floor(object/255)%255]},shaderAttributes:{filterPrevIndices:{vertexOffset:0},filterIndices:{vertexOffset:1}}}});attributeManager=aggregator.getFramebuffer(context,useFloatTarget);extension=aggregator.getModel(context,extension.getShaders(extension),useFloatTarget);this.setState({filterFBO:attributeManager,
filterModel:extension})}}},{key:"updateState",value:function(_ref3){var props=_ref3.props;_ref3=_ref3.oldProps;this.state.filterModel&&(props=this.getAttributeManager().attributes.filterValues.needsUpdate()||props.filterEnabled!==_ref3.filterEnabled||props.filterRange!==_ref3.filterRange||props.filterSoftRange!==_ref3.filterSoftRange)&&this.setState({filterNeedsUpdate:props})}},{key:"draw",value:function(params,extension){var _this$state=this.state,filterFBO=_this$state.filterFBO,filterModel=_this$state.filterModel;
extension=this.props.onFilteredItemsChange;if(_this$state.filterNeedsUpdate&&extension&&filterModel){var _this$getAttributeMan2=this.getAttributeManager().attributes;_this$state=_this$getAttributeMan2.filterValues;_this$getAttributeMan2=_this$getAttributeMan2.filterIndices;filterModel.setVertexCount(this.getNumInstances());var gl=this.context.gl;(0,_core2.clear)(gl,{framebuffer:filterFBO,color:[0,0,0,0]});filterModel.updateModuleSettings(params.moduleParameters).setAttributes(_objectSpread(_objectSpread({},
_this$state.getShaderAttributes()),_this$getAttributeMan2&&_this$getAttributeMan2.getShaderAttributes())).draw({framebuffer:filterFBO,parameters:_objectSpread(_objectSpread({},aggregator.parameters),{},{viewport:[0,0,filterFBO.width,filterFBO.height]})});params=(0,_core2.readPixelsToArray)(filterFBO);for(filterModel=filterFBO=0;filterModel<params.length;filterModel++)filterFBO+=params[filterModel];extension({id:this.id,count:filterFBO});this.state.filterNeedsUpdate=!1}}},{key:"finalizeState",value:function(){var _this$state2=
this.state,filterFBO=_this$state2.filterFBO;_this$state2=_this$state2.filterModel;filterFBO&&(filterFBO.color["delete"](),filterFBO["delete"](),_this$state2["delete"]())}}]);return DataFilterExtension}(module.LayerExtension);exports["default"]=require;require.extensionName="DataFilterExtension";require.defaultProps={getFilterValue:{type:"accessor",value:0},onFilteredItemsChange:{type:"function",value:null,compare:!1},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterTransformSize:!0,
filterTransformColor:!0}}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$extensions$dist$es5$data_filter$data_filter.js.map
