shadow$provide.module$node_modules$$luma_DOT_gl$experimental$dist$es5$gltf$gltf_material_parser=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=
global(require("module$node_modules$$babel$runtime$helpers$createClass")),_webgl=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$index");require=function(){function GLTFMaterialParser(gl,_ref){var attributes=_ref.attributes,material=_ref.material,pbrDebug=_ref.pbrDebug,imageBasedLightingEnvironment=_ref.imageBasedLightingEnvironment,lights=_ref.lights;_ref=_ref.useTangents;(0,_classCallCheck2["default"])(this,GLTFMaterialParser);this.gl=gl;this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1};
(0,_webgl.hasFeature)(gl,_webgl.FEATURES.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1);this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]};this.parameters={};this.generatedTextures=[];imageBasedLightingEnvironment&&(this.uniforms.u_DiffuseEnvSampler=imageBasedLightingEnvironment.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=imageBasedLightingEnvironment.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=imageBasedLightingEnvironment.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=
[1,1]);pbrDebug&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]);this.defineIfPresent(attributes.NORMAL,"HAS_NORMALS");this.defineIfPresent(attributes.TANGENT&&_ref,"HAS_TANGENTS");this.defineIfPresent(attributes.TEXCOORD_0,"HAS_UV");this.defineIfPresent(imageBasedLightingEnvironment,"USE_IBL");this.defineIfPresent(lights,"USE_LIGHTS");this.defineIfPresent(pbrDebug,"PBR_DEBUG");material&&this.parseMaterial(material)}(0,_createClass2["default"])(GLTFMaterialParser,
[{key:"defineIfPresent",value:function(value,name){value&&(this.defines[name]=1)}},{key:"parseTexture",value:function(gltfTexture,name){var define=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,texture=new _webgl.Texture2D(this.gl,{id:gltfTexture.name||gltfTexture.id,parameters:gltfTexture.texture&&gltfTexture.texture.sampler&&gltfTexture.texture.sampler.parameters||{},pixelStore:(0,_defineProperty2["default"])({},this.gl.UNPACK_FLIP_Y_WEBGL,!1),data:gltfTexture.texture.source.image});
this.uniforms[name]=texture;this.defineIfPresent(define,define);this.generatedTextures.push(texture)}},{key:"parsePbrMetallicRoughness",value:function(pbrMetallicRoughness){pbrMetallicRoughness.baseColorTexture&&this.parseTexture(pbrMetallicRoughness.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP");this.uniforms.u_BaseColorFactor=pbrMetallicRoughness.baseColorFactor||[1,1,1,1];pbrMetallicRoughness.metallicRoughnessTexture&&this.parseTexture(pbrMetallicRoughness.metallicRoughnessTexture,"u_MetallicRoughnessSampler",
"HAS_METALROUGHNESSMAP");var _pbrMetallicRoughness=pbrMetallicRoughness.metallicFactor;pbrMetallicRoughness=pbrMetallicRoughness.roughnessFactor;this.uniforms.u_MetallicRoughnessValues=[void 0===_pbrMetallicRoughness?1:_pbrMetallicRoughness,void 0===pbrMetallicRoughness?1:pbrMetallicRoughness]}},{key:"parseMaterial",value:function(material){this.uniforms.pbr_uUnlit=!!material.unlit;material.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(material.pbrMetallicRoughness);if(material.normalTexture){this.parseTexture(material.normalTexture,
"u_NormalSampler","HAS_NORMALMAP");var _material$normalTextu=material.normalTexture.scale;this.uniforms.u_NormalScale=void 0===_material$normalTextu?1:_material$normalTextu}material.occlusionTexture&&(this.parseTexture(material.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP"),_material$normalTextu=material.occlusionTexture.strength,this.uniforms.u_OcclusionStrength=void 0===_material$normalTextu?1:_material$normalTextu);material.emissiveTexture&&(this.parseTexture(material.emissiveTexture,
"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=material.emissiveFactor||[0,0,0]);"MASK"===material.alphaMode?(material=material.alphaCutoff,this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=void 0===material?.5:material):"BLEND"===material.alphaMode&&(_webgl.log.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,
this.gl.ONE_MINUS_SRC_ALPHA]}))}}]);return GLTFMaterialParser}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$experimental$dist$es5$gltf$gltf_material_parser.js.map
