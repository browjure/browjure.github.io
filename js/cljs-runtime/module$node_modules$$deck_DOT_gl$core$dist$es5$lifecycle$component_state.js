shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$lifecycle$component_state=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _regenerator=global(require("module$node_modules$$babel$runtime$regenerator$index")),_asyncToGenerator2=global(require("module$node_modules$$babel$runtime$helpers$asyncToGenerator")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),
_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_asyncIterator2=global(require("module$node_modules$$babel$runtime$helpers$asyncIterator")),_log=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$log")),_iterableUtils=require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$iterable_utils");require=require("module$node_modules$$deck_DOT_gl$core$dist$es5$lifecycle$constants");var ASYNC_ORIGINAL=require.PROP_SYMBOLS.ASYNC_ORIGINAL,ASYNC_RESOLVED=
require.PROP_SYMBOLS.ASYNC_RESOLVED,ASYNC_DEFAULTS=require.PROP_SYMBOLS.ASYNC_DEFAULTS,EMPTY_PROPS=Object.freeze({});require=function(){function ComponentState(){var component=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;(0,_classCallCheck2["default"])(this,ComponentState);this.component=component;this.asyncProps={};this.onAsyncPropUpdated=function(){};this.oldProps=EMPTY_PROPS;this.oldAsyncProps=null}(0,_createClass2["default"])(ComponentState,[{key:"finalize",value:function(){for(var propName in this.asyncProps){var asyncProp=
this.asyncProps[propName];asyncProp.type&&asyncProp.type.release&&asyncProp.type.release(asyncProp.resolvedValue,asyncProp.type,this.component)}}},{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null;this.oldProps=this.component.props}},{key:"freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps){this.oldProps=this.oldProps||this.component.props;this.oldAsyncProps=Object.create(this.oldProps);for(var propName in this.asyncProps)Object.defineProperty(this.oldAsyncProps,
propName,{enumerable:!0,value:this.oldProps[propName]})}}},{key:"hasAsyncProp",value:function(propName){return propName in this.asyncProps}},{key:"getAsyncProp",value:function(propName){return(propName=this.asyncProps[propName])&&propName.resolvedValue}},{key:"isAsyncPropLoading",value:function(propName){if(propName)return propName=this.asyncProps[propName],!!(propName&&0<propName.pendingLoadCount&&propName.pendingLoadCount!==propName.resolvedLoadCount);for(var key in this.asyncProps)if(this.isAsyncPropLoading(key))return!0;
return!1}},{key:"reloadAsyncProp",value:function(propName,value){this._watchPromise(propName,Promise.resolve(value))}},{key:"setAsyncProps",value:function(props){var resolvedValues=props[ASYNC_RESOLVED]||{},originalValues=props[ASYNC_ORIGINAL]||props;props=props[ASYNC_DEFAULTS]||{};for(var propName in resolvedValues){var value=resolvedValues[propName];this._createAsyncPropData(propName,props[propName]);this._updateAsyncProp(propName,value);resolvedValues[propName]=this.getAsyncProp(propName)}for(var _propName in originalValues)resolvedValues=
originalValues[_propName],this._createAsyncPropData(_propName,props[_propName]),this._updateAsyncProp(_propName,resolvedValues)}},{key:"_updateAsyncProp",value:function(propName,value){if(this._didAsyncInputValueChange(propName,value)){if("string"===typeof value){var fetch=this.layer&&this.layer.props.fetch,url=value;fetch&&(value=fetch(url,{propName,layer:this.layer}))}value instanceof Promise?this._watchPromise(propName,value):(0,_iterableUtils.isAsyncIterable)(value)?this._resolveAsyncIterable(propName,
value):this._setPropValue(propName,value)}}},{key:"_didAsyncInputValueChange",value:function(propName,value){propName=this.asyncProps[propName];if(value===propName.resolvedValue||value===propName.lastValue)return!1;propName.lastValue=value;return!0}},{key:"_setPropValue",value:function(propName,value){propName=this.asyncProps[propName];value=this._postProcessValue(propName,value);propName.resolvedValue=value;propName.pendingLoadCount++;propName.resolvedLoadCount=propName.pendingLoadCount}},{key:"_setAsyncPropValue",
value:function(propName,value,loadCount){var asyncProp=this.asyncProps[propName];asyncProp&&loadCount>=asyncProp.resolvedLoadCount&&void 0!==value&&(this.freezeAsyncOldProps(),asyncProp.resolvedValue=value,asyncProp.resolvedLoadCount=loadCount,this.onAsyncPropUpdated(propName,value))}},{key:"_watchPromise",value:function(propName,promise){var _this=this,asyncProp=this.asyncProps[propName];asyncProp.pendingLoadCount++;var loadCount=asyncProp.pendingLoadCount;promise.then(function(data){data=_this._postProcessValue(asyncProp,
data);_this._setAsyncPropValue(propName,data,loadCount);var onDataLoad=_this.layer&&_this.layer.props.onDataLoad;"data"===propName&&onDataLoad&&onDataLoad(data,{propName,layer:_this.layer})})["catch"](function(error){return _log["default"].error(error)()})}},{key:"_resolveAsyncIterable",value:function(){var _resolveAsyncIterable2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(propName,iterable){var asyncProp,loadCount,data,count,_iteratorNormalCompletion,_didIteratorError,
_iteratorError,_iterator,_step,_value,chunk,_ref,dataTransform,onDataLoad;return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:"data"!==propName&&this._setPropValue(propName,iterable),asyncProp=this.asyncProps[propName],asyncProp.pendingLoadCount++,loadCount=asyncProp.pendingLoadCount,data=[],count=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_context.prev=8,_iterator=(0,_asyncIterator2["default"])(iterable);case 10:return _context.next=12,
_iterator.next();case 12:return _step=_context.sent,_iteratorNormalCompletion=_step.done,_context.next=16,_step.value;case 16:_value=_context.sent;if(_iteratorNormalCompletion){_context.next=27;break}chunk=_value;_ref=this.component?this.component.props:{};data=(dataTransform=_ref.dataTransform)?dataTransform(chunk,data):data.concat(chunk);Object.defineProperty(data,"__diff",{enumerable:!1,value:[{startRow:count,endRow:data.length}]});count=data.length;this._setAsyncPropValue(propName,data,loadCount);
case 24:_iteratorNormalCompletion=!0;_context.next=10;break;case 27:_context.next=33;break;case 29:_context.prev=29,_context.t0=_context["catch"](8),_didIteratorError=!0,_iteratorError=_context.t0;case 33:_context.prev=33;_context.prev=34;if(_iteratorNormalCompletion||null==_iterator["return"]){_context.next=38;break}_context.next=38;return _iterator["return"]();case 38:_context.prev=38;if(!_didIteratorError){_context.next=41;break}throw _iteratorError;case 41:return _context.finish(38);case 42:return _context.finish(33);
case 43:(onDataLoad=this.layer&&this.layer.props.onDataLoad)&&onDataLoad(data,{propName,layer:this.layer});case 45:case "end":return _context.stop()}},_callee,this,[[8,29,33,43],[34,,38,42]])}));return function(_x,_x2){return _resolveAsyncIterable2.apply(this,arguments)}}()},{key:"_postProcessValue",value:function(asyncProp,value){var propType=asyncProp.type;return propType&&(propType.release&&propType.release(asyncProp.resolvedValue,propType,this.component),propType.transform)?propType.transform(value,
propType,this.component):value}},{key:"_createAsyncPropData",value:function(propName,defaultValue){if(!this.asyncProps[propName]){var propTypes=this.component&&this.component.constructor._propTypes;this.asyncProps[propName]={type:propTypes&&propTypes[propName],lastValue:null,resolvedValue:defaultValue,pendingLoadCount:0,resolvedLoadCount:0}}}}]);return ComponentState}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$lifecycle$component_state.js.map
