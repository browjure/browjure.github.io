shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$lib$resource$resource_manager=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_resource=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$resource$resource"));
require=function(){function ResourceManager(_ref){var gl=_ref.gl;_ref=_ref.protocol;(0,_classCallCheck2["default"])(this,ResourceManager);this.protocol=_ref||"resource://";this._context={gl,resourceManager:this};this._resources={};this._consumers={};this._pruneRequest=null}(0,_createClass2["default"])(ResourceManager,[{key:"contains",value:function(resourceId){return resourceId.startsWith(this.protocol)?!0:resourceId in this._resources}},{key:"add",value:function(_ref2){var resourceId=_ref2.resourceId,
data=_ref2.data,_ref2$forceUpdate=_ref2.forceUpdate;_ref2$forceUpdate=void 0===_ref2$forceUpdate?!1:_ref2$forceUpdate;_ref2=_ref2.persistent;_ref2=void 0===_ref2?!0:_ref2;var res=this._resources[resourceId];res?res.setData(data,_ref2$forceUpdate):(res=new _resource["default"](resourceId,data,this._context),this._resources[resourceId]=res);res.persistent=_ref2}},{key:"remove",value:function(resourceId){var res=this._resources[resourceId];res&&(res["delete"](),delete this._resources[resourceId])}},
{key:"unsubscribe",value:function(_ref3){_ref3=_ref3.consumerId;var consumer=this._consumers[_ref3];if(consumer){for(var requestId in consumer){var request=consumer[requestId];request.resource&&request.resource.unsubscribe(request)}delete this._consumers[_ref3];this.prune()}}},{key:"subscribe",value:function(_ref4){var resourceId=_ref4.resourceId,onChange=_ref4.onChange,consumerId=_ref4.consumerId;_ref4=_ref4.requestId;_ref4=void 0===_ref4?"default":_ref4;var resources=this._resources,protocol=this.protocol;
resourceId.startsWith(protocol)&&(resourceId=resourceId.replace(protocol,""),resources[resourceId]||this.add({resourceId,data:null,persistent:!1}));resourceId=resources[resourceId];this._track(consumerId,_ref4,resourceId,onChange);if(resourceId)return resourceId.getData()}},{key:"prune",value:function(){var _this=this;this._pruneRequest||(this._pruneRequest=setTimeout(function(){return _this._prune()},0))}},{key:"finalize",value:function(){for(var key in this._resources)this._resources[key]["delete"]()}},
{key:"_track",value:function(consumerId,requestId,resource,onChange){var consumers=this._consumers;consumerId=consumers[consumerId]=consumers[consumerId]||{};consumers=consumerId[requestId]||{};consumers.resource&&(consumers.resource.unsubscribe(consumers),consumers.resource=null,this.prune());resource&&(consumerId[requestId]=consumers,consumers.onChange=onChange,consumers.resource=resource,resource.subscribe(consumers))}},{key:"_prune",value:function(){this._pruneRequest=null;for(var _i=0,_Object$keys=
Object.keys(this._resources);_i<_Object$keys.length;_i++){var key=_Object$keys[_i],res=this._resources[key];res.persistent||res.inUse()||(res["delete"](),delete this._resources[key])}}}]);return ResourceManager}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$lib$resource$resource_manager.js.map
