shadow$provide.module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$framebuffer=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _createSuper(Derived){var hasNativeReflectConstruct=
_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2["default"])(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;Super=Reflect.construct(Super,arguments,NewTarget)}else Super=Super.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,Super)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;
try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports.FRAMEBUFFER_ATTACHMENT_PARAMETERS=exports["default"]=void 0;var _defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_slicedToArray2=global(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),_classCallCheck2=
global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_assertThisInitialized2=global(require("module$node_modules$$babel$runtime$helpers$assertThisInitialized")),_get2=global(require("module$node_modules$$babel$runtime$helpers$get")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits")),_possibleConstructorReturn2=global(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),
_getPrototypeOf2=global(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index");module=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$resource"));var _texture2d=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$texture_2d")),_renderbuffer=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$renderbuffer")),_clear2=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$clear"),
_copyAndBlit=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$copy_and_blit"),_features=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$features$index"),_webglUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$index"),_utils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$utils$index"),Framebuffer=function(_Resource){function Framebuffer$jscomp$0(gl){var opts=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,
Framebuffer$jscomp$0);var _this=_super.call(this,gl,opts);_this.width=null;_this.height=null;_this.attachments={};_this.readBuffer=36064;_this.drawBuffers=[36064];_this.ownResources=[];_this.initialize(opts);Object.seal((0,_assertThisInitialized2["default"])(_this));return _this}(0,_inherits2["default"])(Framebuffer$jscomp$0,_Resource);var _super=_createSuper(Framebuffer$jscomp$0);(0,_createClass2["default"])(Framebuffer$jscomp$0,[{key:"MAX_COLOR_ATTACHMENTS",get:function(){var gl2=(0,_gltools.assertWebGL2Context)(this.gl);
return gl2.getParameter(gl2.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){var gl2=(0,_gltools.assertWebGL2Context)(this.gl);return gl2.getParameter(gl2.MAX_DRAW_BUFFERS)}}],[{key:"isSupported",value:function(gl){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},colorBufferHalfFloat=options.colorBufferHalfFloat,supported=!0;options.colorBufferFloat&&(supported=!!(gl.getExtension("EXT_color_buffer_float")||gl.getExtension("WEBGL_color_buffer_float")||gl.getExtension("OES_texture_float")));
colorBufferHalfFloat&&(supported=supported&&!(!gl.getExtension("EXT_color_buffer_float")&&!gl.getExtension("EXT_color_buffer_half_float")));return supported}},{key:"getDefaultFramebuffer",value:function(gl){gl.luma=gl.luma||{};gl.luma.defaultFramebuffer=gl.luma.defaultFramebuffer||new Framebuffer$jscomp$0(gl,{id:"default-framebuffer",handle:null,attachments:{}});return gl.luma.defaultFramebuffer}}]);(0,_createClass2["default"])(Framebuffer$jscomp$0,[{key:"initialize",value:function(_ref){var _ref$width=
_ref.width;_ref$width=void 0===_ref$width?1:_ref$width;var _ref$height=_ref.height;_ref$height=void 0===_ref$height?1:_ref$height;var _ref$attachments=_ref.attachments;_ref$attachments=void 0===_ref$attachments?null:_ref$attachments;var _ref$color=_ref.color;_ref$color=void 0===_ref$color?!0:_ref$color;var _ref$depth=_ref.depth;_ref$depth=void 0===_ref$depth?!0:_ref$depth;var _ref$stencil=_ref.stencil;_ref$stencil=void 0===_ref$stencil?!1:_ref$stencil;var _ref$check=_ref.check;_ref$check=void 0===
_ref$check?!0:_ref$check;var _ref$readBuffer=_ref.readBuffer;_ref$readBuffer=void 0===_ref$readBuffer?void 0:_ref$readBuffer;_ref=_ref.drawBuffers;_ref=void 0===_ref?void 0:_ref;(0,_utils.assert)(0<=_ref$width&&0<=_ref$height,"Width and height need to be integers");this.width=_ref$width;this.height=_ref$height;if(_ref$attachments)for(var attachment in _ref$attachments)_ref$color=_ref$attachments[attachment],(Array.isArray(_ref$color)?_ref$color[0]:_ref$color).resize({width:_ref$width,height:_ref$height});
else _ref$attachments=this._createDefaultAttachments(_ref$color,_ref$depth,_ref$stencil,_ref$width,_ref$height);this.update({clearAttachments:!0,attachments:_ref$attachments,readBuffer:_ref$readBuffer,drawBuffers:_ref});_ref$attachments&&_ref$check&&this.checkStatus()}},{key:"delete",value:function(){var _iterator=_createForOfIteratorHelper(this.ownResources),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;)_step.value["delete"]()}catch(err){_iterator.e(err)}finally{_iterator.f()}(0,_get2["default"])((0,
_getPrototypeOf2["default"])(Framebuffer$jscomp$0.prototype),"delete",this).call(this);return this}},{key:"update",value:function(_ref2){var _ref2$attachments=_ref2.attachments,readBuffer=_ref2.readBuffer,drawBuffers=_ref2.drawBuffers,_ref2$clearAttachment=_ref2.clearAttachments;_ref2=_ref2.resizeAttachments;this.attach(void 0===_ref2$attachments?{}:_ref2$attachments,{clearAttachments:void 0===_ref2$clearAttachment?!1:_ref2$clearAttachment,resizeAttachments:void 0===_ref2?!0:_ref2});_ref2$attachments=
this.gl;_ref2$clearAttachment=_ref2$attachments.bindFramebuffer(36160,this.handle);readBuffer&&this._setReadBuffer(readBuffer);drawBuffers&&this._setDrawBuffers(drawBuffers);_ref2$attachments.bindFramebuffer(36160,_ref2$clearAttachment||null);return this}},{key:"resize",value:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},width=options.width;options=options.height;if(null===this.handle)return(0,_utils.assert)(void 0===width&&void 0===options),this.width=this.gl.drawingBufferWidth,
this.height=this.gl.drawingBufferHeight,this;void 0===width&&(width=this.gl.drawingBufferWidth);void 0===options&&(options=this.gl.drawingBufferHeight);width!==this.width&&options!==this.height&&_gltools.log.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(width,"x").concat(options))();for(var attachmentPoint in this.attachments)this.attachments[attachmentPoint].resize({width,height:options});this.width=width;this.height=options;return this}},{key:"attach",value:function(attachments){var _this2=
this,_ref3=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref3$clearAttachment=_ref3.clearAttachments;_ref3=_ref3.resizeAttachments;_ref3=void 0===_ref3?!0:_ref3;var newAttachments={};(void 0===_ref3$clearAttachment?0:_ref3$clearAttachment)&&Object.keys(this.attachments).forEach(function(key){newAttachments[key]=null});Object.assign(newAttachments,attachments);_ref3$clearAttachment=this.gl.bindFramebuffer(36160,this.handle);for(var key$jscomp$0 in newAttachments){(0,_utils.assert)(void 0!==
key$jscomp$0,"Misspelled framebuffer binding point?");var attachment=Number(key$jscomp$0),descriptor=newAttachments[attachment],object=descriptor;if(object)if(object instanceof _renderbuffer["default"])this._attachRenderbuffer({attachment,renderbuffer:object});else if(Array.isArray(descriptor)){object=(0,_slicedToArray2["default"])(descriptor,3);descriptor=object[0];var _descriptor$=object[1];_descriptor$=void 0===_descriptor$?0:_descriptor$;object=object[2];var level=void 0===object?0:object;object=
descriptor;this._attachTexture({attachment,texture:descriptor,layer:_descriptor$,level})}else this._attachTexture({attachment,texture:object,layer:0,level:0});else this._unattach(attachment);_ref3&&object&&object.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,_ref3$clearAttachment||null);Object.assign(this.attachments,attachments);Object.keys(this.attachments).filter(function(key){return!_this2.attachments[key]}).forEach(function(key){delete _this2.attachments[key]})}},
{key:"checkStatus",value:function(){var status=this.getStatus();if(36053!==status){var JSCompiler_temp_const=Error;status=(Framebuffer.STATUS||{})[status]||"Framebuffer error ".concat(status);throw new JSCompiler_temp_const(status);}return this}},{key:"getStatus",value:function(){var gl=this.gl,prevHandle=gl.bindFramebuffer(36160,this.handle),status=gl.checkFramebufferStatus(36160);gl.bindFramebuffer(36160,prevHandle||null);return status}},{key:"clear",value:function(){var options=0<arguments.length&&
void 0!==arguments[0]?arguments[0]:{},color=options.color,depth=options.depth,stencil=options.stencil;options=options.drawBuffers;options=void 0===options?[]:options;var prevHandle=this.gl.bindFramebuffer(36160,this.handle);(color||depth||stencil)&&(0,_clear2.clear)(this.gl,{color,depth,stencil});options.forEach(function(value,drawBuffer){(0,_clear2.clearBuffer)({drawBuffer,value})});this.gl.bindFramebuffer(36160,prevHandle||null);return this}},{key:"readPixels",value:function(){_gltools.log.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")();
return null}},{key:"readPixelsToBuffer",value:function(){_gltools.log.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")();return null}},{key:"copyToDataUrl",value:function(){_gltools.log.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")();return null}},{key:"copyToImage",value:function(){_gltools.log.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")();return null}},{key:"copyToTexture",
value:function(){_gltools.log.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")();return null}},{key:"blit",value:function(){_gltools.log.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")();return null}},{key:"invalidate",value:function(_ref4){var _ref4$attachments=_ref4.attachments;_ref4$attachments=void 0===_ref4$attachments?[]:_ref4$attachments;var _ref4$x=_ref4.x;_ref4$x=void 0===_ref4$x?0:_ref4$x;var _ref4$y=
_ref4.y;_ref4$y=void 0===_ref4$y?0:_ref4$y;var width=_ref4.width;_ref4=_ref4.height;var gl2=(0,_gltools.assertWebGL2Context)(this.gl),prevHandle=gl2.bindFramebuffer(36008,this.handle);0===_ref4$x&&0===_ref4$y&&void 0===width&&void 0===_ref4?gl2.invalidateFramebuffer(36008,_ref4$attachments):gl2.invalidateFramebuffer(36008,_ref4$attachments,_ref4$x,_ref4$y,width,_ref4);gl2.bindFramebuffer(36008,prevHandle);return this}},{key:"getAttachmentParameter",value:function(attachment,pname,keys){var value=
this._getAttachmentParameterFallback(pname);null===value&&(this.gl.bindFramebuffer(36160,this.handle),value=this.gl.getFramebufferAttachmentParameter(36160,attachment,pname),this.gl.bindFramebuffer(36160,null));keys&&1E3<value&&(value=(0,_webglUtils.getKey)(this.gl,value));return value}},{key:"getAttachmentParameters",value:function(){var attachment=0<arguments.length&&void 0!==arguments[0]?arguments[0]:36064,keys=1<arguments.length?arguments[1]:void 0,values={},_iterator2=_createForOfIteratorHelper(2<
arguments.length&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[]),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var pname=_step2.value,key=keys?(0,_webglUtils.getKey)(this.gl,pname):pname;values[key]=this.getAttachmentParameter(attachment,pname,keys)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return values}},{key:"getParameters",value:function(){for(var keys=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0,parameters={},_i=0,_attachments=
Object.keys(this.attachments);_i<_attachments.length;_i++){var attachment=Number(_attachments[_i]),key=keys?(0,_webglUtils.getKey)(this.gl,attachment):attachment;parameters[key]=this.getAttachmentParameters(attachment,keys)}return parameters}},{key:"show",value:function(){"undefined"!==typeof window&&window.open((0,_copyAndBlit.copyToDataUrl)(this),"luma-debug-texture");return this}},{key:"log",value:function(){var logLevel=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,message=1<arguments.length&&
void 0!==arguments[1]?arguments[1]:"";if(logLevel>_gltools.log.level||"undefined"===typeof window)return this;message=message||"Framebuffer ".concat(this.id);var image=(0,_copyAndBlit.copyToDataUrl)(this,{targetMaxHeight:100});_gltools.log.image({logLevel,message,image},message)();return this}},{key:"bind",value:function(){var _ref5$target=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).target;this.gl.bindFramebuffer(void 0===_ref5$target?36160:_ref5$target,this.handle);return this}},
{key:"unbind",value:function(){var _ref6$target=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).target;this.gl.bindFramebuffer(void 0===_ref6$target?36160:_ref6$target,null);return this}},{key:"_createDefaultAttachments",value:function(color,depth,stencil,width,height){var defaultAttachments=null;if(color){var _parameters;defaultAttachments=defaultAttachments||{};defaultAttachments[36064]=new _texture2d["default"](this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,
width,height,mipmaps:!1,parameters:(_parameters={},(0,_defineProperty2["default"])(_parameters,10241,9729),(0,_defineProperty2["default"])(_parameters,10240,9729),(0,_defineProperty2["default"])(_parameters,10242,33071),(0,_defineProperty2["default"])(_parameters,10243,33071),_parameters)});this.ownResources.push(defaultAttachments[36064])}depth&&stencil?(defaultAttachments=defaultAttachments||{},defaultAttachments[33306]=new _renderbuffer["default"](this.gl,{id:"".concat(this.id,"-depth-stencil"),
format:35056,width,height:111}),this.ownResources.push(defaultAttachments[33306])):depth?(defaultAttachments=defaultAttachments||{},defaultAttachments[36096]=new _renderbuffer["default"](this.gl,{id:"".concat(this.id,"-depth"),format:33189,width,height}),this.ownResources.push(defaultAttachments[36096])):stencil&&(0,_utils.assert)(!1);return defaultAttachments}},{key:"_unattach",value:function(attachment){var oldAttachment=this.attachments[attachment];oldAttachment&&(oldAttachment instanceof _renderbuffer["default"]?
this.gl.framebufferRenderbuffer(36160,attachment,36161,null):this.gl.framebufferTexture2D(36160,attachment,3553,null,0),delete this.attachments[attachment])}},{key:"_attachRenderbuffer",value:function(_ref7){var _ref7$attachment=_ref7.attachment;_ref7$attachment=void 0===_ref7$attachment?36064:_ref7$attachment;_ref7=_ref7.renderbuffer;this.gl.framebufferRenderbuffer(36160,_ref7$attachment,36161,_ref7.handle);this.attachments[_ref7$attachment]=_ref7}},{key:"_attachTexture",value:function(_ref8){var _ref8$attachment=
_ref8.attachment;_ref8$attachment=void 0===_ref8$attachment?36064:_ref8$attachment;var texture=_ref8.texture,layer=_ref8.layer;_ref8=_ref8.level;var gl=this.gl;gl.bindTexture(texture.target,texture.handle);switch(texture.target){case 35866:case 32879:(0,_gltools.assertWebGL2Context)(gl).framebufferTextureLayer(36160,_ref8$attachment,texture.target,_ref8,layer);break;case 34067:gl.framebufferTexture2D(36160,_ref8$attachment,34069>layer?layer+34069:layer,texture.handle,_ref8);break;case 3553:gl.framebufferTexture2D(36160,
_ref8$attachment,3553,texture.handle,_ref8);break;default:(0,_utils.assert)(!1,"Illegal texture type")}gl.bindTexture(texture.target,null);this.attachments[_ref8$attachment]=texture}},{key:"_setReadBuffer",value:function(readBuffer){var gl2=(0,_gltools.getWebGL2Context)(this.gl);gl2?gl2.readBuffer(readBuffer):(0,_utils.assert)(36064===readBuffer||1029===readBuffer,"Multiple render targets not supported");this.readBuffer=readBuffer}},{key:"_setDrawBuffers",value:function(drawBuffers){var gl=this.gl,
gl2=(0,_gltools.assertWebGL2Context)(gl);gl2?gl2.drawBuffers(drawBuffers):(gl=gl.getExtension("WEBGL_draw_buffers"))?gl.drawBuffersWEBGL(drawBuffers):(0,_utils.assert)(1===drawBuffers.length&&(36064===drawBuffers[0]||1029===drawBuffers[0]),"Multiple render targets not supported");this.drawBuffers=drawBuffers}},{key:"_getAttachmentParameterFallback",value:function(pname){var caps=(0,_features.getFeatures)(this.gl);switch(pname){case 36052:return caps.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return caps.WEBGL2?
null:8;case 33297:return caps.WEBGL2?null:5125;case 33296:return caps.WEBGL2||caps.EXT_sRGB?null:9729;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(handle){return this.gl.bindFramebuffer(36160,handle)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},
{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}}]);return Framebuffer$jscomp$0}(module["default"]);exports["default"]=Framebuffer;require=[36049,36048,33296,33298,33299,33300,33301,33302,33303];exports.FRAMEBUFFER_ATTACHMENT_PARAMETERS=require;Framebuffer.ATTACHMENT_PARAMETERS=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$framebuffer.js.map
