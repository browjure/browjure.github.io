shadow$provide.module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$vertex_array=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index"),
_accessor2=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$accessor")),_buffer=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$buffer")),_vertexArrayObject=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$vertex_array_object")),_utils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$utils$index"),MULTI_LOCATION_ATTRIBUTE_REGEXP=/^(.+)__LOCATION_([0-9]+)$/,DEPRECATIONS_V6="setBuffers setGeneric clearBindings setLocations setGenericValues setDivisor enable disable".split(" ");
require=function(){function VertexArray(gl){var opts=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,VertexArray);this.id=opts.id||opts.program&&opts.program.id;this.gl=gl;this.buffer=this.drawParams=this.unused=this.accessors=this.values=this.elementsAccessor=this.elements=this.configuration=null;this.attributes={};this.vertexArrayObject=new _vertexArrayObject["default"](gl);(0,_utils.stubRemovedMethods)(this,"VertexArray","v6.0",DEPRECATIONS_V6);this.initialize(opts);
Object.seal(this)}(0,_createClass2["default"])(VertexArray,[{key:"delete",value:function(){if(this.buffer)this.buffer["delete"]();this.vertexArrayObject["delete"]()}},{key:"initialize",value:function(){var props=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.reset();this.configuration=null;this.bindOnUse=!1;return this.setProps(props)}},{key:"reset",value:function(){this.elementsAccessor=this.elements=null;var MAX_ATTRIBUTES=this.vertexArrayObject.MAX_ATTRIBUTES;this.values=Array(MAX_ATTRIBUTES).fill(null);
this.accessors=Array(MAX_ATTRIBUTES).fill(null);this.unused={};this.drawParams=null;return this}},{key:"setProps",value:function(props){"program"in props&&(this.configuration=props.program&&props.program.configuration);"configuration"in props&&(this.configuration=props.configuration);"attributes"in props&&this.setAttributes(props.attributes);"elements"in props&&this.setElementBuffer(props.elements);return this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(){return this.drawParams=
this.drawParams||this._updateDrawParams()}},{key:"setAttributes",value:function(attributes){var _this=this;Object.assign(this.attributes,attributes);this.vertexArrayObject.bind(function(){for(var locationOrName in attributes)_this._setAttribute(locationOrName,attributes[locationOrName]);_this.gl.bindBuffer(34962,null)});return this}},{key:"setElementBuffer",value:function(){var elementBuffer=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,accessor=1<arguments.length&&void 0!==arguments[1]?
arguments[1]:{};this.elements=elementBuffer;this.elementsAccessor=accessor;this.clearDrawParams();this.vertexArrayObject.setElementBuffer(elementBuffer,accessor);return this}},{key:"setBuffer",value:function(locationOrName,buffer){var appAccessor=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(34963===buffer.target)return this.setElementBuffer(buffer,appAccessor);var _this$_resolveLocatio=this._resolveLocationAndAccessor(locationOrName,buffer,buffer.accessor,appAccessor);appAccessor=
_this$_resolveLocatio.location;_this$_resolveLocatio=_this$_resolveLocatio.accessor;0<=appAccessor&&(this.values[appAccessor]=buffer,this.accessors[appAccessor]=_this$_resolveLocatio,this.clearDrawParams(),this.vertexArrayObject.setBuffer(appAccessor,buffer,_this$_resolveLocatio));return this}},{key:"setConstant",value:function(locationOrName,arrayValue){var _this$_resolveLocatio2=this._resolveLocationAndAccessor(locationOrName,arrayValue,Object.assign({size:arrayValue.length},2<arguments.length&&
void 0!==arguments[2]?arguments[2]:{})),location=_this$_resolveLocatio2.location;_this$_resolveLocatio2=_this$_resolveLocatio2.accessor;0<=location&&(arrayValue=this.vertexArrayObject._normalizeConstantArrayValue(arrayValue),this.values[location]=arrayValue,this.accessors[location]=_this$_resolveLocatio2,this.clearDrawParams(),this.vertexArrayObject.enable(location,!1));return this}},{key:"unbindBuffers",value:function(){var _this2=this;this.vertexArrayObject.bind(function(){_this2.elements&&_this2.vertexArrayObject.setElementBuffer(null);
_this2.buffer=_this2.buffer||new _buffer["default"](_this2.gl,{accessor:{size:4}});for(var location=0;location<_this2.vertexArrayObject.MAX_ATTRIBUTES;location++)_this2.values[location]instanceof _buffer["default"]&&(_this2.gl.disableVertexAttribArray(location),_this2.gl.bindBuffer(34962,_this2.buffer.handle),_this2.gl.vertexAttribPointer(location,1,5126,!1,0,0))});return this}},{key:"bindBuffers",value:function(){var _this3=this;this.vertexArrayObject.bind(function(){_this3.elements&&_this3.setElementBuffer(_this3.elements);
for(var location=0;location<_this3.vertexArrayObject.MAX_ATTRIBUTES;location++){var buffer=_this3.values[location];buffer instanceof _buffer["default"]&&_this3.setBuffer(location,buffer)}});return this}},{key:"bindForDraw",value:function(vertexCount,instanceCount,func){var _this4=this,value;this.vertexArrayObject.bind(function(){_this4._setConstantAttributes(vertexCount,instanceCount);value=func()});return value}},{key:"_resolveLocationAndAccessor",value:function(locationOrName,value,valueAccessor,
appAccessor){var _this5=this,INVALID_RESULT={location:-1,accessor:null},_this$_getAttributeIn=this._getAttributeIndex(locationOrName),location=_this$_getAttributeIn.location;_this$_getAttributeIn=_this$_getAttributeIn.name;if(!Number.isFinite(location)||0>location)return this.unused[locationOrName]=value,_gltools.log.once(3,function(){return"unused value ".concat(locationOrName," in ").concat(_this5.id)})(),INVALID_RESULT;value=this._getAttributeInfo(_this$_getAttributeIn||location);if(!value)return INVALID_RESULT;
valueAccessor=_accessor2["default"].resolve(value.accessor,this.accessors[location]||{},valueAccessor,appAccessor);appAccessor=valueAccessor.size;INVALID_RESULT=valueAccessor.type;(0,_utils.assert)(Number.isFinite(appAccessor)&&Number.isFinite(INVALID_RESULT));return{location,accessor:valueAccessor}}},{key:"_getAttributeInfo",value:function(attributeName){return this.configuration&&this.configuration.getAttributeInfo(attributeName)}},{key:"_getAttributeIndex",value:function(locationOrName){var location=
Number(locationOrName);if(Number.isFinite(location))return{location};locationOrName=(location=MULTI_LOCATION_ATTRIBUTE_REGEXP.exec(locationOrName))?location[1]:locationOrName;location=location?Number(location[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(locationOrName)+location,name:locationOrName}:{location:-1}}},{key:"_setAttribute",value:function(locationOrName,value){if(value instanceof _buffer["default"])this.setBuffer(locationOrName,value);else if(Array.isArray(value)&&
value.length&&value[0]instanceof _buffer["default"])this.setBuffer(locationOrName,value[0],value[1]);else if(ArrayBuffer.isView(value)||Array.isArray(value))this.setConstant(locationOrName,value);else if(value.buffer instanceof _buffer["default"])this.setBuffer(locationOrName,value.buffer,value);else throw Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");}},{key:"_setConstantAttributes",value:function(vertexCount,instanceCount){instanceCount=Math.max(vertexCount|0,
instanceCount|0);vertexCount=this.values[0];ArrayBuffer.isView(vertexCount)&&this._setConstantAttributeZero(vertexCount,instanceCount);for(instanceCount=1;instanceCount<this.vertexArrayObject.MAX_ATTRIBUTES;instanceCount++)vertexCount=this.values[instanceCount],ArrayBuffer.isView(vertexCount)&&this._setConstantAttribute(instanceCount,vertexCount)}},{key:"_setConstantAttributeZero",value:function(constant,elementCount){_vertexArrayObject["default"].isSupported(this.gl,{constantAttributeZero:!0})?this._setConstantAttribute(0,
constant):(constant=this.vertexArrayObject.getConstantBuffer(elementCount,constant),this.vertexArrayObject.setBuffer(0,constant,this.accessors[0]))}},{key:"_setConstantAttribute",value:function(location,constant){_vertexArrayObject["default"].setConstant(this.gl,location,constant)}},{key:"_updateDrawParams",value:function(){for(var drawParams={isIndexed:!1,isInstanced:!1,indexCount:Infinity,vertexCount:Infinity,instanceCount:Infinity},location=0;location<this.vertexArrayObject.MAX_ATTRIBUTES;location++)this._updateDrawParamsForLocation(drawParams,
location);this.elements&&(drawParams.elementCount=this.elements.getElementCount(this.elements.accessor),drawParams.isIndexed=!0,drawParams.indexType=this.elementsAccessor.type||this.elements.accessor.type,drawParams.indexOffset=this.elementsAccessor.offset||0);Infinity===drawParams.indexCount&&(drawParams.indexCount=0);Infinity===drawParams.vertexCount&&(drawParams.vertexCount=0);Infinity===drawParams.instanceCount&&(drawParams.instanceCount=0);return drawParams}},{key:"_updateDrawParamsForLocation",
value:function(drawParams,location){var value=this.values[location];location=this.accessors[location];if(value){var isInstanced=0<location.divisor;drawParams.isInstanced=drawParams.isInstanced||isInstanced;value instanceof _buffer["default"]&&(isInstanced?(value=value.getVertexCount(location),drawParams.instanceCount=Math.min(drawParams.instanceCount,value)):(value=value.getVertexCount(location),drawParams.vertexCount=Math.min(drawParams.vertexCount,value)))}}},{key:"setElements",value:function(){var elementBuffer=
0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,accessor=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_gltools.log.deprecated("setElements","setElementBuffer")();return this.setElementBuffer(elementBuffer,accessor)}}]);return VertexArray}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$vertex_array.js.map
