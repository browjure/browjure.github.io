shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$viewports$globe_viewport=function(global,require,module,exports){function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2["default"])(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;Super=Reflect.construct(Super,arguments,NewTarget)}else Super=Super.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,
Super)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function transformVector(matrix,vector){matrix=vec4.transformMat4([],vector,matrix);vec4.scale(matrix,matrix,1/matrix[3]);return matrix}global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard");module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");
Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _slicedToArray2=module(require("module$node_modules$$babel$runtime$helpers$slicedToArray")),_classCallCheck2=module(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=module(require("module$node_modules$$babel$runtime$helpers$createClass")),_inherits2=module(require("module$node_modules$$babel$runtime$helpers$inherits")),_possibleConstructorReturn2=module(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),
_getPrototypeOf2=module(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_math=require("module$node_modules$math_DOT_gl$dist$es5$index");module=module(require("module$node_modules$$deck_DOT_gl$core$dist$es5$viewports$viewport"));var _constants=require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$constants"),vec3=global(require("module$node_modules$gl_matrix$cjs$vec3")),vec4=global(require("module$node_modules$gl_matrix$cjs$vec4")),DEGREES_TO_RADIANS=Math.PI/180,RADIANS_TO_DEGREES=
180/Math.PI;require=function(_Viewport){function GlobeViewport(){var _this=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};(0,_classCallCheck2["default"])(this,GlobeViewport);var _opts$latitude=_this.latitude;_opts$latitude=void 0===_opts$latitude?0:_opts$latitude;var _opts$longitude=_this.longitude;_opts$longitude=void 0===_opts$longitude?0:_opts$longitude;var _opts$zoom=_this.zoom;_opts$zoom=void 0===_opts$zoom?11:_opts$zoom;var _opts$nearZMultiplier=_this.nearZMultiplier;_opts$nearZMultiplier=
void 0===_opts$nearZMultiplier?.1:_opts$nearZMultiplier;var _opts$farZMultiplier=_this.farZMultiplier,farZMultiplier=void 0===_opts$farZMultiplier?2:_opts$farZMultiplier;_opts$farZMultiplier=_this.resolution;_opts$farZMultiplier=void 0===_opts$farZMultiplier?10:_opts$farZMultiplier;var width=_this.width,height=_this.height,_opts$altitude=_this.altitude;width=width||1;height=height||1;_opts$altitude=Math.max(.75,void 0===_opts$altitude?1.5:_opts$altitude);var viewMatrix=(new _math.Matrix4).lookAt({eye:[0,
-_opts$altitude,0],up:[0,0,1]}),scale=Math.pow(2,_opts$zoom);viewMatrix.rotateX(_opts$latitude*DEGREES_TO_RADIANS);viewMatrix.rotateZ(-_opts$longitude*DEGREES_TO_RADIANS);viewMatrix.scale(scale/height);_this=Object.assign({},_this,{width,height,viewMatrix,longitude:_opts$longitude,latitude:_opts$latitude,zoom:_opts$zoom,fovyRadians:2*Math.atan(.5/_opts$altitude),aspect:width/height,focalDistance:_opts$altitude,near:_opts$nearZMultiplier,far:Math.min(2,1/(512*scale/height)+1)*_opts$altitude*farZMultiplier});
_this=_super.call(this,_this);_this.resolution=_opts$farZMultiplier;_opts$latitude=256/6370972;_opts$longitude=Math.PI/180*256;_this.distanceScales={unitsPerMeter:[_opts$latitude,_opts$latitude,_opts$latitude],unitsPerMeter2:[0,0,0],metersPerUnit:[1/_opts$latitude,1/_opts$latitude,1/_opts$latitude],unitsPerDegree:[_opts$longitude,_opts$longitude,_opts$latitude],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/_opts$longitude,1/_opts$longitude,1/_opts$latitude]};return _this}(0,_inherits2["default"])(GlobeViewport,
_Viewport);var _super=_createSuper(GlobeViewport);(0,_createClass2["default"])(GlobeViewport,[{key:"getDistanceScales",value:function(){return this.distanceScales}},{key:"getBounds",value:function(){var unprojectOption={targetZ:(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).z||0},left=this.unproject([0,this.height/2],unprojectOption),top=this.unproject([this.width/2,0],unprojectOption),right=this.unproject([this.width,this.height/2],unprojectOption);unprojectOption=this.unproject([this.width/
2,this.height],unprojectOption);right[0]<this.longitude&&(right[0]+=360);left[0]>this.longitude&&(left[0]-=360);return[Math.min(left[0],right[0],top[0],unprojectOption[0]),Math.min(left[1],right[1],top[1],unprojectOption[1]),Math.max(left[0],right[0],top[0],unprojectOption[0]),Math.max(left[1],right[1],top[1],unprojectOption[1])]}},{key:"unproject",value:function(xyz){var _ref=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref$topLeft=_ref.topLeft,topLeft=void 0===_ref$topLeft?!0:_ref$topLeft;
_ref=_ref.targetZ;_ref$topLeft=(0,_slicedToArray2["default"])(xyz,3);var x=_ref$topLeft[0],y=_ref$topLeft[1];_ref$topLeft=_ref$topLeft[2];y=topLeft?y:this.height-y;var pixelUnprojectionMatrix=this.pixelUnprojectionMatrix;if(Number.isFinite(_ref$topLeft))topLeft=transformVector(pixelUnprojectionMatrix,[x,y,_ref$topLeft,1]);else{topLeft=transformVector(pixelUnprojectionMatrix,[x,y,-1,1]);x=transformVector(pixelUnprojectionMatrix,[x,y,1,1]);y=256*((_ref||0)/6370972+1);pixelUnprojectionMatrix=vec3.sqrLen(vec3.sub([],
topLeft,x));var l0Sqr=vec3.sqrLen(topLeft),l1Sqr=vec3.sqrLen(x);l1Sqr=(4*l0Sqr*l1Sqr-Math.pow(pixelUnprojectionMatrix-l0Sqr-l1Sqr,2))/16*4/pixelUnprojectionMatrix;topLeft=vec3.lerp([],topLeft,x,(Math.sqrt(l0Sqr-l1Sqr)-Math.sqrt(Math.max(0,y*y-l1Sqr)))/Math.sqrt(pixelUnprojectionMatrix))}topLeft=this.unprojectPosition(topLeft);y=(0,_slicedToArray2["default"])(topLeft,3);topLeft=y[0];x=y[1];y=y[2];return Number.isFinite(_ref$topLeft)?[topLeft,x,y]:Number.isFinite(_ref)?[topLeft,x,_ref]:[topLeft,x]}},
{key:"projectPosition",value:function(xyz){var _xyz2=(0,_slicedToArray2["default"])(xyz,3),_xyz2$=_xyz2[2];xyz=_xyz2[0]*DEGREES_TO_RADIANS;_xyz2=_xyz2[1]*DEGREES_TO_RADIANS;var cosPhi=Math.cos(_xyz2);_xyz2$=256*((void 0===_xyz2$?0:_xyz2$)/6370972+1);return[Math.sin(xyz)*cosPhi*_xyz2$,-Math.cos(xyz)*cosPhi*_xyz2$,Math.sin(_xyz2)*_xyz2$]}},{key:"unprojectPosition",value:function(xyz){var _xyz3=(0,_slicedToArray2["default"])(xyz,3),x=_xyz3[0],y=_xyz3[1];_xyz3=_xyz3[2];xyz=vec3.len(xyz);return[Math.atan2(x,
-y)*RADIANS_TO_DEGREES,Math.asin(_xyz3/xyz)*RADIANS_TO_DEGREES,6370972*(xyz/256-1)]}},{key:"projectFlat",value:function(xyz){return xyz}},{key:"unprojectFlat",value:function(xyz){return xyz}},{key:"getMapCenterByLngLatPosition",value:function(_ref2){var lngLat=_ref2.lngLat;_ref2=this.unproject(_ref2.pos);return[lngLat[0]-_ref2[0]+this.longitude,lngLat[1]-_ref2[1]+this.latitude]}},{key:"projectionMode",get:function(){return _constants.PROJECTION_MODE.GLOBE}}]);return GlobeViewport}(module["default"]);
exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$viewports$globe_viewport.js.map
