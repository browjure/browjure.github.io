{
"version":3,
"file":"module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$lib$request_utils$request_scheduler.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/@loaders_DOT_gl/loader-utils/dist/es5/lib/request-utils/request-scheduler.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$lib$request_utils$request_scheduler\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _stats = require(\"@probe.gl/stats\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar STAT_QUEUED_REQUESTS = 'Queued Requests';\nvar STAT_ACTIVE_REQUESTS = 'Active Requests';\nvar STAT_CANCELLED_REQUESTS = 'Cancelled Requests';\nvar STAT_QUEUED_REQUESTS_EVER = 'Queued Requests Ever';\nvar STAT_ACTIVE_REQUESTS_EVER = 'Active Requests Ever';\nvar DEFAULT_PROPS = {\n  id: 'request-scheduler',\n  throttleRequests: true,\n  maxRequests: 6\n};\n\nvar RequestScheduler = function () {\n  function RequestScheduler() {\n    var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    (0, _classCallCheck2[\"default\"])(this, RequestScheduler);\n    this.props = _objectSpread(_objectSpread({}, DEFAULT_PROPS), props);\n    this.requestQueue = [];\n    this.activeRequestCount = 0;\n    this.requestMap = new Map();\n    this.stats = new _stats.Stats({\n      id: props.id\n    });\n    this.stats.get(STAT_QUEUED_REQUESTS);\n    this.stats.get(STAT_ACTIVE_REQUESTS);\n    this.stats.get(STAT_CANCELLED_REQUESTS);\n    this.stats.get(STAT_QUEUED_REQUESTS_EVER);\n    this.stats.get(STAT_ACTIVE_REQUESTS_EVER);\n    this._deferredUpdate = null;\n  }\n\n  (0, _createClass2[\"default\"])(RequestScheduler, [{\n    key: \"scheduleRequest\",\n    value: function scheduleRequest(handle) {\n      var getPriority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return 0;\n      };\n\n      if (!this.props.throttleRequests) {\n        return Promise.resolve({\n          done: function done() {}\n        });\n      }\n\n      if (this.requestMap.has(handle)) {\n        return this.requestMap.get(handle);\n      }\n\n      var request = {\n        handle: handle,\n        getPriority: getPriority\n      };\n      var promise = new Promise(function (resolve) {\n        request.resolve = resolve;\n        return request;\n      });\n      this.requestQueue.push(request);\n      this.requestMap.set(handle, promise);\n\n      this._issueNewRequests();\n\n      return promise;\n    }\n  }, {\n    key: \"_issueRequest\",\n    value: function _issueRequest(request) {\n      var _this = this;\n\n      var handle = request.handle,\n          resolve = request.resolve;\n      var isDone = false;\n\n      var done = function done() {\n        if (!isDone) {\n          isDone = true;\n\n          _this.requestMap[\"delete\"](handle);\n\n          _this.activeRequestCount--;\n\n          _this._issueNewRequests();\n        }\n      };\n\n      this.activeRequestCount++;\n      return resolve ? resolve({\n        done: done\n      }) : Promise.resolve({\n        done: done\n      });\n    }\n  }, {\n    key: \"_issueNewRequests\",\n    value: function _issueNewRequests() {\n      var _this2 = this;\n\n      if (!this._deferredUpdate) {\n        this._deferredUpdate = setTimeout(function () {\n          return _this2._issueNewRequestsAsync();\n        }, 0);\n      }\n    }\n  }, {\n    key: \"_issueNewRequestsAsync\",\n    value: function _issueNewRequestsAsync() {\n      this._deferredUpdate = null;\n      var freeSlots = Math.max(this.props.maxRequests - this.activeRequestCount, 0);\n\n      if (freeSlots === 0) {\n        return;\n      }\n\n      this._updateAllRequests();\n\n      for (var i = 0; i < freeSlots; ++i) {\n        if (this.requestQueue.length > 0) {\n          var request = this.requestQueue.shift();\n\n          this._issueRequest(request);\n        }\n      }\n    }\n  }, {\n    key: \"_updateAllRequests\",\n    value: function _updateAllRequests() {\n      var requestQueue = this.requestQueue;\n\n      for (var i = 0; i < requestQueue.length; ++i) {\n        var request = requestQueue[i];\n\n        if (!this._updateRequest(request)) {\n          requestQueue.splice(i, 1);\n          this.requestMap[\"delete\"](request.handle);\n          i--;\n        }\n      }\n\n      requestQueue.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n    }\n  }, {\n    key: \"_updateRequest\",\n    value: function _updateRequest(request) {\n      request.priority = request.getPriority(request.handle);\n\n      if (request.priority < 0) {\n        request.resolve(null);\n        return false;\n      }\n\n      return true;\n    }\n  }]);\n  return RequestScheduler;\n}();\n\nexports[\"default\"] = RequestScheduler;\n//# sourceMappingURL=request-scheduler.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","_interopRequireDefault","value","_classCallCheck2","_createClass2","_stats","DEFAULT_PROPS","id","throttleRequests","maxRequests","RequestScheduler","props","undefined","requestQueue","activeRequestCount","requestMap","Map","stats","Stats","get","STAT_QUEUED_REQUESTS","STAT_ACTIVE_REQUESTS","STAT_CANCELLED_REQUESTS","STAT_QUEUED_REQUESTS_EVER","STAT_ACTIVE_REQUESTS_EVER","_deferredUpdate","scheduleRequest","handle","getPriority","Promise","resolve","done","has","request","promise","set","_issueNewRequests","_issueRequest","_this","isDone","_this2","setTimeout","_issueNewRequestsAsync","freeSlots","Math","max","_updateAllRequests","shift","_updateRequest","splice","sort","a","b","priority"]
}
