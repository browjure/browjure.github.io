shadow$provide.module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$lib$request_utils$request_scheduler=function(global,require,module,exports){function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=
1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");
Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_stats=require("module$node_modules$$probe_DOT_gl$stats$dist$es5$index"),DEFAULT_PROPS={id:"request-scheduler",throttleRequests:!0,maxRequests:6};
require=function(){function RequestScheduler(){var props=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};(0,_classCallCheck2["default"])(this,RequestScheduler);this.props=_objectSpread(_objectSpread({},DEFAULT_PROPS),props);this.requestQueue=[];this.activeRequestCount=0;this.requestMap=new Map;this.stats=new _stats.Stats({id:props.id});this.stats.get("Queued Requests");this.stats.get("Active Requests");this.stats.get("Cancelled Requests");this.stats.get("Queued Requests Ever");this.stats.get("Active Requests Ever");
this._deferredUpdate=null}(0,_createClass2["default"])(RequestScheduler,[{key:"scheduleRequest",value:function(handle){var getPriority=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return 0};if(!this.props.throttleRequests)return Promise.resolve({done:function(){}});if(this.requestMap.has(handle))return this.requestMap.get(handle);var request={handle,getPriority};getPriority=new Promise(function(resolve){request.resolve=resolve;return request});this.requestQueue.push(request);
this.requestMap.set(handle,getPriority);this._issueNewRequests();return getPriority}},{key:"_issueRequest",value:function(request){var _this=this,handle=request.handle;request=request.resolve;var isDone=!1,done=function(){isDone||(isDone=!0,_this.requestMap["delete"](handle),_this.activeRequestCount--,_this._issueNewRequests())};this.activeRequestCount++;return request?request({done}):Promise.resolve({done})}},{key:"_issueNewRequests",value:function(){var _this2=this;this._deferredUpdate||(this._deferredUpdate=
setTimeout(function(){return _this2._issueNewRequestsAsync()},0))}},{key:"_issueNewRequestsAsync",value:function(){this._deferredUpdate=null;var freeSlots=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==freeSlots){this._updateAllRequests();for(var i=0;i<freeSlots;++i)if(0<this.requestQueue.length){var request=this.requestQueue.shift();this._issueRequest(request)}}}},{key:"_updateAllRequests",value:function(){for(var requestQueue=this.requestQueue,i=0;i<requestQueue.length;++i){var request=
requestQueue[i];this._updateRequest(request)||(requestQueue.splice(i,1),this.requestMap["delete"](request.handle),i--)}requestQueue.sort(function(a,b){return a.priority-b.priority})}},{key:"_updateRequest",value:function(request){request.priority=request.getPriority(request.handle);return 0>request.priority?(request.resolve(null),!1):!0}}]);return RequestScheduler}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$lib$request_utils$request_scheduler.js.map
