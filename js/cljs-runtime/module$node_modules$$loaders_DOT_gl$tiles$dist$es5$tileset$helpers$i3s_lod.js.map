{
"version":3,
"file":"module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$helpers$i3s_lod.js",
"lineCount":7,
"mappings":"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",
"sources":["node_modules/@loaders_DOT_gl/tiles/dist/es5/tileset/helpers/i3s-lod.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$helpers$i3s_lod\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.lodJudge = lodJudge;\nexports.getI3ScreenSize = getI3ScreenSize;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _core = require(\"@math.gl/core\");\n\nvar WGS84_RADIUS_X = 6378137.0;\nvar qualityFactor = Math.PI / 2;\n\nfunction lodJudge(tile, frameState) {\n  var viewport = frameState.viewport;\n  var metersPerPixel = viewport.metersPerPixel;\n  var mbsLat = tile.header.mbs[1];\n  var mbsLon = tile.header.mbs[0];\n  var mbsZ = tile.header.mbs[2];\n  var mbsR = tile.header.mbs[3];\n  var height = viewport.height,\n      width = viewport.width,\n      latitude = viewport.latitude,\n      longitude = viewport.longitude;\n  var viewportCenter = [longitude, latitude];\n  var mbsCenter = [mbsLon, mbsLat, mbsZ];\n  var mbsLatProjected = [longitude, mbsLat];\n  var mbsLonProjected = [mbsLon, latitude];\n  var diagonalInMeters = Math.sqrt(height * height + width * width) * metersPerPixel[0];\n  var distanceInMeters = getDistanceFromLatLon(viewportCenter, mbsCenter);\n  var visibleHeight = height * 0.5 + mbsR / WGS84_RADIUS_X;\n  var visibleWidth = width * 0.5 + mbsR / WGS84_RADIUS_X;\n\n  if (distanceInMeters > diagonalInMeters + mbsR / WGS84_RADIUS_X) {\n    return 'OUT';\n  }\n\n  if (getDistanceFromLatLon(viewportCenter, mbsLatProjected) > visibleHeight) {\n    return 'OUT';\n  }\n\n  if (getDistanceFromLatLon(viewportCenter, mbsLonProjected) > visibleWidth) {\n    return 'OUT';\n  }\n\n  if (tile.lodMetricValue === 0) {\n    return 'DIG';\n  }\n\n  var screenSize = getI3ScreenSize(tile, frameState);\n  screenSize *= qualityFactor;\n\n  if (screenSize < 0.5) {\n    return 'OUT';\n  }\n\n  if (!tile.header.children || screenSize <= tile.lodMetricValue) {\n    return 'DRAW';\n  } else if (tile.header.children) {\n    return 'DIG';\n  }\n\n  return 'OUT';\n}\n\nfunction projectVertexToSphere(_ref) {\n  var _ref2 = (0, _slicedToArray2[\"default\"])(_ref, 3),\n      x = _ref2[0],\n      y = _ref2[1],\n      z = _ref2[2];\n\n  var azim = (0, _core.toRadians)(x);\n  var incl = (0, _core.toRadians)(y);\n  var radius = 1.0 + z / WGS84_RADIUS_X;\n  var radCosInc = radius * Math.cos(incl);\n  x = radCosInc * Math.cos(azim);\n  y = radCosInc * Math.sin(azim);\n  z = radius * Math.sin(incl);\n  return [x, y, z];\n}\n\nfunction getDistanceFromLatLon(_ref3, _ref4) {\n  var _ref5 = (0, _slicedToArray2[\"default\"])(_ref3, 3),\n      observerLon = _ref5[0],\n      observerLat = _ref5[1],\n      _ref5$ = _ref5[2],\n      observerZ = _ref5$ === void 0 ? 0.0 : _ref5$;\n\n  var _ref6 = (0, _slicedToArray2[\"default\"])(_ref4, 3),\n      centerLon = _ref6[0],\n      centerLat = _ref6[1],\n      _ref6$ = _ref6[2],\n      centerZ = _ref6$ === void 0 ? 0.0 : _ref6$;\n\n  var projectedCenter = projectVertexToSphere([centerLon, centerLat, centerZ]);\n  var projectedObserver = projectVertexToSphere([observerLon, observerLat, observerZ]);\n  var dx = projectedObserver[0] - projectedCenter[0];\n  var dy = projectedObserver[1] - projectedCenter[1];\n  var dz = projectedObserver[2] - projectedCenter[2];\n  return dx * dx + dy * dy + dz * dz;\n}\n\nfunction getI3ScreenSize(tile, frameState) {\n  var viewport = frameState.viewport;\n  var mbsLat = tile.header.mbs[1];\n  var mbsLon = tile.header.mbs[0];\n  var mbsZ = tile.header.mbs[2];\n  var mbsR = tile.header.mbs[3];\n  var mbsCenter = [mbsLon, mbsLat, mbsZ];\n  var cameraPositionCartographic = viewport.unprojectPosition(viewport.cameraPosition);\n  var dSquared = getDistanceFromLatLon(cameraPositionCartographic, mbsCenter);\n  var mbsRNormalized = mbsR / WGS84_RADIUS_X;\n  var d = dSquared - mbsRNormalized * mbsRNormalized;\n  var fltMax = 3.4028235e38;\n\n  if (d <= 0.0) {\n    return 0.5 * fltMax;\n  }\n\n  var screenSizeFactor = calculateScreenSizeFactor(tile, frameState);\n  screenSizeFactor *= mbsRNormalized / Math.sqrt(d) / viewport.scale;\n  return screenSizeFactor;\n}\n\nfunction calculateScreenSizeFactor(tile, frameState) {\n  var _frameState$viewport = frameState.viewport,\n      width = _frameState$viewport.width,\n      height = _frameState$viewport.height,\n      pixelProjectionMatrix = _frameState$viewport.pixelProjectionMatrix;\n  var tanOfHalfVFAngle = Math.tan(Math.atan(Math.sqrt(1.0 / (pixelProjectionMatrix[0] * pixelProjectionMatrix[0]) + 1.0 / (pixelProjectionMatrix[5] * pixelProjectionMatrix[5]))));\n  var screenCircleFactor = Math.sqrt(height * height + width * width) / tanOfHalfVFAngle;\n  return screenCircleFactor;\n}\n//# sourceMappingURL=i3s-lod.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","projectVertexToSphere","_ref","_ref2","_slicedToArray2","x","y","z","azim","_core","toRadians","incl","radius","WGS84_RADIUS_X","radCosInc","Math","cos","sin","getDistanceFromLatLon","_ref3","_ref4","_ref5","observerLon","observerLat","_ref5$","observerZ","_ref6","_ref6$","projectedCenter","centerLon","centerLat","centerZ","projectedObserver","dx","dy","dz","getI3ScreenSize","tile","frameState","viewport","mbsR","header","mbs","mbsCenter","mbsLon","mbsLat","mbsZ","cameraPositionCartographic","unprojectPosition","cameraPosition","dSquared","mbsRNormalized","d","fltMax","_frameState$viewport","width","height","pixelProjectionMatrix","sqrt","tanOfHalfVFAngle","tan","atan","screenSizeFactor","scale","_interopRequireDefault","Object","defineProperty","value","lodJudge","latitude","longitude","viewportCenter","mbsLatProjected","mbsLonProjected","diagonalInMeters","metersPerPixel","distanceInMeters","visibleHeight","visibleWidth","lodMetricValue","screenSize","qualityFactor","children","PI"]
}
