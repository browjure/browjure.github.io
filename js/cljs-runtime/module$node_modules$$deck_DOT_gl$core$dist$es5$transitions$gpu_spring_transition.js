shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$transitions$gpu_spring_transition=function(global,require,module,exports){function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=
null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||
(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},
n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,
minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),
_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_core=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),_attributeTransitionUtils=require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$attribute_transition_utils"),_attribute=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$attribute$attribute")),_transition=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$transitions$transition"));require=function(){function GPUSpringTransition(_ref){var gl=
_ref.gl,attribute=_ref.attribute;_ref=_ref.timeline;(0,_classCallCheck2["default"])(this,GPUSpringTransition);this.gl=gl;this.type="spring";this.transition=new _transition["default"](_ref);this.attribute=attribute;this.attributeInTransition=new _attribute["default"](gl,Object.assign({},attribute.settings,{normalized:!1}));this.currentStartIndices=attribute.startIndices;this.currentLength=0;_ref=this.texture=new _core.Texture2D(gl,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,
width:1,height:1});_ref=this.framebuffer=new _core.Framebuffer(gl,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:(0,_defineProperty2["default"])({},36064,_ref)});attribute=(0,_attributeTransitionUtils.getAttributeTypeFromSize)(attribute.size);this.transform=new _core.Transform(gl,{framebuffer:_ref,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity \x3d cur - prev;\n  ATTRIBUTE_TYPE delta \x3d dest - cur;\n  ATTRIBUTE_TYPE spring \x3d delta * stiffness;\n  ATTRIBUTE_TYPE damper \x3d velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning \x3d length(aCur - aPrev) \x3e EPSILON || length(aTo - aCur) \x3e EPSILON;\n  vIsTransitioningFlag \x3d isTransitioning ? 1.0 : 0.0;\n\n  vNext \x3d getNextValue(aCur, aPrev, aTo);\n  gl_Position \x3d vec4(0, 0, 0, 1);\n  gl_PointSize \x3d 100.0;\n}\n",
fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag \x3d\x3d 0.0) {\n    discard;\n  }\n  gl_FragColor \x3d vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:attribute},varyings:["vNext"]});attribute={byteLength:0,usage:35050};this.buffers=[new _core.Buffer(gl,attribute),new _core.Buffer(gl,attribute),new _core.Buffer(gl,attribute)]}(0,_createClass2["default"])(GPUSpringTransition,[{key:"start",value:function(transitionSettings,
numInstances){var gl=this.gl,buffers=this.buffers,attribute=this.attribute,padBufferOpts={numInstances,attribute,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:transitionSettings.enter},_iterator=_createForOfIteratorHelper(buffers),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var buffer=_step.value;(0,_attributeTransitionUtils.padBuffer)(_objectSpread({buffer},padBufferOpts))}}catch(err){_iterator.e(err)}finally{_iterator.f()}this.currentStartIndices=
attribute.startIndices;this.currentLength=(0,_attributeTransitionUtils.getAttributeBufferLength)(attribute,numInstances);this.attributeInTransition.update({buffer:buffers[1],value:attribute.value});this.transition.start(transitionSettings);this.transform.update({elementCount:Math.floor(this.currentLength/attribute.size),sourceBuffers:{aTo:(0,_attributeTransitionUtils.getSourceBufferAttribute)(gl,attribute)}})}},{key:"update",value:function(){var buffers=this.buffers,transform=this.transform,framebuffer=
this.framebuffer,transition=this.transition;if(!transition.update())return!1;transform.update({sourceBuffers:{aPrev:buffers[0],aCur:buffers[1]},feedbackBuffers:{vNext:buffers[2]}});transform.run({framebuffer,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:transition.settings.stiffness,damping:transition.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}});(0,_attributeTransitionUtils.cycleBuffers)(buffers);this.attributeInTransition.update({buffer:buffers[1],
value:this.attribute.value});0<(0,_core.readPixelsToArray)(framebuffer)[0]||transition.end();return!0}},{key:"cancel",value:function(){this.transition.cancel();for(this.transform["delete"]();this.buffers.length;)this.buffers.pop()["delete"]();this.texture["delete"]();this.texture=null;this.framebuffer["delete"]();this.framebuffer=null}},{key:"inProgress",get:function(){return this.transition.inProgress}}]);return GPUSpringTransition}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$transitions$gpu_spring_transition.js.map
