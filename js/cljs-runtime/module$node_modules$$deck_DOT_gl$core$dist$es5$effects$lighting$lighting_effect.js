shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$effects$lighting$lighting_effect=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _createSuper(Derived){var hasNativeReflectConstruct=
_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2["default"])(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;Super=Reflect.construct(Super,arguments,NewTarget)}else Super=Super.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,Super)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;
try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits")),
_possibleConstructorReturn2=global(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=global(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf")),_core=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),_ambientLight=require("module$node_modules$$deck_DOT_gl$core$dist$es5$effects$lighting$ambient_light"),_directionalLight=require("module$node_modules$$deck_DOT_gl$core$dist$es5$effects$lighting$directional_light");module=
global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$effect"));var _math=require("module$node_modules$math_DOT_gl$dist$es5$index"),_shadowPass=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$passes$shadow_pass")),_shadow=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$shaderlib$shadow$shadow")),DEFAULT_AMBIENT_LIGHT_PROPS={color:[255,255,255],intensity:1},DEFAULT_DIRECTIONAL_LIGHT_PROPS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,
255,255],intensity:.9,direction:[1,-8,-2.5]}],DEFAULT_SHADOW_COLOR=[0,0,0,200/255];require=function(_Effect){function LightingEffect(props){(0,_classCallCheck2["default"])(this,LightingEffect);var _this=_super.call(this,props);_this.ambientLight=null;_this.directionalLights=[];_this.pointLights=[];_this.shadowColor=DEFAULT_SHADOW_COLOR;_this.shadowPasses=[];_this.shadowMaps=[];_this.dummyShadowMap=null;_this.shadow=!1;_this.programManager=null;for(var key in props){var lightSource=props[key];switch(lightSource.type){case "ambient":_this.ambientLight=
lightSource;break;case "directional":_this.directionalLights.push(lightSource);break;case "point":_this.pointLights.push(lightSource)}}_this._applyDefaultLights();_this.shadow=_this.directionalLights.some(function(light){return light.shadow});return _this}(0,_inherits2["default"])(LightingEffect,_Effect);var _super=_createSuper(LightingEffect);(0,_createClass2["default"])(LightingEffect,[{key:"preRender",value:function(gl,_ref){var layers=_ref.layers,layerFilter=_ref.layerFilter,viewports=_ref.viewports,
onViewportActive=_ref.onViewportActive;_ref=_ref.views;if(this.shadow)for(this.shadowMatrices=this._createLightMatrix(),0===this.shadowPasses.length&&this._createShadowPasses(gl),this.programManager||(this.programManager=_core.ProgramManager.getDefaultProgramManager(gl),_shadow["default"]&&this.programManager.addDefaultModule(_shadow["default"])),this.dummyShadowMap||(this.dummyShadowMap=new _core.Texture2D(gl,{width:1,height:1})),gl=0;gl<this.shadowPasses.length;gl++)this.shadowPasses[gl].render({layers,
layerFilter,viewports,onViewportActive,views:_ref,moduleParameters:{shadowLightId:gl,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}},{key:"getModuleParameters",value:function(layer){var parameters=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};parameters.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(function(directionalLight){return directionalLight.getProjectedLight({layer})}),
pointLights:this.pointLights.map(function(pointLight){return pointLight.getProjectedLight({layer})})};return parameters}},{key:"cleanup",value:function(){var _iterator=_createForOfIteratorHelper(this.shadowPasses),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;)_step.value["delete"]()}catch(err){_iterator.e(err)}finally{_iterator.f()}this.shadowPasses.length=0;this.shadowMaps.length=0;this.dummyShadowMap&&(this.dummyShadowMap["delete"](),this.dummyShadowMap=null);this.shadow&&this.programManager&&
(this.programManager.removeDefaultModule(_shadow["default"]),this.programManager=null)}},{key:"_createLightMatrix",value:function(){var lightMatrices=[],_iterator2=_createForOfIteratorHelper(this.directionalLights),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var light=_step2.value,viewMatrix=(new _math.Matrix4).lookAt({eye:(new _math.Vector3(light.direction)).negate()});lightMatrices.push(viewMatrix)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return lightMatrices}},{key:"_createShadowPasses",
value:function(gl){for(var i=0;i<this.directionalLights.length;i++){var shadowPass=new _shadowPass["default"](gl);this.shadowPasses[i]=shadowPass;this.shadowMaps[i]=shadowPass.shadowMap}}},{key:"_applyDefaultLights",value:function(){var pointLights=this.pointLights,directionalLights=this.directionalLights;this.ambientLight||0!==pointLights.length||0!==directionalLights.length||(this.ambientLight=new _ambientLight.AmbientLight(DEFAULT_AMBIENT_LIGHT_PROPS),this.directionalLights.push(new _directionalLight.DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[0]),
new _directionalLight.DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[1])))}}]);return LightingEffect}(module["default"]);exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$effects$lighting$lighting_effect.js.map
