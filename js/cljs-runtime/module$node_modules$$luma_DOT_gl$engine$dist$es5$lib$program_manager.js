shadow$provide.module$node_modules$$luma_DOT_gl$engine$dist$es5$lib$program_manager=function(global,require,module$jscomp$0,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");
Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_shadertools=require("module$node_modules$$luma_DOT_gl$shadertools$dist$es5$index"),_webgl=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$index");require=function(){function ProgramManager(gl){(0,_classCallCheck2["default"])(this,
ProgramManager);this.gl=gl;this._programCache={};this._getUniforms={};this._registeredModules={};this._hookFunctions=[];this._defaultModules=[];this._hashes={};this.stateHash=this._hashCounter=0;this._useCounts={}}(0,_createClass2["default"])(ProgramManager,null,[{key:"getDefaultProgramManager",value:function(gl){gl.luma=gl.luma||{};gl.luma.defaultProgramManager=gl.luma.defaultProgramManager||new ProgramManager(gl);return gl.luma.defaultProgramManager}}]);(0,_createClass2["default"])(ProgramManager,
[{key:"addDefaultModule",value:function(module){this._defaultModules.find(function(m){return m.name===module.name})||this._defaultModules.push(module);this.stateHash++}},{key:"removeDefaultModule",value:function(module){var moduleName="string"===typeof module?module:module.name;this._defaultModules=this._defaultModules.filter(function(m){return m.name!==moduleName});this.stateHash++}},{key:"addShaderHook",value:function(hook,opts){opts&&(hook=Object.assign(opts,{hook}));this._hookFunctions.push(hook);
this.stateHash++}},{key:"get",value:function(){var _this=this,props=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},_props$vs=props.vs;_props$vs=void 0===_props$vs?"":_props$vs;var _props$fs=props.fs;_props$fs=void 0===_props$fs?"":_props$fs;var _props$defines=props.defines;_props$defines=void 0===_props$defines?{}:_props$defines;var _props$inject=props.inject;_props$inject=void 0===_props$inject?{}:_props$inject;var _props$varyings=props.varyings;_props$varyings=void 0===_props$varyings?
[]:_props$varyings;var _props$bufferMode=props.bufferMode;_props$bufferMode=void 0===_props$bufferMode?35981:_props$bufferMode;var _props$transpileToGLS=props.transpileToGLSL100;_props$transpileToGLS=void 0===_props$transpileToGLS?!1:_props$transpileToGLS;props=this._getModuleList(props.modules);var vsHash=this._getHash(_props$vs),fsHash=this._getHash(_props$fs),moduleHashes=props.map(function(m){return _this._getHash(m.name)}).sort(),varyingHashes=_props$varyings.map(function(v){return _this._getHash(v)}),
defineKeys=Object.keys(_props$defines).sort(),injectKeys=Object.keys(_props$inject).sort(),defineHashes=[],injectHashes=[];defineKeys=_createForOfIteratorHelper(defineKeys);var _step;try{for(defineKeys.s();!(_step=defineKeys.n()).done;){var key=_step.value;defineHashes.push(this._getHash(key));defineHashes.push(this._getHash(_props$defines[key]))}}catch(err){defineKeys.e(err)}finally{defineKeys.f()}_step=_createForOfIteratorHelper(injectKeys);var _step2;try{for(_step.s();!(_step2=_step.n()).done;){var _key=
_step2.value;injectHashes.push(this._getHash(_key));injectHashes.push(this._getHash(_props$inject[_key]))}}catch(err){_step.e(err)}finally{_step.f()}_step2="".concat(vsHash,"/").concat(fsHash,"D").concat(defineHashes.join("/"),"M").concat(moduleHashes.join("/"),"I").concat(injectHashes.join("/"),"V").concat(varyingHashes.join("/"),"H").concat(this.stateHash,"B").concat(_props$bufferMode).concat(_props$transpileToGLS?"T":"");this._programCache[_step2]||(_props$vs=(0,_shadertools.assembleShaders)(this.gl,
{vs:_props$vs,fs:_props$fs,modules:props,inject:_props$inject,defines:_props$defines,hookFunctions:this._hookFunctions,transpileToGLSL100:_props$transpileToGLS}),this._programCache[_step2]=new _webgl.Program(this.gl,{hash:_step2,vs:_props$vs.vs,fs:_props$vs.fs,varyings:_props$varyings,bufferMode:_props$bufferMode}),this._getUniforms[_step2]=_props$vs.getUniforms||function(x){},this._useCounts[_step2]=0);this._useCounts[_step2]++;return this._programCache[_step2]}},{key:"getUniforms",value:function(program){return this._getUniforms[program.hash]||
null}},{key:"release",value:function(program){program=program.hash;this._useCounts[program]--;0===this._useCounts[program]&&(this._programCache[program]["delete"](),delete this._programCache[program],delete this._getUniforms[program],delete this._useCounts[program])}},{key:"_getHash",value:function(key){void 0===this._hashes[key]&&(this._hashes[key]=this._hashCounter++);return this._hashes[key]}},{key:"_getModuleList",value:function(){for(var appModules=0<arguments.length&&void 0!==arguments[0]?arguments[0]:
[],modules=Array(this._defaultModules.length+appModules.length),seen={},count=0,i=0,len=this._defaultModules.length;i<len;++i){var module=this._defaultModules[i],name=module.name;modules[count++]=module;seen[name]=!0}i=0;for(len=appModules.length;i<len;++i)module=appModules[i],name=module.name,seen[name]||(modules[count++]=module,seen[name]=!0);modules.length=count;return modules}}]);return ProgramManager}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$engine$dist$es5$lib$program_manager.js.map
