shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$passes$layers_pass=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _createSuper(Derived){var hasNativeReflectConstruct=
_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2["default"])(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;Super=Reflect.construct(Super,arguments,NewTarget)}else Super=Super.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,Super)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;
try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function layerIndexResolver(){var startIndex=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,layerIndices=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},resolvers={};return function resolveLayerIndex(layer,isDrawn){var indexOverride=layer.props._offset,layerId=layer.id,parentId=layer.parent&&layer.parent.id;!parentId||parentId in layerIndices||resolveLayerIndex(layer.parent,!1);
parentId in resolvers?(indexOverride=resolvers[parentId]=resolvers[parentId]||layerIndexResolver(layerIndices[parentId],layerIndices),layer=indexOverride(layer,isDrawn),resolvers[layerId]=indexOverride):Number.isFinite(indexOverride)?(layer=indexOverride+(layerIndices[parentId]||0),resolvers[layerId]=null):layer=startIndex;isDrawn&&layer>=startIndex&&(startIndex=layer+1);return layerIndices[layerId]=layer}}function getGLViewport(gl,_ref3){var height=gl.canvas?gl.canvas.clientHeight||gl.canvas.height:
100;_ref3=_ref3.viewport;gl=(0,_core.cssToDeviceRatio)(gl);return[_ref3.x*gl,(height-_ref3.y-_ref3.height)*gl,_ref3.width*gl,_ref3.height*gl]}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports.layerIndexResolver=layerIndexResolver;exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),
_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits")),_possibleConstructorReturn2=global(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=global(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf"));module=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$passes$pass"));var _core=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),_log=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$log"));
require=function(_Pass){function LayersPass(){(0,_classCallCheck2["default"])(this,LayersPass);return _super.apply(this,arguments)}(0,_inherits2["default"])(LayersPass,_Pass);var _super=_createSuper(LayersPass);(0,_createClass2["default"])(LayersPass,[{key:"render",value:function(props){var gl=this.gl;(0,_core.setParameters)(gl,{framebuffer:props.target});return this._drawLayers(props)}},{key:"_drawLayers",value:function(props){var viewports=props.viewports,views=props.views,onViewportActive=props.onViewportActive,
_props$clearCanvas=props.clearCanvas,gl=this.gl;if(void 0===_props$clearCanvas||_props$clearCanvas){_props$clearCanvas=gl.drawingBufferWidth;var height=gl.drawingBufferHeight;(0,_core.setParameters)(gl,{viewport:[0,0,_props$clearCanvas,height]});gl.clear(16640)}_props$clearCanvas=[];viewports=_createForOfIteratorHelper(viewports);var _step;try{for(viewports.s();!(_step=viewports.n()).done;){var viewportOrDescriptor=_step.value,viewport=viewportOrDescriptor.viewport||viewportOrDescriptor,view=views&&
views[viewport.id];onViewportActive(viewport);var drawLayerParams=this._getDrawLayerParams(viewport,props);props.view=view;var _iterator2=_createForOfIteratorHelper(viewport.subViewports||[viewport]),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){props.viewport=_step2.value;var stats=this._drawLayersInViewport(gl,props,drawLayerParams);_props$clearCanvas.push(stats)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}catch(err){viewports.e(err)}finally{viewports.f()}return _props$clearCanvas}},
{key:"_getDrawLayerParams",value:function(viewport,_ref){var layers=_ref.layers,_ref$pass=_ref.pass;_ref$pass=void 0===_ref$pass?"unknown":_ref$pass;var layerFilter=_ref.layerFilter,effects=_ref.effects;_ref=_ref.moduleParameters;for(var drawLayerParams=[],indexResolver=layerIndexResolver(),layerIndex=0;layerIndex<layers.length;layerIndex++){var layer=layers[layerIndex],shouldDrawLayer=this._shouldDrawLayer(layer,viewport,_ref$pass,layerFilter),layerRenderIndex=indexResolver(layer,shouldDrawLayer);
layerRenderIndex={shouldDrawLayer,layerRenderIndex};shouldDrawLayer&&(layerRenderIndex.moduleParameters=this._getModuleParameters(layer,effects,_ref$pass,_ref),layerRenderIndex.layerParameters=this.getLayerParameters(layer,layerIndex));drawLayerParams[layerIndex]=layerRenderIndex}return drawLayerParams}},{key:"_drawLayersInViewport",value:function(gl,_ref2,drawLayerParams){var layers=_ref2.layers,onError=_ref2.onError,viewport=_ref2.viewport;_ref2=_ref2.view;var glViewport=getGLViewport(gl,{viewport});
if(_ref2&&_ref2.props.clear){var clearOpts=!0===_ref2.props.clear?{color:!0,depth:!0}:_ref2.props.clear;(0,_core.withParameters)(gl,{scissorTest:!0,scissor:glViewport},function(){return(0,_core.clear)(gl,clearOpts)})}_ref2={totalCount:layers.length,visibleCount:0,compositeCount:0,pickableCount:0};(0,_core.setParameters)(gl,{viewport:glViewport});for(glViewport=0;glViewport<layers.length;glViewport++){var layer=layers[glViewport],_drawLayerParams$laye=drawLayerParams[glViewport],shouldDrawLayer=_drawLayerParams$laye.shouldDrawLayer,
layerRenderIndex=_drawLayerParams$laye.layerRenderIndex,moduleParameters=_drawLayerParams$laye.moduleParameters;_drawLayerParams$laye=_drawLayerParams$laye.layerParameters;shouldDrawLayer&&layer.props.pickable&&_ref2.pickableCount++;if(layer.isComposite)_ref2.compositeCount++;else if(shouldDrawLayer){_ref2.visibleCount++;moduleParameters.viewport=viewport;try{layer.drawLayer({moduleParameters,uniforms:{layerIndex:layerRenderIndex},parameters:_drawLayerParams$laye})}catch(err){onError?onError(err,
layer):_log["default"].error("error during drawing of ".concat(layer),err)()}}}return _ref2}},{key:"shouldDrawLayer",value:function(layer){return!0}},{key:"getModuleParameters",value:function(layer,effects){return null}},{key:"getLayerParameters",value:function(layer,layerIndex){return layer.props.parameters}},{key:"_shouldDrawLayer",value:function(layer,viewport,pass,layerFilter){var shouldDrawLayer=this.shouldDrawLayer(layer)&&layer.props.visible;shouldDrawLayer&&layerFilter&&(shouldDrawLayer=layerFilter({layer,
viewport,isPicking:pass.startsWith("picking"),renderPass:pass}));shouldDrawLayer&&layer.activateViewport(viewport);return shouldDrawLayer}},{key:"_getModuleParameters",value:function(layer,effects,pass,overrides){pass=Object.assign(Object.create(layer.props),{autoWrapLongitude:layer.wrapLongitude,viewport:layer.context.viewport,mousePosition:layer.context.mousePosition,pickingActive:0,devicePixelRatio:(0,_core.cssToDeviceRatio)(this.gl)});if(effects){var _iterator3=_createForOfIteratorHelper(effects),
_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;)Object.assign(pass,_step3.value.getModuleParameters(layer))}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return Object.assign(pass,this.getModuleParameters(layer,effects),overrides)}}]);return LayersPass}(module["default"]);exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$passes$layers_pass.js.map
