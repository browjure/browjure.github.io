shadow$provide.module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$copy_and_blit=function(global,require,module,exports){function readPixelsToArray(source){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_options$sourceX=options.sourceX;_options$sourceX=void 0===_options$sourceX?0:_options$sourceX;var _options$sourceY=options.sourceY;_options$sourceY=void 0===_options$sourceY?0:_options$sourceY;var _options$sourceFormat=options.sourceFormat;_options$sourceFormat=void 0===
_options$sourceFormat?6408:_options$sourceFormat;var _options$sourceAttach=options.sourceAttachment,sourceAttachment=void 0===_options$sourceAttach?36064:_options$sourceAttach;_options$sourceAttach=options.target;var target=void 0===_options$sourceAttach?null:_options$sourceAttach;_options$sourceAttach=options.sourceWidth;var sourceHeight=options.sourceHeight;options=options.sourceType;var _getFramebuffer=getFramebuffer(source),framebuffer=_getFramebuffer.framebuffer;_getFramebuffer=_getFramebuffer.deleteFramebuffer;
(0,_utils.assert)(framebuffer);var gl=framebuffer.gl,handle=framebuffer.handle,attachments=framebuffer.attachments;_options$sourceAttach=_options$sourceAttach||framebuffer.width;sourceHeight=sourceHeight||framebuffer.height;36064===sourceAttachment&&null===handle&&(sourceAttachment=1028);(0,_utils.assert)(attachments[sourceAttachment]);options=options||attachments[sourceAttachment].type;var type=options;sourceAttachment=_options$sourceAttach;attachments=sourceHeight;target||(type=type||5121,target=
(0,_typedArrayUtils.getTypedArrayFromGLType)(type,{clamped:!1}),type=(0,_formatUtils.glFormatToComponents)(_options$sourceFormat),target=new target(sourceAttachment*attachments*type));options=options||(0,_typedArrayUtils.getGLTypeFromTypedArray)(target);handle=gl.bindFramebuffer(36160,handle);gl.readPixels(_options$sourceX,_options$sourceY,_options$sourceAttach,sourceHeight,_options$sourceFormat,options,target);gl.bindFramebuffer(36160,handle||null);if(_getFramebuffer)framebuffer["delete"]();return target}
function copyToDataUrl(source){var _ref2=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref2$sourceAttachmen=_ref2.sourceAttachment;_ref2=_ref2.targetMaxHeight;var targetMaxHeight=void 0===_ref2?Number.MAX_SAFE_INTEGER:_ref2;_ref2$sourceAttachmen=readPixelsToArray(source,{sourceAttachment:void 0===_ref2$sourceAttachmen?36064:_ref2$sourceAttachmen});_ref2=source.width;for(var height=source.height;height>targetMaxHeight;)height=(0,_webglUtils.scalePixels)({data:_ref2$sourceAttachmen,width:_ref2,
height}),_ref2$sourceAttachmen=height.data,_ref2=height.width,height=height.height;(0,_webglUtils.flipRows)({data:_ref2$sourceAttachmen,width:_ref2,height});targetMaxHeight=document.createElement("canvas");targetMaxHeight.width=_ref2;targetMaxHeight.height=height;var context=targetMaxHeight.getContext("2d");_ref2=context.createImageData(_ref2,height);_ref2.data.set(_ref2$sourceAttachmen);context.putImageData(_ref2,0,0);return targetMaxHeight.toDataURL()}function getFramebuffer(source){return source instanceof
_framebuffer["default"]?{framebuffer:source,deleteFramebuffer:!1}:{framebuffer:(0,_textureUtils.toFramebuffer)(source),deleteFramebuffer:!0}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports.readPixelsToArray=readPixelsToArray;exports.readPixelsToBuffer=function(source,_ref){var _ref$sourceX=_ref.sourceX,sourceX=void 0===_ref$sourceX?0:_ref$sourceX;_ref$sourceX=_ref.sourceY;var sourceY=void 0===_ref$sourceX?
0:_ref$sourceX;_ref$sourceX=_ref.sourceFormat;var sourceFormat=void 0===_ref$sourceX?6408:_ref$sourceX;_ref$sourceX=_ref.target;_ref$sourceX=void 0===_ref$sourceX?null:_ref$sourceX;var _ref$targetByteOffset=_ref.targetByteOffset,targetByteOffset=void 0===_ref$targetByteOffset?0:_ref$targetByteOffset,sourceWidth=_ref.sourceWidth,sourceHeight=_ref.sourceHeight,sourceType=_ref.sourceType;_ref=getFramebuffer(source);source=_ref.framebuffer;_ref=_ref.deleteFramebuffer;(0,_utils.assert)(source);sourceWidth=
sourceWidth||source.width;sourceHeight=sourceHeight||source.height;var gl2=(0,_gltools.assertWebGL2Context)(source.gl);sourceType=sourceType||(_ref$sourceX?_ref$sourceX.type:5121);_ref$sourceX||(_ref$sourceX=(0,_formatUtils.glFormatToComponents)(sourceFormat),_ref$targetByteOffset=(0,_formatUtils.glTypeToBytes)(sourceType),_ref$sourceX=new _buffer["default"](gl2,{byteLength:targetByteOffset+sourceWidth*sourceHeight*_ref$sourceX*_ref$targetByteOffset,accessor:{type:sourceType,size:_ref$sourceX}}));
_ref$sourceX.bind({target:35051});(0,_gltools.withParameters)(gl2,{framebuffer:source},function(){gl2.readPixels(sourceX,sourceY,sourceWidth,sourceHeight,sourceFormat,sourceType,targetByteOffset)});_ref$sourceX.unbind({target:35051});if(_ref)source["delete"]();return _ref$sourceX};exports.copyToDataUrl=copyToDataUrl;exports.copyToImage=function(source){var _ref3=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_ref3$sourceAttachmen=_ref3.sourceAttachment;_ref3=_ref3.targetImage;_ref3=void 0===
_ref3?null:_ref3;_ref3$sourceAttachmen=copyToDataUrl(source,{sourceAttachment:void 0===_ref3$sourceAttachmen?36064:_ref3$sourceAttachmen});_ref3=_ref3||new Image;_ref3.src=_ref3$sourceAttachmen;return _ref3};exports.copyToTexture=function(source,target){var options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},_options$sourceX2=options.sourceX;_options$sourceX2=void 0===_options$sourceX2?0:_options$sourceX2;var _options$sourceY2=options.sourceY;_options$sourceY2=void 0===_options$sourceY2?
0:_options$sourceY2;var _options$targetMipmap=options.targetMipmaplevel;_options$targetMipmap=void 0===_options$targetMipmap?0:_options$targetMipmap;var _options$targetIntern=options.targetInternalFormat;_options$targetIntern=void 0===_options$targetIntern?6408:_options$targetIntern;var targetX=options.targetX,targetY=options.targetY,targetZ=options.targetZ,width=options.width;options=options.height;var _getFramebuffer3=getFramebuffer(source),framebuffer=_getFramebuffer3.framebuffer;_getFramebuffer3=
_getFramebuffer3.deleteFramebuffer;(0,_utils.assert)(framebuffer);var gl=framebuffer.gl,handle=framebuffer.handle,isSubCopy="undefined"!==typeof targetX||"undefined"!==typeof targetY||"undefined"!==typeof targetZ;targetX=targetX||0;targetY=targetY||0;targetZ=targetZ||0;handle=gl.bindFramebuffer(36160,handle);(0,_utils.assert)(target);var texture=null;target instanceof _texture["default"]&&(texture=target,width=Number.isFinite(width)?width:texture.width,options=Number.isFinite(options)?options:texture.height,
texture.bind(0),target=texture.target);if(isSubCopy)switch(target){case 3553:case 34067:gl.copyTexSubImage2D(target,_options$targetMipmap,targetX,targetY,_options$sourceX2,_options$sourceY2,width,options);break;case 35866:case 32879:(0,_gltools.assertWebGL2Context)(gl).copyTexSubImage3D(target,_options$targetMipmap,targetX,targetY,targetZ,_options$sourceX2,_options$sourceY2,width,options)}else gl.copyTexImage2D(target,_options$targetMipmap,_options$targetIntern,_options$sourceX2,_options$sourceY2,
width,options,0);texture&&texture.unbind();gl.bindFramebuffer(36160,handle||null);if(_getFramebuffer3)framebuffer["delete"]();return texture};exports.blit=function(source,target){var options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},_options$sourceX3=options.sourceX0;_options$sourceX3=void 0===_options$sourceX3?0:_options$sourceX3;var _options$sourceY3=options.sourceY0;_options$sourceY3=void 0===_options$sourceY3?0:_options$sourceY3;var _options$targetX=options.targetX0;_options$targetX=
void 0===_options$targetX?0:_options$targetX;var _options$targetY=options.targetY0;_options$targetY=void 0===_options$targetY?0:_options$targetY;var _options$color=options.color;_options$color=void 0===_options$color?!0:_options$color;var _options$depth=options.depth;_options$depth=void 0===_options$depth?!1:_options$depth;var _options$stencil=options.stencil,stencil=void 0===_options$stencil?!1:_options$stencil;_options$stencil=options.filter;_options$stencil=void 0===_options$stencil?9728:_options$stencil;
var sourceX1=options.sourceX1,sourceY1=options.sourceY1,targetX1=options.targetX1,targetY1=options.targetY1,_options$sourceAttach2=options.sourceAttachment;_options$sourceAttach2=void 0===_options$sourceAttach2?36064:_options$sourceAttach2;options=options.mask;options=void 0===options?0:options;var _getFramebuffer4=getFramebuffer(source),srcFramebuffer=_getFramebuffer4.framebuffer;_getFramebuffer4=_getFramebuffer4.deleteFramebuffer;var _getFramebuffer5=getFramebuffer(target),dstFramebuffer=_getFramebuffer5.framebuffer;
_getFramebuffer5=_getFramebuffer5.deleteFramebuffer;(0,_utils.assert)(srcFramebuffer);(0,_utils.assert)(dstFramebuffer);var gl=dstFramebuffer.gl,handle=dstFramebuffer.handle,width=dstFramebuffer.width,height=dstFramebuffer.height,readBuffer=dstFramebuffer.readBuffer,gl2=(0,_gltools.assertWebGL2Context)(gl);srcFramebuffer.handle||36064!==_options$sourceAttach2||(_options$sourceAttach2=1028);_options$color&&(options|=16384);_options$depth&&(options|=256);stencil&&(options|=1024);(_getFramebuffer4||
_getFramebuffer5)&&options&1280&&(options=16384,_gltools.log.warn("Blitting from or into a Texture object, forcing mask to GL.COLOR_BUFFER_BIT")());(0,_utils.assert)(options);sourceX1=void 0===sourceX1?srcFramebuffer.width:sourceX1;sourceY1=void 0===sourceY1?srcFramebuffer.height:sourceY1;targetX1=void 0===targetX1?width:targetX1;targetY1=void 0===targetY1?height:targetY1;_options$color=gl.bindFramebuffer(36009,handle);_options$depth=gl.bindFramebuffer(36008,srcFramebuffer.handle);gl2.readBuffer(_options$sourceAttach2);
gl2.blitFramebuffer(_options$sourceX3,_options$sourceY3,sourceX1,sourceY1,_options$targetX,_options$targetY,targetX1,targetY1,options,_options$stencil);gl2.readBuffer(readBuffer);gl2.bindFramebuffer(36008,_options$depth||null);gl2.bindFramebuffer(36009,_options$color||null);if(_getFramebuffer4)srcFramebuffer["delete"]();if(_getFramebuffer5)dstFramebuffer["delete"]();return dstFramebuffer};var _buffer=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$buffer")),_framebuffer=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$framebuffer")),
_texture=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$texture")),_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index"),_webglUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$index"),_typedArrayUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$typed_array_utils"),_formatUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$format_utils"),_textureUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$texture_utils"),
_utils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$utils$index")}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$copy_and_blit.js.map
