shadow$provide.module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$tileset_3d=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ownKeys(object,enumerableOnly){var keys=
Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])}):Object.getOwnPropertyDescriptors?
Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _regenerator=global(require("module$node_modules$$babel$runtime$regenerator$index")),_asyncToGenerator2=global(require("module$node_modules$$babel$runtime$helpers$asyncToGenerator")),
_defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_core=require("module$node_modules$$math_DOT_gl$core$dist$es5$index"),_geospatial=require("module$node_modules$$math_DOT_gl$geospatial$dist$es5$index"),_stats=require("module$node_modules$$probe_DOT_gl$stats$dist$es5$index"),
_loaderUtils=require("module$node_modules$$loaders_DOT_gl$loader_utils$dist$es5$index"),_tilesetCache=global(require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$tileset_cache")),_transformUtils=require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$helpers$transform_utils"),_frameState=require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$helpers$frame_state"),_zoom=require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$helpers$zoom"),_tile3d=
global(require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$tile_3d")),_tileset3dTraverser=global(require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$traversers$tileset_3d_traverser")),_tilesetTraverser=global(require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$traversers$tileset_traverser")),_i3sTilsetTraverser=global(require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$traversers$i3s_tilset_traverser")),_constants=require("module$node_modules$$loaders_DOT_gl$tiles$dist$es5$constants"),
DEFAULT_OPTIONS={ellipsoid:_geospatial.Ellipsoid.WGS84,modelMatrix:new _core.Matrix4,throttleRequests:!1,maximumMemoryUsage:32,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(tile,message,url){},maximumScreenSpaceError:8};require=function(){function Tileset3D(json){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,Tileset3D);(0,_loaderUtils.assert)(json);this.options=_objectSpread(_objectSpread({},DEFAULT_OPTIONS),options);
this.tileset=json;this.loader=json.loader;this.type=json.type;this.url=json.url;this.basePath=json.basePath||_loaderUtils.path.dirname(this.url);this.modelMatrix=this.options.modelMatrix;this.ellipsoid=this.options.ellipsoid;this.lodMetricType=json.lodMetricType;this.lodMetricValue=json.lodMetricValue;this.refine=json.root.refine;this.fetchOptions=this.options.fetchOptions||{};this.options.headers&&(this.fetchOptions.headers=this.options.headers);this.options.token&&(this.fetchOptions.token=this.options.token);
this.cartesianCenter=this.cartographicCenter=this.root=null;this.zoom=1;this.boundingVolume=null;this._traverser=this._initializeTraverser();this._cache=new _tilesetCache["default"];this._requestScheduler=new _loaderUtils.RequestScheduler({throttleRequests:this.options.throttleRequests});this._pendingCount=this._updateFrameNumber=this._frameNumber=0;this._tiles={};this.selectedTiles=[];this._emptyTiles=[];this._requestedTiles=[];this._selectedTilesToStyle=[];this._queryParams={};this._queryParamsString=
null;this.maximumMemoryUsage=this.options.maximumMemoryUsage;this.gpuMemoryUsageInBytes=0;this.stats=new _stats.Stats({id:this.url});this._initializeStats();this._hasMixedContent=!1;this._maximumScreenSpaceError=this.options.maximumScreenSpaceError;this._gltfUpAxis=this._extensionsUsed=this._properties=void 0;this._dynamicScreenSpaceErrorComputedDensity=0;this.extras=null;this.asset={};this.credits={};this.description=this.options.description;this._defaultGeometrySchema=[];this._initializeTileSet(json,
this.options)}(0,_createClass2["default"])(Tileset3D,[{key:"isLoaded",value:function(){return 0===this._pendingCount}},{key:"destroy",value:function(){this._destroy()}},{key:"getTileUrl",value:function(tilePath){return tilePath.startsWith("data:")?tilePath:"".concat(tilePath).concat(this.queryParams)}},{key:"update",value:function(viewport){this._cache.reset();this._frameNumber++;this._frameState=(0,_frameState.getFrameState)(viewport,this._frameNumber);this._traverser.traverse(this.root,this._frameState,
this.options)}},{key:"_onTraversalEnd",value:function(){var selectedTiles=Object.values(this._traverser.selectedTiles);this._tilesChanged(this.selectedTiles,selectedTiles)&&this._updateFrameNumber++;this.selectedTiles=selectedTiles;selectedTiles=_createForOfIteratorHelper(this.selectedTiles);var _step;try{for(selectedTiles.s();!(_step=selectedTiles.n()).done;){var tile=_step.value;this._tiles[tile.id]=tile}}catch(err){selectedTiles.e(err)}finally{selectedTiles.f()}this._requestedTiles=Object.values(this._traverser.requestedTiles);
this._emptyTiles=Object.values(this._traverser.emptyTiles);this._loadTiles(this._frameState);this._unloadTiles();this._updateStats();return this._updateFrameNumber}},{key:"_tilesChanged",value:function(oldSelectedTiles,selectedTiles){if(oldSelectedTiles.length!==selectedTiles.length)return!0;var set1=new Set(oldSelectedTiles.map(function(t){return t.id})),set2=new Set(selectedTiles.map(function(t){return t.id}));return oldSelectedTiles=(oldSelectedTiles=0<oldSelectedTiles.filter(function(x){return!set2.has(x.id)}).length)||
0<selectedTiles.filter(function(x){return!set1.has(x.id)}).length}},{key:"_loadTiles",value:function(frameState){var _iterator2=_createForOfIteratorHelper(this._requestedTiles),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var tile=_step2.value;tile.contentUnloaded&&this._loadTile(tile,frameState)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,function(tileset,tile){return tileset._unloadTile(tile)})}},{key:"_updateStats",
value:function(){var tilesRenderable=0,pointsRenderable=0,_iterator3=_createForOfIteratorHelper(this.selectedTiles),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var tile=_step3.value;tile.contentAvailable&&(tilesRenderable++,tile.content.pointCount&&(pointsRenderable+=tile.content.pointCount))}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}this.stats.get("Tiles In View").count=this.selectedTiles.length;this.stats.get("Tiles To Render").count=tilesRenderable;this.stats.get("Points").count=
pointsRenderable}},{key:"_initializeTileSet",value:function(tilesetJson){this.root=this._initializeTileHeaders(tilesetJson,null,this.basePath);this.type===_constants.TILESET_TYPE.TILES3D&&this._initializeCesiumTileset(tilesetJson);this.type===_constants.TILESET_TYPE.I3S&&this._initializeI3STileset(tilesetJson);this._calculateViewProps()}},{key:"_calculateViewProps",value:function(){var root=this.root,center=root.boundingVolume.center;center?(this.cartographicCenter=_geospatial.Ellipsoid.WGS84.cartesianToCartographic(center,
new _core.Vector3),this.cartesianCenter=center,this.zoom=(0,_zoom.getZoomFromBoundingVolume)(root.boundingVolume)):(console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new _core.Vector3,this.zoom=1)}},{key:"_initializeStats",value:function(){this.stats.get("Tiles In Tileset(s)");this.stats.get("Tiles Loading");this.stats.get("Tiles In Memory");this.stats.get("Tiles In View");this.stats.get("Tiles To Render");this.stats.get("Tiles Loaded");this.stats.get("Tiles Unloaded");
this.stats.get("Failed Tile Loads");this.stats.get("Points","memory");this.stats.get("Tile Memory Use","memory")}},{key:"_initializeTileHeaders",value:function(tilesetJson,parentTileHeader,basePath){tilesetJson=new _tile3d["default"](this,tilesetJson.root,parentTileHeader,basePath);parentTileHeader&&(parentTileHeader.children.push(tilesetJson),tilesetJson.depth=parentTileHeader.depth+1);if(this.type===_constants.TILESET_TYPE.TILES3D)for(parentTileHeader=[],parentTileHeader.push(tilesetJson);0<parentTileHeader.length;){var tile=
parentTileHeader.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();var _iterator4=_createForOfIteratorHelper(tile.header.children||[]),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var childTile=new _tile3d["default"](this,_step4.value,tile,basePath);tile.children.push(childTile);childTile.depth=tile.depth+1;parentTileHeader.push(childTile)}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}return tilesetJson}},{key:"_initializeTraverser",value:function(){switch(this.type){case _constants.TILESET_TYPE.TILES3D:var TraverserClass=
_tileset3dTraverser["default"];break;case _constants.TILESET_TYPE.I3S:TraverserClass=_i3sTilsetTraverser["default"];break;default:TraverserClass=_tilesetTraverser["default"]}return new TraverserClass({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}},{key:"_destroyTileHeaders",value:function(parentTile){this._destroySubtree(parentTile)}},{key:"_loadTile",value:function(){var _loadTile2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(tile,frameState){var loaded;
return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,this._onStartTileLoading(),_context.next=4,tile.loadContent(frameState);case 4:loaded=_context.sent;_context.next=10;break;case 7:_context.prev=7,_context.t0=_context["catch"](0),this._onTileLoadError(tile,_context.t0);case 10:return _context.prev=10,this._onEndTileLoading(),this._onTileLoad(tile,loaded),_context.finish(10);case 14:case "end":return _context.stop()}},_callee,
this,[[0,7,10,14]])}));return function(_x,_x2){return _loadTile2.apply(this,arguments)}}()},{key:"_onTileLoadError",value:function(tile,error){this.stats.get("Failed Tile Loads").incrementCount();error=error.message||error.toString();var url=tile.url;console.error("A 3D tile failed to load: ".concat(tile.url," ").concat(error));this.options.onTileError(tile,error,url)}},{key:"_onTileLoad",value:function(tile,loaded){loaded&&(tile&&tile.content&&(0,_transformUtils.calculateTransformProps)(tile,tile.content),
this._addTileToCache(tile),this.options.onTileLoad(tile))}},{key:"_onStartTileLoading",value:function(){this._pendingCount++;this.stats.get("Tiles Loading").incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--;this.stats.get("Tiles Loading").decrementCount()}},{key:"_addTileToCache",value:function(tile){this._cache.add(this,tile,function(tileset){return tileset._updateCacheStats(tile)})}},{key:"_updateCacheStats",value:function(tile){this.stats.get("Tiles Loaded").incrementCount();
this.stats.get("Tiles In Memory").incrementCount();this.gpuMemoryUsageInBytes+=tile.content.byteLength||0;this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(tile){this.gpuMemoryUsageInBytes-=tile.content.byteLength||0;this.stats.get("Tiles In Memory").decrementCount();this.stats.get("Tiles Unloaded").incrementCount();this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes;this.options.onTileUnload(tile);tile.unloadContent()}},{key:"_destroy",
value:function(){var stack=[];for(this.root&&stack.push(this.root);0<stack.length;){var tile=stack.pop(),_iterator5=_createForOfIteratorHelper(tile.children),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;)stack.push(_step5.value)}catch(err){_iterator5.e(err)}finally{_iterator5.f()}this._destroyTile(tile)}this.root=null}},{key:"_destroySubtree",value:function(tile){var root=tile,stack=[];for(stack.push(root);0<stack.length;){tile=stack.pop();var _iterator6=_createForOfIteratorHelper(tile.children),
_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;)stack.push(_step6.value)}catch(err){_iterator6.e(err)}finally{_iterator6.f()}tile!==root&&this._destroyTile(tile)}root.children=[]}},{key:"_destroyTile",value:function(tile){this._cache.unloadTile(this,tile);this._unloadTile(tile);tile.destroy()}},{key:"_initializeCesiumTileset",value:function(tilesetJson){this.asset=tilesetJson.asset;if(!this.asset)throw Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==
this.asset.version)throw Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion);this.credits={attributions:this.options.attributions||[]};this.description=this.options.description;this.properties=tilesetJson.properties;this.geometricError=tilesetJson.geometricError;this._extensionsUsed=tilesetJson.extensionsUsed;this.extras=tilesetJson.extras}},{key:"_initializeI3STileset",value:function(tilesetJson){"token"in this.options&&
(this._queryParams.token=this.options.token);this._defaultGeometrySchema=tilesetJson.store.defaultGeometrySchema}},{key:"hasExtension",value:function(extensionName){return!!(this._extensionsUsed&&-1<this._extensionsUsed.indexOf(extensionName))}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"queryParams",get:function(){if(!this._queryParamsString){a:{var JSCompiler_inline_result=this._queryParams;for(var queryParamStrings=[],_i=0,_Object$keys=Object.keys(JSCompiler_inline_result);_i<
_Object$keys.length;_i++){var key=_Object$keys[_i];queryParamStrings.push("".concat(key,"\x3d").concat(JSCompiler_inline_result[key]))}switch(queryParamStrings.length){case 0:JSCompiler_inline_result="";break a;case 1:JSCompiler_inline_result="?".concat(queryParamStrings[0]);break a;default:JSCompiler_inline_result="?".concat(queryParamStrings.join("\x26"))}}this._queryParamsString=JSCompiler_inline_result}return this._queryParamsString}}]);return Tileset3D}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$tileset_3d.js.map
