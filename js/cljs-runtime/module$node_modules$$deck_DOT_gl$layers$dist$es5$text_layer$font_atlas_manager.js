shadow$provide.module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$font_atlas_manager=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function getNewChars(key,characterSet){key=
cache.get(key);if(!key)return characterSet;var newChars=[],cachedCharSet=Object.keys(key.mapping);cachedCharSet=new Set(cachedCharSet);characterSet instanceof Array&&(characterSet=new Set(characterSet));characterSet.forEach(function(_char){cachedCharSet.has(_char)||newChars.push(_char)});return newChars}function populateAlphaChannel(alphaChannel,imageData){for(var i=0;i<alphaChannel.length;i++)imageData.data[4*i+3]=alphaChannel[i]}function setTextStyle(ctx,fontFamily,fontSize,fontWeight){ctx.font=
"".concat(fontWeight," ").concat(fontSize,"px ").concat(fontFamily);ctx.fillStyle="#000";ctx.textBaseline="baseline";ctx.textAlign="left"}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=exports.DEFAULT_RADIUS=exports.DEFAULT_CUTOFF=exports.DEFAULT_BUFFER=exports.DEFAULT_FONT_SIZE=exports.DEFAULT_FONT_WEIGHT=exports.DEFAULT_FONT_FAMILY=exports.DEFAULT_CHAR_SET=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),
_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_tinySdf=global(require("module$node_modules$$mapbox$tiny_sdf$index")),_utils=require("module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$utils");require=global(require("module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$lru_cache"));var DEFAULT_CHAR_SET=function(){for(var charSet=[],i=32;128>i;i++)charSet.push(String.fromCharCode(i));return charSet}();exports.DEFAULT_CHAR_SET=DEFAULT_CHAR_SET;
exports.DEFAULT_FONT_FAMILY="Monaco, monospace";exports.DEFAULT_FONT_WEIGHT="normal";exports.DEFAULT_FONT_SIZE=64;exports.DEFAULT_BUFFER=2;exports.DEFAULT_CUTOFF=.25;exports.DEFAULT_RADIUS=3;var cache=new require["default"](3),VALID_PROPS="fontFamily fontWeight characterSet fontSize sdf buffer cutoff radius".split(" ");require=function(){function FontAtlasManager(){(0,_classCallCheck2["default"])(this,FontAtlasManager);this.props={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:DEFAULT_CHAR_SET,
fontSize:64,buffer:2,sdf:!1,cutoff:.25,radius:3};this._atlas=this._key=null}(0,_createClass2["default"])(FontAtlasManager,[{key:"setProps",value:function(){var _this=this,props=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};VALID_PROPS.forEach(function(prop){prop in props&&(_this.props[prop]=props[prop])});var oldKey=this._key;this._key=this._getKey();var charSet=getNewChars(this._key,this.props.characterSet),cachedFontAtlas=cache.get(this._key);cachedFontAtlas&&0===charSet.length?this._key!==
oldKey&&(this._atlas=cachedFontAtlas):(this._atlas=oldKey=this._generateFontAtlas(this._key,charSet,cachedFontAtlas),cache.set(this._key,oldKey))}},{key:"_generateFontAtlas",value:function(key,characterSet,cachedFontAtlas){var _this$props=this.props,fontFamily=_this$props.fontFamily,fontWeight=_this$props.fontWeight,fontSize=_this$props.fontSize;key=_this$props.buffer;var sdf=_this$props.sdf,radius=_this$props.radius,cutoff=_this$props.cutoff;_this$props=cachedFontAtlas&&cachedFontAtlas.data;_this$props||
(_this$props=document.createElement("canvas"),_this$props.width=1024);var ctx=_this$props.getContext("2d");setTextStyle(ctx,fontFamily,fontSize,fontWeight);var _buildMapping=(0,_utils.buildMapping)(Object.assign({getFontWidth:function(_char2){return ctx.measureText(_char2).width},fontHeight:1.2*fontSize,buffer:key,characterSet,maxCanvasWidth:1024},cachedFontAtlas&&{mapping:cachedFontAtlas.mapping,xOffset:cachedFontAtlas.xOffset,yOffset:cachedFontAtlas.yOffset}));cachedFontAtlas=_buildMapping.mapping;
var canvasHeight=_buildMapping.canvasHeight,xOffset=_buildMapping.xOffset;_buildMapping=_buildMapping.yOffset;if(_this$props.height!==canvasHeight){var imageData=ctx.getImageData(0,0,_this$props.width,_this$props.height);_this$props.height=canvasHeight;ctx.putImageData(imageData,0,0)}setTextStyle(ctx,fontFamily,fontSize,fontWeight);if(sdf){var tinySDF=new _tinySdf["default"](fontSize,key,radius,cutoff,fontFamily,fontWeight),_imageData=ctx.getImageData(0,0,tinySDF.size,tinySDF.size);characterSet=_createForOfIteratorHelper(characterSet);
var _step;try{for(characterSet.s();!(_step=characterSet.n()).done;){var _char3=_step.value;populateAlphaChannel(tinySDF.draw(_char3),_imageData);ctx.putImageData(_imageData,cachedFontAtlas[_char3].x-key,cachedFontAtlas[_char3].y-key)}}catch(err){characterSet.e(err)}finally{characterSet.f()}}else{_step=_createForOfIteratorHelper(characterSet);try{for(_step.s();!(tinySDF=_step.n()).done;)_imageData=tinySDF.value,ctx.fillText(_imageData,cachedFontAtlas[_imageData].x,cachedFontAtlas[_imageData].y+.9*
fontSize)}catch(err){_step.e(err)}finally{_step.f()}}return{xOffset,yOffset:_buildMapping,mapping:cachedFontAtlas,data:_this$props,width:_this$props.width,height:_this$props.height}}},{key:"_getKey",value:function(){var _this$props2=this.props,fontFamily=_this$props2.fontFamily,fontWeight=_this$props2.fontWeight,fontSize=_this$props2.fontSize,buffer=_this$props2.buffer,radius=_this$props2.radius,cutoff=_this$props2.cutoff;return _this$props2.sdf?"".concat(fontFamily," ").concat(fontWeight," ").concat(fontSize,
" ").concat(buffer," ").concat(radius," ").concat(cutoff):"".concat(fontFamily," ").concat(fontWeight," ").concat(fontSize," ").concat(buffer)}},{key:"texture",get:function(){return this._atlas}},{key:"mapping",get:function(){return this._atlas&&this._atlas.mapping}},{key:"scale",get:function(){return 1.2}}]);return FontAtlasManager}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$layers$dist$es5$text_layer$font_atlas_manager.js.map
