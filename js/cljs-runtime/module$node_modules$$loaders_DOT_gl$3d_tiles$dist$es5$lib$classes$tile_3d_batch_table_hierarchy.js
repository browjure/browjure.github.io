shadow$provide.module$node_modules$$loaders_DOT_gl$3d_tiles$dist$es5$lib$classes$tile_3d_batch_table_hierarchy=function(global,require,module,exports){function validateInstance(hierarchy,instanceIndex,stack){var parentCounts=hierarchy.parentCounts,parentIds=hierarchy.parentIds,parentIndexes=hierarchy.parentIndexes,instancesLength=hierarchy.classIds.length;if(defined(parentIds)){assert(instanceIndex<instancesLength,"Parent index ".concat(instanceIndex," exceeds the total number of instances: ").concat(instancesLength));
assert(-1===stack.indexOf(instanceIndex),"Circular dependency detected in the batch table hierarchy.");stack.push(instanceIndex);instancesLength=defined(parentCounts)?parentCounts[instanceIndex]:1;parentCounts=defined(parentCounts)?parentIndexes[instanceIndex]:instanceIndex;for(parentIndexes=0;parentIndexes<instancesLength;++parentIndexes){var parentId=parentIds[parentCounts+parentIndexes];parentId!==instanceIndex&&validateInstance(hierarchy,parentId,stack)}stack.pop(instanceIndex)}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");
Object.defineProperty(exports,"__esModule",{value:!0});exports.initializeHierarchy=function(batchTable,jsonHeader,binaryBody){if(!jsonHeader)return null;var hierarchy=batchTable.getExtension("3DTILES_batch_table_hierarchy");if(batchTable=jsonHeader.HIERARCHY)console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),jsonHeader.extensions=jsonHeader.extensions||{},hierarchy=jsonHeader.extensions["3DTILES_batch_table_hierarchy"]=batchTable;if(!hierarchy)return null;
jsonHeader=hierarchy.instancesLength;batchTable=hierarchy.classes;var classIds=hierarchy.classIds,parentCounts=hierarchy.parentCounts;hierarchy=hierarchy.parentIds;var parentIdsLength=jsonHeader;if(defined(classIds.byteOffset)){classIds.componentType=defaultValue(classIds.componentType,GL.UNSIGNED_SHORT);classIds.type=AttributeType.SCALAR;var i=getBinaryAccessor(classIds);classIds=((0,_readOnlyError2["default"])("classIds"),i.createArrayBufferView(binaryBody.buffer,binaryBody.byteOffset+classIds.byteOffset,
jsonHeader))}if(defined(parentCounts)){defined(parentCounts.byteOffset)&&(parentCounts.componentType=defaultValue(parentCounts.componentType,GL.UNSIGNED_SHORT),parentCounts.type=AttributeType.SCALAR,i=getBinaryAccessor(parentCounts),parentCounts=((0,_readOnlyError2["default"])("parentCounts"),i.createArrayBufferView(binaryBody.buffer,binaryBody.byteOffset+parentCounts.byteOffset,jsonHeader)));var parentIndexes=new Uint16Array(jsonHeader);parentIdsLength=((0,_readOnlyError2["default"])("parentIdsLength"),
0);for(i=0;i<jsonHeader;++i)parentIndexes[i]=parentIdsLength,parentIdsLength+=((0,_readOnlyError2["default"])("parentIdsLength"),parentCounts[i])}defined(hierarchy)&&defined(hierarchy.byteOffset)&&(hierarchy.componentType=defaultValue(hierarchy.componentType,GL.UNSIGNED_SHORT),hierarchy.type=AttributeType.SCALAR,i=getBinaryAccessor(hierarchy),hierarchy=((0,_readOnlyError2["default"])("parentIds"),i.createArrayBufferView(binaryBody.buffer,binaryBody.byteOffset+hierarchy.byteOffset,parentIdsLength)));
parentIdsLength=batchTable.length;for(i=0;i<parentIdsLength;++i){var properties=batchTable[i].instances,binaryProperties=getBinaryProperties(batchTable[i].length,properties,binaryBody);batchTable[i].instances=combine(binaryProperties,properties)}parentIdsLength=Array(parentIdsLength).fill(0);properties=new Uint16Array(jsonHeader);for(i=0;i<jsonHeader;++i)binaryBody=classIds[i],properties[i]=parentIdsLength[binaryBody],++parentIdsLength[binaryBody];parentIndexes={classes:batchTable,classIds,classIndexes:properties,
parentCounts,parentIndexes,parentIds:hierarchy};binaryBody=parentIndexes.classIds.length;for(jsonHeader=0;jsonHeader<binaryBody;++jsonHeader)validateInstance(parentIndexes,jsonHeader,stack);return parentIndexes};exports.traverseHierarchy=function(hierarchy,instanceIndex,endConditionCallback){if(hierarchy){var parentCounts=hierarchy.parentCounts;if(hierarchy.parentIds)return endConditionCallback(hierarchy,instanceIndex);if(0<parentCounts){a:{parentCounts=hierarchy.parentCounts;var parentIds=hierarchy.parentIds,
parentIndexes=hierarchy.parentIndexes,visited=scratchVisited;visited.length=Math.max(visited.length,hierarchy.classIds.length);var visitedMarker=++marker,stack=scratchStack;stack.length=0;for(stack.push(instanceIndex);0<stack.length;)if(instanceIndex=stack.pop(),visited[instanceIndex]!==visitedMarker){visited[instanceIndex]=visitedMarker;var result=endConditionCallback(hierarchy,instanceIndex);if(defined(result)){hierarchy=result;break a}result=parentCounts[instanceIndex];for(var parentIndex=parentIndexes[instanceIndex],
i=0;i<result;++i){var parentId=parentIds[parentIndex+i];parentId!==instanceIndex&&stack.push(parentId)}}hierarchy=null}return hierarchy}a:{parentCounts=instanceIndex;for(parentIds=!0;parentIds;){parentIds=endConditionCallback(hierarchy,parentCounts);if(defined(parentIds))break a;parentIndexes=hierarchy.parentIds[parentCounts];parentIds=parentIndexes!==parentCounts;parentCounts=parentIndexes}throw Error("traverseHierarchySingleParent");}return parentIds}};var _readOnlyError2=global(require("module$node_modules$$babel$runtime$helpers$readOnlyError")),
defined=function(x){return void 0!==x}}
//# sourceMappingURL=module$node_modules$$loaders_DOT_gl$3d_tiles$dist$es5$lib$classes$tile_3d_batch_table_hierarchy.js.map
