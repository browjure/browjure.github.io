shadow$provide.module$node_modules$$deck_DOT_gl$core$dist$es5$lib$layer_manager=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");
Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_core=require("module$node_modules$$luma_DOT_gl$core$dist$es5$index"),_layer=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$layer")),_constants=require("module$node_modules$$deck_DOT_gl$core$dist$es5$lifecycle$constants"),
_log=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$log")),_debug=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$debug$index")),_flatten=require("module$node_modules$$deck_DOT_gl$core$dist$es5$utils$flatten"),_probe=require("module$node_modules$probe_DOT_gl$dist$es5$index"),_resourceManager=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$lib$resource$resource_manager")),_viewport=global(require("module$node_modules$$deck_DOT_gl$core$dist$es5$viewports$viewport")),
_shaderlib=require("module$node_modules$$deck_DOT_gl$core$dist$es5$shaderlib$index"),INITIAL_CONTEXT=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}}),layerName=function(layer){return layer instanceof _layer["default"]?"".concat(layer):layer?"invalid":"null"};require=function(){function LayerManager(gl){var _ref=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},deck=_ref.deck,stats=_ref.stats,
viewport=_ref.viewport;_ref=_ref.timeline;(0,_classCallCheck2["default"])(this,LayerManager);this.lastRenderedLayers=[];this.layers=[];this.resourceManager=new _resourceManager["default"]({gl,protocol:"deck://"});this.context=Object.assign({},INITIAL_CONTEXT,{layerManager:this,gl,deck,programManager:gl&&(0,_shaderlib.createProgramManager)(gl),stats:stats||new _probe.Stats({id:"deck.gl"}),viewport:viewport||new _viewport["default"]({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:_ref||new _core.Timeline,
resourceManager:this.resourceManager});this._needsRedraw="Initial render";this._debug=this._needsUpdate=!1;this._onError=null;this.activateViewport=this.activateViewport.bind(this);Object.seal(this)}(0,_createClass2["default"])(LayerManager,[{key:"finalize",value:function(){this.resourceManager.finalize();var _iterator=_createForOfIteratorHelper(this.layers),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;)this._finalizeLayer(_step.value)}catch(err){_iterator.e(err)}finally{_iterator.f()}}},
{key:"needsRedraw",value:function(){var opts=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},redraw=this._needsRedraw;opts.clearRedrawFlags&&(this._needsRedraw=!1);var _iterator2=_createForOfIteratorHelper(this.layers),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var layerNeedsRedraw=_step2.value.getNeedsRedraw(opts);redraw=redraw||layerNeedsRedraw}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return redraw}},{key:"needsUpdate",value:function(){return this._needsUpdate}},
{key:"setNeedsRedraw",value:function(reason){this._needsRedraw=this._needsRedraw||reason}},{key:"setNeedsUpdate",value:function(reason){this._needsUpdate=this._needsUpdate||reason}},{key:"getLayers",value:function(){var _ref2$layerIds=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layerIds,layerIds=void 0===_ref2$layerIds?null:_ref2$layerIds;return layerIds?this.layers.filter(function(layer){return layerIds.find(function(layerId){return 0===layer.id.indexOf(layerId)})}):this.layers}},
{key:"setProps",value:function(props){"debug"in props&&(this._debug=props.debug);"userData"in props&&(this.context.userData=props.userData);"layers"in props&&this.setLayers(props.layers);"onError"in props&&(this._onError=props.onError)}},{key:"setLayers",value:function(newLayers){var shouldUpdate=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1)||newLayers!==this.lastRenderedLayers;(0,_debug["default"])("layerManager.setLayers",this,shouldUpdate,newLayers);if(!shouldUpdate)return this;this.lastRenderedLayers=
newLayers;newLayers=(0,_flatten.flatten)(newLayers,Boolean);shouldUpdate=_createForOfIteratorHelper(newLayers);var _step3;try{for(shouldUpdate.s();!(_step3=shouldUpdate.n()).done;)_step3.value.context=this.context}catch(err){shouldUpdate.e(err)}finally{shouldUpdate.f()}this._updateLayers(this.layers,newLayers);return this}},{key:"updateLayers",value:function(){var reason=this.needsUpdate();reason&&(this.setNeedsRedraw("updating layers: ".concat(reason)),this.setLayers(this.lastRenderedLayers,!0))}},
{key:"activateViewport",value:function(viewport){(0,_debug["default"])("layerManager.activateViewport",this,viewport);viewport&&(this.context.viewport=viewport);return this}},{key:"_handleError",value:function(stage,error,layer){this._onError?this._onError(error,layer):_log["default"].error("error during ".concat(stage," of ").concat(layerName(layer)),error)()}},{key:"_updateLayers",value:function(oldLayers,newLayers){var oldLayerMap={};oldLayers=_createForOfIteratorHelper(oldLayers);var _step4;try{for(oldLayers.s();!(_step4=
oldLayers.n()).done;){var oldLayer=_step4.value;oldLayerMap[oldLayer.id]?_log["default"].warn("Multiple old layers with same id ".concat(layerName(oldLayer)))():oldLayerMap[oldLayer.id]=oldLayer}}catch(err){oldLayers.e(err)}finally{oldLayers.f()}_step4=[];this._updateSublayersRecursively(newLayers,oldLayerMap,_step4);this._finalizeOldLayers(oldLayerMap);newLayers=!1;for(oldLayerMap=0;oldLayerMap<_step4.length;oldLayerMap++)if(_step4[oldLayerMap].hasUniformTransition()){newLayers=!0;break}this._needsUpdate=
newLayers;this.layers=_step4}},{key:"_updateSublayersRecursively",value:function(newLayers,oldLayerMap,generatedLayers){newLayers=_createForOfIteratorHelper(newLayers);var _step5;try{for(newLayers.s();!(_step5=newLayers.n()).done;){var newLayer=_step5.value;newLayer.context=this.context;var oldLayer=oldLayerMap[newLayer.id];null===oldLayer&&_log["default"].warn("Multiple new layers with same id ".concat(layerName(newLayer)))();var sublayers=oldLayerMap[newLayer.id]=null;try{this._debug&&oldLayer!==
newLayer&&newLayer.validateProps(),oldLayer?(this._transferLayerState(oldLayer,newLayer),this._updateLayer(newLayer)):this._initializeLayer(newLayer),generatedLayers.push(newLayer),sublayers=newLayer.isComposite&&newLayer.getSubLayers()}catch(err){this._handleError("matching",err,newLayer)}sublayers&&this._updateSublayersRecursively(sublayers,oldLayerMap,generatedLayers)}}catch(err){newLayers.e(err)}finally{newLayers.f()}}},{key:"_finalizeOldLayers",value:function(oldLayerMap){for(var layerId in oldLayerMap){var layer=
oldLayerMap[layerId];layer&&this._finalizeLayer(layer)}}},{key:"_initializeLayer",value:function(layer){try{layer._initialize(),layer.lifecycle=_constants.LIFECYCLE.INITIALIZED}catch(err){this._handleError("initialization",err,layer)}}},{key:"_transferLayerState",value:function(oldLayer,newLayer){newLayer._transferState(oldLayer);newLayer.lifecycle=_constants.LIFECYCLE.MATCHED;newLayer!==oldLayer&&(oldLayer.lifecycle=_constants.LIFECYCLE.AWAITING_GC)}},{key:"_updateLayer",value:function(layer){try{layer._update()}catch(err){this._handleError("update",
err,layer)}}},{key:"_finalizeLayer",value:function(layer){this._needsRedraw=this._needsRedraw||"finalized ".concat(layerName(layer));layer.lifecycle=_constants.LIFECYCLE.AWAITING_FINALIZATION;try{layer._finalize(),layer.lifecycle=_constants.LIFECYCLE.FINALIZED}catch(err){this._handleError("finalization",err,layer)}}}]);return LayerManager}();exports["default"]=require}
//# sourceMappingURL=module$node_modules$$deck_DOT_gl$core$dist$es5$lib$layer_manager.js.map
