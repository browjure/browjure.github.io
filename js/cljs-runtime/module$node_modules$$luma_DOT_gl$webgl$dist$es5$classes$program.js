shadow$provide.module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$program=function(global,require,module,exports){function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"===typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"===typeof o.length){it&&(o=it);var i=0;allowArrayLike=function(){};return{s:allowArrayLike,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e;
},f:allowArrayLike}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(_e2){didErr=!0;err=_e2},f:function(){try{if(!normalCompletion&&null!=it["return"])it["return"]()}finally{if(didErr)throw err;}}}}function _unsupportedIterableToArray(o,
minLen){if(o){if("string"===typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){if(null==len||len>arr.length)len=arr.length;for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _createSuper(Derived){var hasNativeReflectConstruct=
_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2["default"])(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;Super=Reflect.construct(Super,arguments,NewTarget)}else Super=Super.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,Super)}}function _isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;
try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0});exports["default"]=void 0;var _classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_assertThisInitialized2=global(require("module$node_modules$$babel$runtime$helpers$assertThisInitialized")),
_get2=global(require("module$node_modules$$babel$runtime$helpers$get")),_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits")),_possibleConstructorReturn2=global(require("module$node_modules$$babel$runtime$helpers$possibleConstructorReturn")),_getPrototypeOf2=global(require("module$node_modules$$babel$runtime$helpers$getPrototypeOf"));module=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$resource"));var _texture=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$texture")),
_framebuffer=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$framebuffer")),_uniforms=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$uniforms"),_shader=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$shader"),_programConfiguration=global(require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$program_configuration")),_gltools=require("module$node_modules$$luma_DOT_gl$gltools$dist$es5$index"),_webglUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$index"),
_attributeUtils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$webgl_utils$attribute_utils"),_utils=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$utils$index"),V6_DEPRECATED_METHODS="setVertexArray setAttributes setBuffers unsetBuffers use getUniformCount getUniformInfo getUniformLocation getUniformValue getVarying getFragDataLocation getAttachedShaders getAttributeCount getAttributeLocation getAttributeInfo".split(" ");require=function(_Resource){function Program(gl){var props=
1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_classCallCheck2["default"])(this,Program);var _this=_super.call(this,gl,props);_this.stubRemovedMethods("Program","v6.0",V6_DEPRECATED_METHODS);_this._isCached=!1;_this.initialize(props);Object.seal((0,_assertThisInitialized2["default"])(_this));_this._setId(props.id);return _this}(0,_inherits2["default"])(Program,_Resource);var _super=_createSuper(Program);(0,_createClass2["default"])(Program,[{key:"initialize",value:function(){var props=
0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},vs=props.vs,fs=props.fs,varyings=props.varyings,_props$bufferMode=props.bufferMode;_props$bufferMode=void 0===_props$bufferMode?35981:_props$bufferMode;this.hash=props.hash||"";this.vs="string"===typeof vs?new _shader.VertexShader(this.gl,{id:"".concat(props.id,"-vs"),source:vs}):vs;this.fs="string"===typeof fs?new _shader.FragmentShader(this.gl,{id:"".concat(props.id,"-fs"),source:fs}):fs;(0,_utils.assert)(this.vs instanceof _shader.VertexShader);
(0,_utils.assert)(this.fs instanceof _shader.FragmentShader);this.uniforms={};this._textureUniforms={};varyings&&0<varyings.length&&((0,_gltools.assertWebGL2Context)(this.gl),this.varyings=varyings,this.gl2.transformFeedbackVaryings(this.handle,varyings,_props$bufferMode));this._compileAndLink();this._readUniformLocationsFromLinkedProgram();this.configuration=new _programConfiguration["default"](this);return this.setProps(props)}},{key:"delete",value:function(){var options=0<arguments.length&&void 0!==
arguments[0]?arguments[0]:{};return this._isCached?this:(0,_get2["default"])((0,_getPrototypeOf2["default"])(Program.prototype),"delete",this).call(this,options)}},{key:"setProps",value:function(props){"uniforms"in props&&this.setUniforms(props.uniforms);return this}},{key:"draw",value:function(_ref){var _this2=this,logPriority=_ref.logPriority,_ref$drawMode=_ref.drawMode,drawMode=void 0===_ref$drawMode?4:_ref$drawMode,vertexCount=_ref.vertexCount;_ref$drawMode=_ref.offset;var offset=void 0===_ref$drawMode?
0:_ref$drawMode,start=_ref.start,end=_ref.end;_ref$drawMode=_ref.isIndexed;var isIndexed=void 0===_ref$drawMode?!1:_ref$drawMode;_ref$drawMode=_ref.indexType;var indexType=void 0===_ref$drawMode?5123:_ref$drawMode;_ref$drawMode=_ref.instanceCount;var instanceCount=void 0===_ref$drawMode?0:_ref$drawMode;_ref$drawMode=_ref.isInstanced;var isInstanced=void 0===_ref$drawMode?0<instanceCount:_ref$drawMode;_ref$drawMode=_ref.vertexArray;_ref$drawMode=void 0===_ref$drawMode?null:_ref$drawMode;var transformFeedback=
_ref.transformFeedback,framebuffer=_ref.framebuffer,_ref$parameters=_ref.parameters,parameters=void 0===_ref$parameters?{}:_ref$parameters;_ref$parameters=_ref.uniforms;_ref=_ref.samplers;if(_ref$parameters||_ref)_gltools.log.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(_ref$parameters||{});_gltools.log.priority>=logPriority&&(_ref=framebuffer?framebuffer.id:"default",_ref="mode\x3d".concat((0,_webglUtils.getKey)(this.gl,drawMode)," verts\x3d").concat(vertexCount,
" ")+"instances\x3d".concat(instanceCount," indexType\x3d").concat((0,_webglUtils.getKey)(this.gl,indexType)," ")+"isInstanced\x3d".concat(isInstanced," isIndexed\x3d").concat(isIndexed," ")+"Framebuffer\x3d".concat(_ref),_gltools.log.log(logPriority,_ref)());(0,_utils.assert)(_ref$drawMode);this.gl.useProgram(this.handle);if(!this._areTexturesRenderable()||0===vertexCount||isInstanced&&0===instanceCount)return!1;_ref$drawMode.bindForDraw(vertexCount,instanceCount,function(){void 0!==framebuffer&&
(parameters=Object.assign({},parameters,{framebuffer}));if(transformFeedback){var primitiveMode=(0,_attributeUtils.getPrimitiveDrawMode)(drawMode);transformFeedback.begin(primitiveMode)}_this2._bindTextures();(0,_gltools.withParameters)(_this2.gl,parameters,function(){isIndexed&&isInstanced?_this2.gl2.drawElementsInstanced(drawMode,vertexCount,indexType,offset,instanceCount):isIndexed&&(0,_gltools.isWebGL2)(_this2.gl)&&!isNaN(start)&&!isNaN(end)?_this2.gl2.drawRangeElements(drawMode,start,end,vertexCount,
indexType,offset):isIndexed?_this2.gl.drawElements(drawMode,vertexCount,indexType,offset):isInstanced?_this2.gl2.drawArraysInstanced(drawMode,offset,vertexCount,instanceCount):_this2.gl.drawArrays(drawMode,offset,vertexCount)});transformFeedback&&transformFeedback.end()});return!0}},{key:"setUniforms",value:function(){var uniforms=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};2<=_gltools.log.priority&&(0,_uniforms.checkUniformValues)(uniforms,this.id,this._uniformSetters);this.gl.useProgram(this.handle);
for(var uniformName in uniforms){var uniform=uniforms[uniformName],uniformSetter=this._uniformSetters[uniformName];if(uniformSetter){var value=uniform,textureUpdate=!1;value instanceof _framebuffer["default"]&&(value=value.texture);if(value instanceof _texture["default"])if(textureUpdate=this.uniforms[uniformName]!==uniform){void 0===uniformSetter.textureIndex&&(uniformSetter.textureIndex=this._textureIndexCounter++);var texture=value;value=uniformSetter.textureIndex;texture.bind(value);this._textureUniforms[uniformName]=
texture}else value=uniformSetter.textureIndex;else this._textureUniforms[uniformName]&&delete this._textureUniforms[uniformName];(uniformSetter(value)||textureUpdate)&&(0,_uniforms.copyUniform)(this.uniforms,uniformName,uniform)}}return this}},{key:"_areTexturesRenderable",value:function(){var texturesRenderable=!0,uniformName;for(uniformName in this._textureUniforms){var texture=this._textureUniforms[uniformName];texture.update();texturesRenderable=texturesRenderable&&texture.loaded}return texturesRenderable}},
{key:"_bindTextures",value:function(){for(var uniformName in this._textureUniforms)this._textureUniforms[uniformName].bind(this._uniformSetters[uniformName].textureIndex)}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(handle){var shaderHandles=this.gl.getAttachedShaders(handle);handle={};shaderHandles=_createForOfIteratorHelper(shaderHandles);var _step;try{for(shaderHandles.s();!(_step=
shaderHandles.n()).done;){var shaderHandle=_step.value;switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:handle.vs=new _shader.VertexShader({handle:shaderHandle});break;case 35632:handle.fs=new _shader.FragmentShader({handle:shaderHandle})}}}catch(err){shaderHandles.e(err)}finally{shaderHandles.f()}return handle}},{key:"_getParameter",value:function(pname){return this.gl.getProgramParameter(this.handle,pname)}},{key:"_setId",value:function(id){id||(id=this._getName(),this.id=(0,_utils.uid)(id))}},
{key:"_getName",value:function(){var programName=this.vs.getName()||this.fs.getName();return programName=(programName=programName.replace(/shader/i,""))?"".concat(programName,"-program"):"program"}},{key:"_compileAndLink",value:function(){var gl=this.gl;gl.attachShader(this.handle,this.vs.handle);gl.attachShader(this.handle,this.fs.handle);_gltools.log.time(4,"linkProgram for ".concat(this._getName()))();gl.linkProgram(this.handle);_gltools.log.timeEnd(4,"linkProgram for ".concat(this._getName()))();
if(gl.debug||0<_gltools.log.level){if(!gl.getProgramParameter(this.handle,35714))throw Error("Error linking: ".concat(gl.getProgramInfoLog(this.handle)));gl.validateProgram(this.handle);if(!gl.getProgramParameter(this.handle,35715))throw Error("Error validating: ".concat(gl.getProgramInfoLog(this.handle)));}}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var gl=this.gl;this._uniformSetters={};this._uniformCount=this._getParameter(35718);for(var i=0;i<this._uniformCount;i++){var info=
this.gl.getActiveUniform(this.handle,i),name=(0,_uniforms.parseUniformName)(info.name).name,location=gl.getUniformLocation(this.handle,name);this._uniformSetters[name]=(0,_uniforms.getUniformSetter)(gl,location,info);if(1<info.size)for(var l=0;l<info.size;l++)location=gl.getUniformLocation(this.handle,"".concat(name,"[").concat(l,"]")),this._uniformSetters["".concat(name,"[").concat(l,"]")]=(0,_uniforms.getUniformSetter)(gl,location,info)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(uniformIndices,
pname){return this.gl2.getActiveUniforms(this.handle,uniformIndices,pname)}},{key:"getUniformBlockIndex",value:function(blockName){return this.gl2.getUniformBlockIndex(this.handle,blockName)}},{key:"getActiveUniformBlockParameter",value:function(blockIndex,pname){return this.gl2.getActiveUniformBlockParameter(this.handle,blockIndex,pname)}},{key:"uniformBlockBinding",value:function(blockIndex,blockBinding){this.gl2.uniformBlockBinding(this.handle,blockIndex,blockBinding)}}]);return Program}(module["default"]);
exports["default"]=require}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$webgl$dist$es5$classes$program.js.map
