{
"version":3,
"file":"module$node_modules$$deck_DOT_gl$core$dist$es5$lib$resource$resource_manager.js",
"lineCount":7,
"mappings":"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",
"sources":["node_modules/@deck_DOT_gl/core/dist/es5/lib/resource/resource-manager.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$deck_DOT_gl$core$dist$es5$lib$resource$resource_manager\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _resource = _interopRequireDefault(require(\"./resource\"));\n\nvar ResourceManager = function () {\n  function ResourceManager(_ref) {\n    var gl = _ref.gl,\n        protocol = _ref.protocol;\n    (0, _classCallCheck2[\"default\"])(this, ResourceManager);\n    this.protocol = protocol || 'resource://';\n    this._context = {\n      gl: gl,\n      resourceManager: this\n    };\n    this._resources = {};\n    this._consumers = {};\n    this._pruneRequest = null;\n  }\n\n  (0, _createClass2[\"default\"])(ResourceManager, [{\n    key: \"contains\",\n    value: function contains(resourceId) {\n      if (resourceId.startsWith(this.protocol)) {\n        return true;\n      }\n\n      return resourceId in this._resources;\n    }\n  }, {\n    key: \"add\",\n    value: function add(_ref2) {\n      var resourceId = _ref2.resourceId,\n          data = _ref2.data,\n          _ref2$forceUpdate = _ref2.forceUpdate,\n          forceUpdate = _ref2$forceUpdate === void 0 ? false : _ref2$forceUpdate,\n          _ref2$persistent = _ref2.persistent,\n          persistent = _ref2$persistent === void 0 ? true : _ref2$persistent;\n      var res = this._resources[resourceId];\n\n      if (res) {\n        res.setData(data, forceUpdate);\n      } else {\n        res = new _resource[\"default\"](resourceId, data, this._context);\n        this._resources[resourceId] = res;\n      }\n\n      res.persistent = persistent;\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(resourceId) {\n      var res = this._resources[resourceId];\n\n      if (res) {\n        res[\"delete\"]();\n        delete this._resources[resourceId];\n      }\n    }\n  }, {\n    key: \"unsubscribe\",\n    value: function unsubscribe(_ref3) {\n      var consumerId = _ref3.consumerId;\n      var consumer = this._consumers[consumerId];\n\n      if (consumer) {\n        for (var requestId in consumer) {\n          var request = consumer[requestId];\n\n          if (request.resource) {\n            request.resource.unsubscribe(request);\n          }\n        }\n\n        delete this._consumers[consumerId];\n        this.prune();\n      }\n    }\n  }, {\n    key: \"subscribe\",\n    value: function subscribe(_ref4) {\n      var resourceId = _ref4.resourceId,\n          onChange = _ref4.onChange,\n          consumerId = _ref4.consumerId,\n          _ref4$requestId = _ref4.requestId,\n          requestId = _ref4$requestId === void 0 ? 'default' : _ref4$requestId;\n      var resources = this._resources,\n          protocol = this.protocol;\n\n      if (resourceId.startsWith(protocol)) {\n        resourceId = resourceId.replace(protocol, '');\n\n        if (!resources[resourceId]) {\n          this.add({\n            resourceId: resourceId,\n            data: null,\n            persistent: false\n          });\n        }\n      }\n\n      var res = resources[resourceId];\n\n      this._track(consumerId, requestId, res, onChange);\n\n      if (res) {\n        return res.getData();\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"prune\",\n    value: function prune() {\n      var _this = this;\n\n      if (!this._pruneRequest) {\n        this._pruneRequest = setTimeout(function () {\n          return _this._prune();\n        }, 0);\n      }\n    }\n  }, {\n    key: \"finalize\",\n    value: function finalize() {\n      for (var key in this._resources) {\n        this._resources[key][\"delete\"]();\n      }\n    }\n  }, {\n    key: \"_track\",\n    value: function _track(consumerId, requestId, resource, onChange) {\n      var consumers = this._consumers;\n      var consumer = consumers[consumerId] = consumers[consumerId] || {};\n      var request = consumer[requestId] || {};\n\n      if (request.resource) {\n        request.resource.unsubscribe(request);\n        request.resource = null;\n        this.prune();\n      }\n\n      if (resource) {\n        consumer[requestId] = request;\n        request.onChange = onChange;\n        request.resource = resource;\n        resource.subscribe(request);\n      }\n    }\n  }, {\n    key: \"_prune\",\n    value: function _prune() {\n      this._pruneRequest = null;\n\n      for (var _i = 0, _Object$keys = Object.keys(this._resources); _i < _Object$keys.length; _i++) {\n        var key = _Object$keys[_i];\n        var res = this._resources[key];\n\n        if (!res.persistent && !res.inUse()) {\n          res[\"delete\"]();\n          delete this._resources[key];\n        }\n      }\n    }\n  }]);\n  return ResourceManager;\n}();\n\nexports[\"default\"] = ResourceManager;\n//# sourceMappingURL=resource-manager.js.map\n};"],
"names":["shadow$provide","global","require","module","exports","_interopRequireDefault","Object","defineProperty","value","_classCallCheck2","_createClass2","_resource","ResourceManager","_ref","gl","protocol","_context","resourceManager","_resources","_consumers","_pruneRequest","key","contains","resourceId","startsWith","add","_ref2","data","_ref2$forceUpdate","forceUpdate","_ref2$persistent","persistent","res","setData","remove","unsubscribe","_ref3","consumerId","consumer","requestId","request","resource","prune","subscribe","_ref4","onChange","_ref4$requestId","resources","replace","_track","getData","_this","setTimeout","_prune","finalize","consumers","_i","_Object$keys","keys","length","inUse"]
}
