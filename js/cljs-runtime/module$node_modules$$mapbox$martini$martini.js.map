{
"version":3,
"file":"module$node_modules$$mapbox$martini$martini.js",
"lineCount":7,
"mappings":"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",
"sources":["node_modules/@mapbox/martini/martini.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$mapbox$martini$martini\"] = function(global,require,module,exports) {\n(function (global, factory) {\ntypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\ntypeof define === 'function' && define.amd ? define(factory) :\n(global = global || self, global.Martini = factory());\n}(this, (function () { 'use strict';\n\nclass Martini {\n    constructor(gridSize = 257) {\n        this.gridSize = gridSize;\n        const tileSize = gridSize - 1;\n        if (tileSize & (tileSize - 1)) throw new Error(\n            `Expected grid size to be 2^n+1, got ${gridSize}.`);\n\n        this.numTriangles = tileSize * tileSize * 2 - 2;\n        this.numParentTriangles = this.numTriangles - tileSize * tileSize;\n\n        this.indices = new Uint32Array(this.gridSize * this.gridSize);\n\n        // coordinates for all possible triangles in an RTIN tile\n        this.coords = new Uint16Array(this.numTriangles * 4);\n\n        // get triangle coordinates from its index in an implicit binary tree\n        for (let i = 0; i < this.numTriangles; i++) {\n            let id = i + 2;\n            let ax = 0, ay = 0, bx = 0, by = 0, cx = 0, cy = 0;\n            if (id & 1) {\n                bx = by = cx = tileSize; // bottom-left triangle\n            } else {\n                ax = ay = cy = tileSize; // top-right triangle\n            }\n            while ((id >>= 1) > 1) {\n                const mx = (ax + bx) >> 1;\n                const my = (ay + by) >> 1;\n\n                if (id & 1) { // left half\n                    bx = ax; by = ay;\n                    ax = cx; ay = cy;\n                } else { // right half\n                    ax = bx; ay = by;\n                    bx = cx; by = cy;\n                }\n                cx = mx; cy = my;\n            }\n            const k = i * 4;\n            this.coords[k + 0] = ax;\n            this.coords[k + 1] = ay;\n            this.coords[k + 2] = bx;\n            this.coords[k + 3] = by;\n        }\n    }\n\n    createTile(terrain) {\n        return new Tile(terrain, this);\n    }\n}\n\nclass Tile {\n    constructor(terrain, martini) {\n        const size = martini.gridSize;\n        if (terrain.length !== size * size) throw new Error(\n            `Expected terrain data of length ${size * size} (${size} x ${size}), got ${terrain.length}.`);\n\n        this.terrain = terrain;\n        this.martini = martini;\n        this.errors = new Float32Array(terrain.length);\n        this.update();\n    }\n\n    update() {\n        const {numTriangles, numParentTriangles, coords, gridSize: size} = this.martini;\n        const {terrain, errors} = this;\n\n        // iterate over all possible triangles, starting from the smallest level\n        for (let i = numTriangles - 1; i >= 0; i--) {\n            const k = i * 4;\n            const ax = coords[k + 0];\n            const ay = coords[k + 1];\n            const bx = coords[k + 2];\n            const by = coords[k + 3];\n            const mx = (ax + bx) >> 1;\n            const my = (ay + by) >> 1;\n            const cx = mx + my - ay;\n            const cy = my + ax - mx;\n\n            // calculate error in the middle of the long edge of the triangle\n            const interpolatedHeight = (terrain[ay * size + ax] + terrain[by * size + bx]) / 2;\n            const middleIndex = my * size + mx;\n            const middleError = Math.abs(interpolatedHeight - terrain[middleIndex]);\n\n            errors[middleIndex] = Math.max(errors[middleIndex], middleError);\n\n            if (i < numParentTriangles) { // bigger triangles; accumulate error with children\n                const leftChildIndex = ((ay + cy) >> 1) * size + ((ax + cx) >> 1);\n                const rightChildIndex = ((by + cy) >> 1) * size + ((bx + cx) >> 1);\n                errors[middleIndex] = Math.max(errors[middleIndex], errors[leftChildIndex], errors[rightChildIndex]);\n            }\n        }\n    }\n\n    getMesh(maxError = 0) {\n        const {gridSize: size, indices} = this.martini;\n        const {errors} = this;\n        let numVertices = 0;\n        let numTriangles = 0;\n        const max = size - 1;\n\n        // use an index grid to keep track of vertices that were already used to avoid duplication\n        indices.fill(0);\n\n        // retrieve mesh in two stages that both traverse the error map:\n        // - countElements: find used vertices (and assign each an index), and count triangles (for minimum allocation)\n        // - processTriangle: fill the allocated vertices & triangles typed arrays\n\n        function countElements(ax, ay, bx, by, cx, cy) {\n            const mx = (ax + bx) >> 1;\n            const my = (ay + by) >> 1;\n\n            if (Math.abs(ax - cx) + Math.abs(ay - cy) > 1 && errors[my * size + mx] > maxError) {\n                countElements(cx, cy, ax, ay, mx, my);\n                countElements(bx, by, cx, cy, mx, my);\n            } else {\n                indices[ay * size + ax] = indices[ay * size + ax] || ++numVertices;\n                indices[by * size + bx] = indices[by * size + bx] || ++numVertices;\n                indices[cy * size + cx] = indices[cy * size + cx] || ++numVertices;\n                numTriangles++;\n            }\n        }\n        countElements(0, 0, max, max, max, 0);\n        countElements(max, max, 0, 0, 0, max);\n\n        const vertices = new Uint16Array(numVertices * 2);\n        const triangles = new Uint32Array(numTriangles * 3);\n        let triIndex = 0;\n\n        function processTriangle(ax, ay, bx, by, cx, cy) {\n            const mx = (ax + bx) >> 1;\n            const my = (ay + by) >> 1;\n\n            if (Math.abs(ax - cx) + Math.abs(ay - cy) > 1 && errors[my * size + mx] > maxError) {\n                // triangle doesn't approximate the surface well enough; drill down further\n                processTriangle(cx, cy, ax, ay, mx, my);\n                processTriangle(bx, by, cx, cy, mx, my);\n\n            } else {\n                // add a triangle\n                const a = indices[ay * size + ax] - 1;\n                const b = indices[by * size + bx] - 1;\n                const c = indices[cy * size + cx] - 1;\n\n                vertices[2 * a] = ax;\n                vertices[2 * a + 1] = ay;\n\n                vertices[2 * b] = bx;\n                vertices[2 * b + 1] = by;\n\n                vertices[2 * c] = cx;\n                vertices[2 * c + 1] = cy;\n\n                triangles[triIndex++] = a;\n                triangles[triIndex++] = b;\n                triangles[triIndex++] = c;\n            }\n        }\n        processTriangle(0, 0, max, max, max, 0);\n        processTriangle(max, max, 0, 0, 0, max);\n\n        return {vertices, triangles};\n    }\n}\n\nreturn Martini;\n\n})));\n\n};"],
"names":["shadow$provide","global","require","module","exports","factory","define","amd","self","Martini","constructor","gridSize","tileSize","Error","numTriangles","numParentTriangles","indices","Uint32Array","coords","Uint16Array","i","id","ax","ay","bx","by","cx","cy","mx","my","k","createTile","terrain","Tile","martini","size","length","errors","Float32Array","update","middleIndex","Math","max","middleError","abs","getMesh","maxError","countElements","numVertices","processTriangle","a","b","c","vertices","triangles","triIndex","fill"]
}
