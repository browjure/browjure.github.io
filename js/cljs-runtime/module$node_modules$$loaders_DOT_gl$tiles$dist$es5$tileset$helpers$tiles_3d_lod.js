shadow$provide.module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$helpers$tiles_3d_lod=function(global,require,module,exports){function fog(distanceToCamera,density){distanceToCamera*=density;return 1-Math.exp(-(distanceToCamera*distanceToCamera))}function getDynamicScreenSpaceError(tileset,distanceToCamera){if(tileset.dynamicScreenSpaceError&&tileset._dynamicScreenSpaceErrorComputedDensity){var factor=tileset.dynamicScreenSpaceErrorFactor;return fog(distanceToCamera,tileset._dynamicScreenSpaceErrorComputedDensity)*
factor}return 0}Object.defineProperty(exports,"__esModule",{value:!0});exports.calculateDynamicScreenSpaceError=function(root,_ref){var camera=_ref.camera,mapProjection=_ref.mapProjection,options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},_options$dynamicScree=options.dynamicScreenSpaceErrorHeightFalloff;_options$dynamicScree=void 0===_options$dynamicScree?.25:_options$dynamicScree;options=options.dynamicScreenSpaceErrorDensity;options=void 0===options?.00278:options;var tileBoundingVolume=
root.contentBoundingVolume;if(tileBoundingVolume instanceof TileBoundingRegion){mapProjection=Cartesian3.normalize(camera.positionWC,scratchPositionNormal);var direction=camera.directionWC;camera=camera.positionCartographic.height;var minimumHeight=tileBoundingVolume.minimumHeight;var maximumHeight=tileBoundingVolume.maximumHeight}else{direction=_core.Matrix4.inverseTransformation(root.computedTransform,scratchMatrix);mapProjection=mapProjection.ellipsoid;var boundingVolume=tileBoundingVolume.boundingVolume,
centerLocal=_core.Matrix4.multiplyByPoint(direction,boundingVolume.center,scratchCenter);if(Cartesian3.magnitude(centerLocal)>mapProjection.minimumRadius)maximumHeight=Cartographic.fromCartesian(centerLocal,mapProjection,scratchCartographic),mapProjection=Cartesian3.normalize(camera.positionWC,scratchPositionNormal),direction=camera.directionWC,camera=camera.positionCartographic.height,minimumHeight=0,maximumHeight=2*maximumHeight.height;else{var positionLocal=_core.Matrix4.multiplyByPoint(direction,
camera.positionWC,scratchPosition);mapProjection=Cartesian3.UNIT_Z;direction=_core.Matrix4.multiplyByPointAsVector(direction,camera.directionWC,scratchDirection);direction=Cartesian3.normalize(direction,direction);camera=positionLocal.z;tileBoundingVolume instanceof TileOrientedBoundingBox?(maximumHeight=root._header.boundingVolume.box[11],minimumHeight=centerLocal.z-maximumHeight,maximumHeight=centerLocal.z+maximumHeight):tileBoundingVolume instanceof TileBoundingSphere&&(maximumHeight=boundingVolume.radius,
minimumHeight=centerLocal.z-maximumHeight,maximumHeight=centerLocal.z+maximumHeight)}}minimumHeight+=(maximumHeight-minimumHeight)*_options$dynamicScree;_options$dynamicScree=maximumHeight;minimumHeight=(0,_core.clamp)((camera-minimumHeight)/(_options$dynamicScree-minimumHeight),0,1);minimumHeight=(1-Math.abs(Cartesian3.dot(direction,mapProjection)))*(1-minimumHeight);return options*minimumHeight};exports.fog=fog;exports.getDynamicScreenSpaceError=getDynamicScreenSpaceError;exports.getTiles3DScreenSpaceError=
function(tile,frameState,useParentLodMetric){var parentLodMetricValue=tile.parent&&tile.parent.lodMetricValue||tile.lodMetricValue;useParentLodMetric=useParentLodMetric?parentLodMetricValue:tile.lodMetricValue;if(0===useParentLodMetric)return 0;parentLodMetricValue=Math.max(tile._distanceToCamera,1E-7);return useParentLodMetric*frameState.height/(parentLodMetricValue*frameState.sseDenominator)-getDynamicScreenSpaceError(tile.tileset,parentLodMetricValue)};var _core=require("module$node_modules$$math_DOT_gl$core$dist$es5$index"),
scratchPositionNormal=new _core.Vector3,scratchCartographic=new _core.Vector3,scratchMatrix=new _core.Matrix4,scratchCenter=new _core.Vector3,scratchPosition=new _core.Vector3,scratchDirection=new _core.Vector3}
//# sourceMappingURL=module$node_modules$$loaders_DOT_gl$tiles$dist$es5$tileset$helpers$tiles_3d_lod.js.map
