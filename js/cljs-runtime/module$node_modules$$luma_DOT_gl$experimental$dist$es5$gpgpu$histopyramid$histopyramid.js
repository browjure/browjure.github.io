shadow$provide.module$node_modules$$luma_DOT_gl$experimental$dist$es5$gpgpu$histopyramid$histopyramid=function(global,require,module,exports){function buildHistopyramidBaseLevel(gl,opts){var _parameters,texture=opts.texture,_opts$channel=opts.channel;_opts$channel=void 0===_opts$channel?"r":_opts$channel;opts=opts._readData;var _readData=void 0===opts?!1:opts;opts=texture.width;var height=texture.height;opts=Math.pow(2,Math.ceil(Math.log2(opts)));height=Math.pow(2,Math.ceil(Math.log2(height)));opts=
(opts>height?opts:height)/2;height=(0,_webgl.cloneTextureFrom)(texture,{width:opts,height:opts});gl=new _engine.Transform(gl,{_sourceTextures:{inTexture:texture},_targetTexture:height,_targetTextureVarying:"outTexture",vs:"".concat(_histopyramidShaders.HISTOPYRAMID_BUILD_VS_UTILS).concat(_histopyramidShaders.HISTOPYRAMID_BASE_BUILD_VS),elementCount:height.width*height.height});gl.run({uniforms:{channel:channelToIndexMap[_opts$channel]||0,padingPixelValue:[0,0,0,0]}});if(_readData||1===opts)var textureData=
gl.getData({packed:!0});_opts$channel=2*opts;texture=(0,_webgl.cloneTextureFrom)(texture,{width:_opts$channel,height:_opts$channel,parameters:(_parameters={},(0,_defineProperty2["default"])(_parameters,10240,9728),(0,_defineProperty2["default"])(_parameters,10241,9728),_parameters)});_parameters=gl.getFramebuffer();(0,_webgl.copyToTexture)(_parameters,texture,{targetX:0,width:opts,height:opts});return{textureData,baseTexture:height,flatPyramidTexture:texture}}function getHistoPyramid(gl,opts){var _buildHistopyramidBas=
buildHistopyramidBaseLevel(gl,opts),baseTexture=_buildHistopyramidBas.baseTexture;opts=_buildHistopyramidBas.flatPyramidTexture;var width=baseTexture.width,levelCount=Math.log2(width)+1,pyramidTextures=[baseTexture];_buildHistopyramidBas=_buildHistopyramidBas.textureData;if(1<levelCount){for(_buildHistopyramidBas=1;_buildHistopyramidBas<levelCount;_buildHistopyramidBas++){var size=width/Math.pow(2,_buildHistopyramidBas);pyramidTextures.push((0,_webgl.cloneTextureFrom)(baseTexture,{width:size,height:size}))}gl=
new _engine.Transform(gl,{_sourceTextures:{inTexture:pyramidTextures[0]},_targetTexture:pyramidTextures[1],_targetTextureVarying:"outTexture",vs:"".concat(_histopyramidShaders.HISTOPYRAMID_BUILD_VS_UTILS).concat(_histopyramidShaders.HISTOPYRAMID_BUILD_VS),elementCount:pyramidTextures[1].width*pyramidTextures[1].height});for(baseTexture=1;baseTexture<levelCount;baseTexture++)_buildHistopyramidBas=[pyramidTextures[baseTexture].width,pyramidTextures[baseTexture].height],gl.update({_sourceTextures:{inTexture:pyramidTextures[baseTexture-
1]},_targetTexture:pyramidTextures[baseTexture],elementCount:pyramidTextures[baseTexture].width*pyramidTextures[baseTexture].height}),gl.run(),size=gl.getFramebuffer(),(0,_webgl.copyToTexture)(size,opts,{targetX:width,width:_buildHistopyramidBas[0],height:_buildHistopyramidBas[1]}),width+=_buildHistopyramidBas[0];_buildHistopyramidBas=gl.getData()}return{pyramidTextures,flatPyramidTexture:opts,levelCount,topLevelData:_buildHistopyramidBas}}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault");
Object.defineProperty(exports,"__esModule",{value:!0});exports.buildHistopyramidBaseLevel=buildHistopyramidBaseLevel;exports.getHistoPyramid=getHistoPyramid;exports.histoPyramidGenerateIndices=function(gl,opts){var _getHistoPyramid=getHistoPyramid(gl,opts);opts=_getHistoPyramid.flatPyramidTexture;var levelCount=_getHistoPyramid.levelCount;_getHistoPyramid=_getHistoPyramid.topLevelData;_getHistoPyramid=_getHistoPyramid[0]+_getHistoPyramid[1]+_getHistoPyramid[2]+_getHistoPyramid[3];var keyIndex=new _webgl.Buffer(gl,
(new Float32Array(_getHistoPyramid)).map(function(_,index){return index})),locationAndIndex=new _webgl.Buffer(gl,16*_getHistoPyramid);(new _engine.Transform(gl,{sourceBuffers:{keyIndex},_sourceTextures:{flatPyramidTexture:opts},feedbackBuffers:{locationAndIndex},varyings:["locationAndIndex"],vs:"".concat(_histopyramidShaders.HISTOPYRAMID_TRAVERSAL_UTILS).concat(_histopyramidShaders.HISTOPYRAMID_TRAVERSAL_VS),elementCount:_getHistoPyramid})).run({uniforms:{numLevels:levelCount}});return{locationAndIndexBuffer:locationAndIndex}};
var _defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_webgl=require("module$node_modules$$luma_DOT_gl$webgl$dist$es5$index"),_engine=require("module$node_modules$$luma_DOT_gl$engine$dist$es5$index"),_histopyramidShaders=require("module$node_modules$$luma_DOT_gl$experimental$dist$es5$gpgpu$histopyramid$histopyramid_shaders"),channelToIndexMap={r:0,x:0,g:1,y:1,b:2,z:2,a:3,w:3}}
//# sourceMappingURL=module$node_modules$$luma_DOT_gl$experimental$dist$es5$gpgpu$histopyramid$histopyramid.js.map
